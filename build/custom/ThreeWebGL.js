// ThreeWebGL.js r37 - http://github.com/mrdoob/three.js
var THREE=THREE||{};THREE.Color=function(a){this.setHex(a)};
THREE.Color.prototype={autoUpdate:!0,copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;this.hex=a.hex;this.__styleString=a.__styleString},setRGB:function(a,c,d){this.r=a;this.g=c;this.b=d;if(this.autoUpdate){this.updateHex();this.updateStyleString()}},setHSV:function(a,c,d){var g,f,i,j,o,p;if(d==0)g=f=i=0;else{j=Math.floor(a*6);o=a*6-j;a=d*(1-c);p=d*(1-c*o);c=d*(1-c*(1-o));switch(j){case 1:g=p;f=d;i=a;break;case 2:g=a;f=d;i=c;break;case 3:g=a;f=p;i=d;break;case 4:g=c;f=a;i=d;break;case 5:g=d;f=a;
i=p;break;case 6:case 0:g=d;f=c;i=a}}this.r=g;this.g=f;this.b=i;if(this.autoUpdate){this.updateHex();this.updateStyleString()}},setHex:function(a){this.hex=~~a&16777215;if(this.autoUpdate){this.updateRGB();this.updateStyleString()}},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGB:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},updateStyleString:function(){this.__styleString="rgb("+~~(this.r*255)+","+~~(this.g*
255)+","+~~(this.b*255)+")"},clone:function(){return new THREE.Color(this.hex)}};THREE.Vector2=function(a,c){this.set(a||0,c||0)};
THREE.Vector2.prototype={set:function(a,c){this.x=a;this.y=c;return this},copy:function(a){this.set(a.x,a.y);return this},addSelf:function(a){this.set(this.x+a.x,this.y+a.y);return this},add:function(a,c){this.set(a.x+c.x,a.y+c.y);return this},subSelf:function(a){this.set(this.x-a.x,this.y-a.y);return this},sub:function(a,c){this.set(a.x-c.x,a.y-c.y);return this},multiplyScalar:function(a){this.set(this.x*a,this.y*a);return this},negate:function(){this.set(-this.x,-this.y);return this},unit:function(){this.multiplyScalar(1/
this.length());return this},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(a,c,d){this.set(a||0,c||0,d||0)};
THREE.Vector3.prototype={set:function(a,c,d){this.x=a;this.y=c;this.z=d;return this},copy:function(a){this.set(a.x,a.y,a.z);return this},add:function(a,c){this.set(a.x+c.x,a.y+c.y,a.z+c.z);return this},addSelf:function(a){this.set(this.x+a.x,this.y+a.y,this.z+a.z);return this},addScalar:function(a){this.set(this.x+a,this.y+a,this.z+a);return this},sub:function(a,c){this.set(a.x-c.x,a.y-c.y,a.z-c.z);return this},subSelf:function(a){this.set(this.x-a.x,this.y-a.y,this.z-a.z);return this},cross:function(a,
c){this.set(a.y*c.z-a.z*c.y,a.z*c.x-a.x*c.z,a.x*c.y-a.y*c.x);return this},crossSelf:function(a){var c=this.x,d=this.y,g=this.z;this.set(d*a.z-g*a.y,g*a.x-c*a.z,c*a.y-d*a.x);return this},multiply:function(a,c){this.set(a.x*c.x,a.y*c.y,a.z*c.z);return this},multiplySelf:function(a){this.set(this.x*a.x,this.y*a.y,this.z*a.z);return this},multiplyScalar:function(a){this.set(this.x*a,this.y*a,this.z*a);return this},divideSelf:function(a){this.set(this.x/a.x,this.y/a.y,this.z/a.z);return this},divideScalar:function(a){this.set(this.x/
a,this.y/a,this.z/a);return this},negate:function(){this.set(-this.x,-this.y,-this.z);return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var c=this.x-a.x,d=this.y-a.y;a=this.z-a.z;return c*c+d*d+a*a},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){var a=
this.length();a>0?this.multiplyScalar(1/a):this.set(0,0,0);return this},setPositionFromMatrix:function(a){this.x=a.n14;this.y=a.n24;this.z=a.n34},setRotationFromMatrix:function(a){this.y=Math.asin(a.n13);var c=Math.cos(this.y);if(Math.abs(c)>1.0E-5){this.x=Math.atan2(-a.n23/c,a.n33/c);this.z=Math.atan2(-a.n13/c,a.n11/c)}else{this.x=0;this.z=Math.atan2(a.n21,a.n22)}},setLength:function(a){return this.normalize().multiplyScalar(a)},isZero:function(){return Math.abs(this.x)<1.0E-4&&Math.abs(this.y)<
1.0E-4&&Math.abs(this.z)<1.0E-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(a,c,d,g){this.set(a||0,c||0,d||0,g||1)};
THREE.Vector4.prototype={set:function(a,c,d,g){this.x=a;this.y=c;this.z=d;this.w=g;return this},copy:function(a){this.set(a.x,a.y,a.z,a.w||1);return this},add:function(a,c){this.set(a.x+c.x,a.y+c.y,a.z+c.z,a.w+c.w);return this},addSelf:function(a){this.set(this.x+a.x,this.y+a.y,this.z+a.z,this.w+a.w);return this},sub:function(a,c){this.set(a.x-c.x,a.y-c.y,a.z-c.z,a.w-c.w);return this},subSelf:function(a){this.set(this.x-a.x,this.y-a.y,this.z-a.z,this.w-a.w);return this},multiplyScalar:function(a){this.set(this.x*
a,this.y*a,this.z*a,this.w*a);return this},divideScalar:function(a){this.set(this.x/a,this.y/a,this.z/a,this.w/a);return this},lerpSelf:function(a,c){this.set(this.x+(a.x-this.x)*c,this.y+(a.y-this.y)*c,this.z+(a.z-this.z)*c,this.w+(a.w-this.w)*c)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Ray=function(a,c){this.origin=a||new THREE.Vector3;this.direction=c||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(a){var c,d,g=a.objects,f=[];a=0;for(c=g.length;a<c;a++){d=g[a];d instanceof THREE.Mesh&&(f=f.concat(this.intersectObject(d)))}f.sort(function(i,j){return i.distance-j.distance});return f},intersectObject:function(a){function c(T,O,pa,Y){Y=Y.clone().subSelf(O);pa=pa.clone().subSelf(O);var qa=T.clone().subSelf(O);T=Y.dot(Y);O=Y.dot(pa);Y=Y.dot(qa);var V=pa.dot(pa);pa=pa.dot(qa);qa=1/(T*V-O*O);V=(V*Y-O*pa)*qa;T=(T*pa-O*Y)*qa;return V>0&&T>0&&V+T<1}var d,g,
f,i,j,o,p,v,x,y,D,z=a.geometry,K=z.vertices,M=[];d=0;for(g=z.faces.length;d<g;d++){f=z.faces[d];y=this.origin.clone();D=this.direction.clone();p=a.matrixWorld;i=p.multiplyVector3(K[f.a].position.clone());j=p.multiplyVector3(K[f.b].position.clone());o=p.multiplyVector3(K[f.c].position.clone());p=f instanceof THREE.Face4?p.multiplyVector3(K[f.d].position.clone()):null;v=a.matrixRotationWorld.multiplyVector3(f.normal.clone());x=D.dot(v);if(x<0){v=v.dot((new THREE.Vector3).sub(i,y))/x;y=y.addSelf(D.multiplyScalar(v));
if(f instanceof THREE.Face3){if(c(y,i,j,o)){f={distance:this.origin.distanceTo(y),point:y,face:f,object:a};M.push(f)}}else if(f instanceof THREE.Face4&&(c(y,i,j,p)||c(y,j,o,p))){f={distance:this.origin.distanceTo(y),point:y,face:f,object:a};M.push(f)}}}return M}};
THREE.Rectangle=function(){function a(){i=g-c;j=f-d}var c,d,g,f,i,j,o=!0;this.getX=function(){return c};this.getY=function(){return d};this.getWidth=function(){return i};this.getHeight=function(){return j};this.getLeft=function(){return c};this.getTop=function(){return d};this.getRight=function(){return g};this.getBottom=function(){return f};this.set=function(p,v,x,y){o=!1;c=p;d=v;g=x;f=y;a()};this.addPoint=function(p,v){if(o){o=!1;c=p;d=v;g=p;f=v}else{c=c<p?c:p;d=d<v?d:v;g=g>p?g:p;f=f>v?f:v}a()};
this.add3Points=function(p,v,x,y,D,z){if(o){o=!1;c=p<x?p<D?p:D:x<D?x:D;d=v<y?v<z?v:z:y<z?y:z;g=p>x?p>D?p:D:x>D?x:D;f=v>y?v>z?v:z:y>z?y:z}else{c=p<x?p<D?p<c?p:c:D<c?D:c:x<D?x<c?x:c:D<c?D:c;d=v<y?v<z?v<d?v:d:z<d?z:d:y<z?y<d?y:d:z<d?z:d;g=p>x?p>D?p>g?p:g:D>g?D:g:x>D?x>g?x:g:D>g?D:g;f=v>y?v>z?v>f?v:f:z>f?z:f:y>z?y>f?y:f:z>f?z:f}a()};this.addRectangle=function(p){if(o){o=!1;c=p.getLeft();d=p.getTop();g=p.getRight();f=p.getBottom()}else{c=c<p.getLeft()?c:p.getLeft();d=d<p.getTop()?d:p.getTop();g=g>p.getRight()?
g:p.getRight();f=f>p.getBottom()?f:p.getBottom()}a()};this.inflate=function(p){c-=p;d-=p;g+=p;f+=p;a()};this.minSelf=function(p){c=c>p.getLeft()?c:p.getLeft();d=d>p.getTop()?d:p.getTop();g=g<p.getRight()?g:p.getRight();f=f<p.getBottom()?f:p.getBottom();a()};this.instersects=function(p){return Math.min(g,p.getRight())-Math.max(c,p.getLeft())>=0&&Math.min(f,p.getBottom())-Math.max(d,p.getTop())>=0};this.empty=function(){o=!0;f=g=d=c=0;a()};this.isEmpty=function(){return o}};
THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={transpose:function(){var a,c=this.m;a=c[1];c[1]=c[3];c[3]=a;a=c[2];c[2]=c[6];c[6]=a;a=c[5];c[5]=c[7];c[7]=a;return this},transposeIntoArray:function(a){var c=this.m;a[0]=c[0];a[1]=c[3];a[2]=c[6];a[3]=c[1];a[4]=c[4];a[5]=c[7];a[6]=c[2];a[7]=c[5];a[8]=c[8];return this}};
THREE.Matrix4=function(a,c,d,g,f,i,j,o,p,v,x,y,D,z,K,M){this.set(a||1,c||0,d||0,g||0,f||0,i||1,j||0,o||0,p||0,v||0,x||1,y||0,D||0,z||0,K||0,M||1);this.flat=Array(16);this.m33=new THREE.Matrix3};
THREE.Matrix4.prototype={set:function(a,c,d,g,f,i,j,o,p,v,x,y,D,z,K,M){this.n11=a;this.n12=c;this.n13=d;this.n14=g;this.n21=f;this.n22=i;this.n23=j;this.n24=o;this.n31=p;this.n32=v;this.n33=x;this.n34=y;this.n41=D;this.n42=z;this.n43=K;this.n44=M;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.set(a.n11,a.n12,a.n13,a.n14,a.n21,a.n22,a.n23,a.n24,a.n31,a.n32,a.n33,a.n34,a.n41,a.n42,a.n43,a.n44);return this},lookAt:function(a,c,d){var g=THREE.Matrix4.__v1,
f=THREE.Matrix4.__v2,i=THREE.Matrix4.__v3;i.sub(a,c).normalize();if(i.length()===0)i.z=1;g.cross(d,i).normalize();if(g.length()===0){i.x+=1.0E-4;g.cross(d,i).normalize()}f.cross(i,g).normalize();this.n11=g.x;this.n12=f.x;this.n13=i.x;this.n21=g.y;this.n22=f.y;this.n23=i.y;this.n31=g.z;this.n32=f.z;this.n33=i.z;return this},multiplyVector3:function(a){var c=a.x,d=a.y,g=a.z,f=1/(this.n41*c+this.n42*d+this.n43*g+this.n44);a.x=(this.n11*c+this.n12*d+this.n13*g+this.n14)*f;a.y=(this.n21*c+this.n22*d+this.n23*
g+this.n24)*f;a.z=(this.n31*c+this.n32*d+this.n33*g+this.n34)*f;return a},multiplyVector4:function(a){var c=a.x,d=a.y,g=a.z,f=a.w;a.x=this.n11*c+this.n12*d+this.n13*g+this.n14*f;a.y=this.n21*c+this.n22*d+this.n23*g+this.n24*f;a.z=this.n31*c+this.n32*d+this.n33*g+this.n34*f;a.w=this.n41*c+this.n42*d+this.n43*g+this.n44*f;return a},rotateAxis:function(a){var c=a.x,d=a.y,g=a.z;a.x=c*this.n11+d*this.n12+g*this.n13;a.y=c*this.n21+d*this.n22+g*this.n23;a.z=c*this.n31+d*this.n32+g*this.n33;a.normalize();
return a},crossVector:function(a){var c=new THREE.Vector4;c.x=this.n11*a.x+this.n12*a.y+this.n13*a.z+this.n14*a.w;c.y=this.n21*a.x+this.n22*a.y+this.n23*a.z+this.n24*a.w;c.z=this.n31*a.x+this.n32*a.y+this.n33*a.z+this.n34*a.w;c.w=a.w?this.n41*a.x+this.n42*a.y+this.n43*a.z+this.n44*a.w:1;return c},multiply:function(a,c){var d=a.n11,g=a.n12,f=a.n13,i=a.n14,j=a.n21,o=a.n22,p=a.n23,v=a.n24,x=a.n31,y=a.n32,D=a.n33,z=a.n34,K=a.n41,M=a.n42,T=a.n43,O=a.n44,pa=c.n11,Y=c.n12,qa=c.n13,V=c.n14,E=c.n21,Fa=c.n22,
ka=c.n23,Da=c.n24,$=c.n31,b=c.n32,Q=c.n33,la=c.n34;this.n11=d*pa+g*E+f*$;this.n12=d*Y+g*Fa+f*b;this.n13=d*qa+g*ka+f*Q;this.n14=d*V+g*Da+f*la+i;this.n21=j*pa+o*E+p*$;this.n22=j*Y+o*Fa+p*b;this.n23=j*qa+o*ka+p*Q;this.n24=j*V+o*Da+p*la+v;this.n31=x*pa+y*E+D*$;this.n32=x*Y+y*Fa+D*b;this.n33=x*qa+y*ka+D*Q;this.n34=x*V+y*Da+D*la+z;this.n41=K*pa+M*E+T*$;this.n42=K*Y+M*Fa+T*b;this.n43=K*qa+M*ka+T*Q;this.n44=K*V+M*Da+T*la+O;return this},multiplyToArray:function(a,c,d){this.multiply(a,c);d[0]=this.n11;d[1]=
this.n21;d[2]=this.n31;d[3]=this.n41;d[4]=this.n12;d[5]=this.n22;d[6]=this.n32;d[7]=this.n42;d[8]=this.n13;d[9]=this.n23;d[10]=this.n33;d[11]=this.n43;d[12]=this.n14;d[13]=this.n24;d[14]=this.n34;d[15]=this.n44;return this},multiplySelf:function(a){this.multiply(this,a);return this},multiplyScalar:function(a){this.n11*=a;this.n12*=a;this.n13*=a;this.n14*=a;this.n21*=a;this.n22*=a;this.n23*=a;this.n24*=a;this.n31*=a;this.n32*=a;this.n33*=a;this.n34*=a;this.n41*=a;this.n42*=a;this.n43*=a;this.n44*=
a;return this},determinant:function(){var a=this.n11,c=this.n12,d=this.n13,g=this.n14,f=this.n21,i=this.n22,j=this.n23,o=this.n24,p=this.n31,v=this.n32,x=this.n33,y=this.n34,D=this.n41,z=this.n42,K=this.n43,M=this.n44;return g*j*v*D-d*o*v*D-g*i*x*D+c*o*x*D+d*i*y*D-c*j*y*D-g*j*p*z+d*o*p*z+g*f*x*z-a*o*x*z-d*f*y*z+a*j*y*z+g*i*p*K-c*o*p*K-g*f*v*K+a*o*v*K+c*f*y*K-a*i*y*K-d*i*p*M+c*j*p*M+d*f*v*M-a*j*v*M-c*f*x*M+a*i*x*M},transpose:function(){var a;a=this.n21;this.n21=this.n12;this.n12=a;a=this.n31;this.n31=
this.n13;this.n13=a;a=this.n32;this.n32=this.n23;this.n23=a;a=this.n41;this.n41=this.n14;this.n14=a;a=this.n42;this.n42=this.n24;this.n24=a;a=this.n43;this.n43=this.n34;this.n43=a;return this},clone:function(){var a=new THREE.Matrix4;a.n11=this.n11;a.n12=this.n12;a.n13=this.n13;a.n14=this.n14;a.n21=this.n21;a.n22=this.n22;a.n23=this.n23;a.n24=this.n24;a.n31=this.n31;a.n32=this.n32;a.n33=this.n33;a.n34=this.n34;a.n41=this.n41;a.n42=this.n42;a.n43=this.n43;a.n44=this.n44;return a},flatten:function(){this.flat[0]=
this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(a){a[0]=this.n11;a[1]=this.n21;a[2]=this.n31;a[3]=this.n41;a[4]=this.n12;a[5]=this.n22;a[6]=this.n32;a[7]=this.n42;
a[8]=this.n13;a[9]=this.n23;a[10]=this.n33;a[11]=this.n43;a[12]=this.n14;a[13]=this.n24;a[14]=this.n34;a[15]=this.n44;return a},flattenToArrayOffset:function(a,c){a[c]=this.n11;a[c+1]=this.n21;a[c+2]=this.n31;a[c+3]=this.n41;a[c+4]=this.n12;a[c+5]=this.n22;a[c+6]=this.n32;a[c+7]=this.n42;a[c+8]=this.n13;a[c+9]=this.n23;a[c+10]=this.n33;a[c+11]=this.n43;a[c+12]=this.n14;a[c+13]=this.n24;a[c+14]=this.n34;a[c+15]=this.n44;return a},setTranslation:function(a,c,d){this.set(1,0,0,a,0,1,0,c,0,0,1,d,0,0,
0,1);return this},setScale:function(a,c,d){this.set(a,0,0,0,0,c,0,0,0,0,d,0,0,0,0,1);return this},setRotationX:function(a){var c=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,c,-a,0,0,a,c,0,0,0,0,1);return this},setRotationY:function(a){var c=Math.cos(a);a=Math.sin(a);this.set(c,0,a,0,0,1,0,0,-a,0,c,0,0,0,0,1);return this},setRotationZ:function(a){var c=Math.cos(a);a=Math.sin(a);this.set(c,-a,0,0,a,c,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(a,c){var d=Math.cos(c),g=Math.sin(c),f=
1-d,i=a.x,j=a.y,o=a.z,p=f*i,v=f*j;this.set(p*i+d,p*j-g*o,p*o+g*j,0,p*j+g*o,v*j+d,v*o-g*i,0,p*o-g*j,v*o+g*i,f*o*o+d,0,0,0,0,1);return this},setPosition:function(a){this.n14=a.x;this.n24=a.y;this.n34=a.z;return this},setRotationFromEuler:function(a){var c=a.x,d=a.y,g=a.z;a=Math.cos(c);c=Math.sin(c);var f=Math.cos(d);d=Math.sin(d);var i=Math.cos(g);g=Math.sin(g);var j=a*d,o=c*d;this.n11=f*i;this.n12=-f*g;this.n13=d;this.n21=o*i+a*g;this.n22=-o*g+a*i;this.n23=-c*f;this.n31=-j*i+c*g;this.n32=j*g+c*i;this.n33=
a*f;return this},setRotationFromQuaternion:function(a){var c=a.x,d=a.y,g=a.z,f=a.w,i=c+c,j=d+d,o=g+g;a=c*i;var p=c*j;c*=o;var v=d*j;d*=o;g*=o;i*=f;j*=f;f*=o;this.n11=1-(v+g);this.n12=p-f;this.n13=c+j;this.n21=p+f;this.n22=1-(a+g);this.n23=d-i;this.n31=c-j;this.n32=d+i;this.n33=1-(a+v);return this},scale:function(a){var c=a.x,d=a.y;a=a.z;this.n11*=c;this.n12*=d;this.n13*=a;this.n21*=c;this.n22*=d;this.n23*=a;this.n31*=c;this.n32*=d;this.n33*=a;this.n41*=c;this.n42*=d;this.n43*=a;return this},extractPosition:function(a){this.n14=
a.n14;this.n24=a.n24;this.n34=a.n34},extractRotation:function(a,c){var d=1/c.x,g=1/c.y,f=1/c.z;this.n11=a.n11*d;this.n21=a.n21*d;this.n31=a.n31*d;this.n12=a.n12*g;this.n22=a.n22*g;this.n32=a.n32*g;this.n13=a.n13*f;this.n23=a.n23*f;this.n33=a.n33*f}};
THREE.Matrix4.makeInvert=function(a,c){var d=a.n11,g=a.n12,f=a.n13,i=a.n14,j=a.n21,o=a.n22,p=a.n23,v=a.n24,x=a.n31,y=a.n32,D=a.n33,z=a.n34,K=a.n41,M=a.n42,T=a.n43,O=a.n44;c===undefined&&(c=new THREE.Matrix4);c.n11=p*z*M-v*D*M+v*y*T-o*z*T-p*y*O+o*D*O;c.n12=i*D*M-f*z*M-i*y*T+g*z*T+f*y*O-g*D*O;c.n13=f*v*M-i*p*M+i*o*T-g*v*T-f*o*O+g*p*O;c.n14=i*p*y-f*v*y-i*o*D+g*v*D+f*o*z-g*p*z;c.n21=v*D*K-p*z*K-v*x*T+j*z*T+p*x*O-j*D*O;c.n22=f*z*K-i*D*K+i*x*T-d*z*T-f*x*O+d*D*O;c.n23=i*p*K-f*v*K-i*j*T+d*v*T+f*j*O-d*p*O;
c.n24=f*v*x-i*p*x+i*j*D-d*v*D-f*j*z+d*p*z;c.n31=o*z*K-v*y*K+v*x*M-j*z*M-o*x*O+j*y*O;c.n32=i*y*K-g*z*K-i*x*M+d*z*M+g*x*O-d*y*O;c.n33=f*v*K-i*o*K+i*j*M-d*v*M-g*j*O+d*o*O;c.n34=i*o*x-g*v*x-i*j*y+d*v*y+g*j*z-d*o*z;c.n41=p*y*K-o*D*K-p*x*M+j*D*M+o*x*T-j*y*T;c.n42=g*D*K-f*y*K+f*x*M-d*D*M-g*x*T+d*y*T;c.n43=f*o*K-g*p*K-f*j*M+d*p*M+g*j*T-d*o*T;c.n44=g*p*x-f*o*x+f*j*y-d*p*y-g*j*D+d*o*D;c.multiplyScalar(1/a.determinant());return c};
THREE.Matrix4.makeInvert3x3=function(a){var c=a.m33,d=c.m,g=a.n33*a.n22-a.n32*a.n23,f=-a.n33*a.n21+a.n31*a.n23,i=a.n32*a.n21-a.n31*a.n22,j=-a.n33*a.n12+a.n32*a.n13,o=a.n33*a.n11-a.n31*a.n13,p=-a.n32*a.n11+a.n31*a.n12,v=a.n23*a.n12-a.n22*a.n13,x=-a.n23*a.n11+a.n21*a.n13,y=a.n22*a.n11-a.n21*a.n12;a=a.n11*g+a.n21*j+a.n31*v;if(a==0)throw"matrix not invertible";a=1/a;d[0]=a*g;d[1]=a*f;d[2]=a*i;d[3]=a*j;d[4]=a*o;d[5]=a*p;d[6]=a*v;d[7]=a*x;d[8]=a*y;return c};
THREE.Matrix4.makeFrustum=function(a,c,d,g,f,i){var j;j=new THREE.Matrix4;j.n11=2*f/(c-a);j.n12=0;j.n13=(c+a)/(c-a);j.n14=0;j.n21=0;j.n22=2*f/(g-d);j.n23=(g+d)/(g-d);j.n24=0;j.n31=0;j.n32=0;j.n33=-(i+f)/(i-f);j.n34=-2*i*f/(i-f);j.n41=0;j.n42=0;j.n43=-1;j.n44=0;return j};THREE.Matrix4.makePerspective=function(a,c,d,g){var f;a=d*Math.tan(a*Math.PI/360);f=-a;return THREE.Matrix4.makeFrustum(f*c,a*c,f,a,d,g)};
THREE.Matrix4.makeOrtho=function(a,c,d,g,f,i){var j,o,p,v;j=new THREE.Matrix4;o=c-a;p=d-g;v=i-f;j.n11=2/o;j.n12=0;j.n13=0;j.n14=-((c+a)/o);j.n21=0;j.n22=2/p;j.n23=0;j.n24=-((d+g)/p);j.n31=0;j.n32=0;j.n33=-2/v;j.n34=-((i+f)/v);j.n41=0;j.n42=0;j.n43=0;j.n44=1;return j};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;
THREE.Object3D=function(){this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.scale=new THREE.Vector3(1,1,1);this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=
!0;this._vector=new THREE.Vector3};
THREE.Object3D.prototype={translate:function(a,c){this.matrix.rotateAxis(c);this.position.addSelf(c.multiplyScalar(a))},translateX:function(a){this.translate(a,this._vector.set(1,0,0))},translateY:function(a){this.translate(a,this._vector.set(0,1,0))},translateZ:function(a){this.translate(a,this._vector.set(0,0,1))},lookAt:function(a){this.matrix.lookAt(this.position,a,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(a){if(this.children.indexOf(a)===-1){a.parent!==
undefined&&a.parent.removeChild(a);a.parent=this;this.children.push(a);for(var c=this;c instanceof THREE.Scene===!1&&c!==undefined;)c=c.parent;c!==undefined&&c.addChildRecurse(a)}},removeChild:function(a){var c=this.children.indexOf(a);if(c!==-1){a.parent=undefined;this.children.splice(c,1)}},updateMatrix:function(){this.matrix.setPosition(this.position);this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation);if(this.scale.x!==1||this.scale.y!==
1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},update:function(a,c,d){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||c){a?this.matrixWorld.multiply(a,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale);this.matrixWorldNeedsUpdate=!1;c=!0}a=0;for(var g=this.children.length;a<g;a++)this.children[a].update(this.matrixWorld,
c,d)}};THREE.Quaternion=function(a,c,d,g){this.set(a||0,c||0,d||0,g!==undefined?g:1)};
THREE.Quaternion.prototype={set:function(a,c,d,g){this.x=a;this.y=c;this.z=d;this.w=g;return this},setFromEuler:function(a){var c=0.5*Math.PI/360,d=a.x*c,g=a.y*c,f=a.z*c;a=Math.cos(g);g=Math.sin(g);c=Math.cos(-f);f=Math.sin(-f);var i=Math.cos(d);d=Math.sin(d);var j=a*c,o=g*f;this.w=j*i-o*d;this.x=j*d+o*i;this.y=g*c*i+a*f*d;this.z=a*f*i-g*c*d;return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=
-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(a==0)this.w=this.z=this.y=this.x=0;else{a=1/a;this.x*=a;this.y*=a;this.z*=a;this.w*=a}return this},multiplySelf:function(a){var c=this.x,d=this.y,g=this.z,f=this.w,i=a.x,j=a.y,o=a.z;a=a.w;this.x=c*a+f*i+d*o-g*j;this.y=d*a+f*j+g*i-c*o;this.z=g*a+f*o+c*j-d*i;this.w=f*a-c*i-d*j-g*o;return this},
multiplyVector3:function(a,c){c||(c=a);var d=a.x,g=a.y,f=a.z,i=this.x,j=this.y,o=this.z,p=this.w,v=p*d+j*f-o*g,x=p*g+o*d-i*f,y=p*f+i*g-j*d;d=-i*d-j*g-o*f;c.x=v*p+d*-i+x*-o-y*-j;c.y=x*p+d*-j+y*-i-v*-o;c.z=y*p+d*-o+v*-j-x*-i;return c}};
THREE.Quaternion.slerp=function(a,c,d,g){var f=a.w*c.w+a.x*c.x+a.y*c.y+a.z*c.z;if(Math.abs(f)>=1){d.w=a.w;d.x=a.x;d.y=a.y;d.z=a.z;return d}var i=Math.acos(f),j=Math.sqrt(1-f*f);if(Math.abs(j)<0.001){d.w=0.5*(a.w+c.w);d.x=0.5*(a.x+c.x);d.y=0.5*(a.y+c.y);d.z=0.5*(a.z+c.z);return d}f=Math.sin((1-g)*i)/j;g=Math.sin(g*i)/j;d.w=a.w*f+c.w*g;d.x=a.x*f+c.x*g;d.y=a.y*f+c.y*g;d.z=a.z*f+c.z*g;return d};THREE.Vertex=function(a){this.position=a||new THREE.Vector3};
THREE.Face3=function(a,c,d,g,f,i){this.a=a;this.b=c;this.c=d;this.normal=g instanceof THREE.Vector3?g:new THREE.Vector3;this.vertexNormals=g instanceof Array?g:[];this.color=f instanceof THREE.Color?f:new THREE.Color;this.vertexColors=f instanceof Array?f:[];this.vertexTangents=[];this.materials=i instanceof Array?i:[i];this.centroid=new THREE.Vector3};
THREE.Face4=function(a,c,d,g,f,i,j){this.a=a;this.b=c;this.c=d;this.d=g;this.normal=f instanceof THREE.Vector3?f:new THREE.Vector3;this.vertexNormals=f instanceof Array?f:[];this.color=i instanceof THREE.Color?i:new THREE.Color;this.vertexColors=i instanceof Array?i:[];this.vertexTangents=[];this.materials=j instanceof Array?j:[j];this.centroid=new THREE.Vector3};THREE.UV=function(a,c){this.set(a||0,c||0)};
THREE.UV.prototype={set:function(a,c){this.u=a;this.v=c;return this},copy:function(a){this.set(a.u,a.v);return this}};THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++;this.vertices=[];this.colors=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1};
THREE.Geometry.prototype={computeCentroids:function(){var a,c,d;a=0;for(c=this.faces.length;a<c;a++){d=this.faces[a];d.centroid.set(0,0,0);if(d instanceof THREE.Face3){d.centroid.addSelf(this.vertices[d.a].position);d.centroid.addSelf(this.vertices[d.b].position);d.centroid.addSelf(this.vertices[d.c].position);d.centroid.divideScalar(3)}else if(d instanceof THREE.Face4){d.centroid.addSelf(this.vertices[d.a].position);d.centroid.addSelf(this.vertices[d.b].position);d.centroid.addSelf(this.vertices[d.c].position);
d.centroid.addSelf(this.vertices[d.d].position);d.centroid.divideScalar(4)}}},computeFaceNormals:function(a){var c,d,g,f,i,j,o=new THREE.Vector3,p=new THREE.Vector3;g=0;for(f=this.faces.length;g<f;g++){i=this.faces[g];if(a&&i.vertexNormals.length){o.set(0,0,0);c=0;for(d=i.vertexNormals.length;c<d;c++)o.addSelf(i.vertexNormals[c]);o.divideScalar(3)}else{c=this.vertices[i.a];d=this.vertices[i.b];j=this.vertices[i.c];o.sub(j.position,d.position);p.sub(c.position,d.position);o.crossSelf(p)}o.isZero()||
o.normalize();i.normal.copy(o)}},computeVertexNormals:function(){var a,c,d,g;if(this.__tmpVertices==undefined){g=this.__tmpVertices=Array(this.vertices.length);a=0;for(c=this.vertices.length;a<c;a++)g[a]=new THREE.Vector3;a=0;for(c=this.faces.length;a<c;a++){d=this.faces[a];if(d instanceof THREE.Face3)d.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(d instanceof THREE.Face4)d.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}else{g=
this.__tmpVertices;a=0;for(c=this.vertices.length;a<c;a++)g[a].set(0,0,0)}a=0;for(c=this.faces.length;a<c;a++){d=this.faces[a];if(d instanceof THREE.Face3){g[d.a].addSelf(d.normal);g[d.b].addSelf(d.normal);g[d.c].addSelf(d.normal)}else if(d instanceof THREE.Face4){g[d.a].addSelf(d.normal);g[d.b].addSelf(d.normal);g[d.c].addSelf(d.normal);g[d.d].addSelf(d.normal)}}a=0;for(c=this.vertices.length;a<c;a++)g[a].normalize();a=0;for(c=this.faces.length;a<c;a++){d=this.faces[a];if(d instanceof THREE.Face3){d.vertexNormals[0].copy(g[d.a]);
d.vertexNormals[1].copy(g[d.b]);d.vertexNormals[2].copy(g[d.c])}else if(d instanceof THREE.Face4){d.vertexNormals[0].copy(g[d.a]);d.vertexNormals[1].copy(g[d.b]);d.vertexNormals[2].copy(g[d.c]);d.vertexNormals[3].copy(g[d.d])}}},computeTangents:function(){function a(W,na,aa,oa,U,ra,ma){o=W.vertices[na].position;p=W.vertices[aa].position;v=W.vertices[oa].position;x=j[U];y=j[ra];D=j[ma];z=p.x-o.x;K=v.x-o.x;M=p.y-o.y;T=v.y-o.y;O=p.z-o.z;pa=v.z-o.z;Y=y.u-x.u;qa=D.u-x.u;V=y.v-x.v;E=D.v-x.v;Fa=1/(Y*E-qa*
V);b.set((E*z-V*K)*Fa,(E*M-V*T)*Fa,(E*O-V*pa)*Fa);Q.set((Y*K-qa*z)*Fa,(Y*T-qa*M)*Fa,(Y*pa-qa*O)*Fa);Da[na].addSelf(b);Da[aa].addSelf(b);Da[oa].addSelf(b);$[na].addSelf(Q);$[aa].addSelf(Q);$[oa].addSelf(Q)}var c,d,g,f,i,j,o,p,v,x,y,D,z,K,M,T,O,pa,Y,qa,V,E,Fa,ka,Da=[],$=[],b=new THREE.Vector3,Q=new THREE.Vector3,la=new THREE.Vector3,Ba=new THREE.Vector3,Ca=new THREE.Vector3;c=0;for(d=this.vertices.length;c<d;c++){Da[c]=new THREE.Vector3;$[c]=new THREE.Vector3}c=0;for(d=this.faces.length;c<d;c++){i=
this.faces[c];j=this.faceVertexUvs[0][c];if(i instanceof THREE.Face3)a(this,i.a,i.b,i.c,0,1,2);else if(i instanceof THREE.Face4){a(this,i.a,i.b,i.c,0,1,2);a(this,i.a,i.b,i.d,0,1,3)}}var ta=["a","b","c","d"];c=0;for(d=this.faces.length;c<d;c++){i=this.faces[c];for(g=0;g<i.vertexNormals.length;g++){Ca.copy(i.vertexNormals[g]);f=i[ta[g]];ka=Da[f];la.copy(ka);la.subSelf(Ca.multiplyScalar(Ca.dot(ka))).normalize();Ba.cross(i.vertexNormals[g],ka);f=Ba.dot($[f]);f=f<0?-1:1;i.vertexTangents[g]=new THREE.Vector4(la.x,
la.y,la.z,f)}}this.hasTangents=!0},computeBoundingBox:function(){var a;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var c=1,d=this.vertices.length;c<d;c++){a=this.vertices[c];if(a.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=a.position.x;else if(a.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=a.position.x;
if(a.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=a.position.y;else if(a.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=a.position.y;if(a.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=a.position.z;else if(a.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=a.position.z}}},computeBoundingSphere:function(){for(var a=this.boundingSphere===null?0:this.boundingSphere.radius,c=0,d=this.vertices.length;c<d;c++)a=Math.max(a,this.vertices[c].position.length());this.boundingSphere=
{radius:a}}};THREE.GeometryIdCounter=0;
THREE.AnimationHandler=function(){var a=[],c={},d={};d.update=function(f){for(var i=0;i<a.length;i++)a[i].update(f)};d.addToUpdate=function(f){a.indexOf(f)===-1&&a.push(f)};d.removeFromUpdate=function(f){f=a.indexOf(f);f!==-1&&a.splice(f,1)};d.add=function(f){c[f.name]!==undefined&&console.log("THREE.AnimationHandler.add: Warning! "+f.name+" already exists in library. Overwriting.");c[f.name]=f;if(f.initialized!==!0){for(var i=0;i<f.hierarchy.length;i++){for(var j=0;j<f.hierarchy[i].keys.length;j++){if(f.hierarchy[i].keys[j].time<
0)f.hierarchy[i].keys[j].time=0;if(f.hierarchy[i].keys[j].rot!==undefined&&!(f.hierarchy[i].keys[j].rot instanceof THREE.Quaternion)){var o=f.hierarchy[i].keys[j].rot;f.hierarchy[i].keys[j].rot=new THREE.Quaternion(o[0],o[1],o[2],o[3])}}if(f.hierarchy[i].keys[0].morphTargets!==undefined){o={};for(j=0;j<f.hierarchy[i].keys.length;j++)for(var p=0;p<f.hierarchy[i].keys[j].morphTargets.length;p++){var v=f.hierarchy[i].keys[j].morphTargets[p];o[v]=-1}f.hierarchy[i].usedMorphTargets=o;for(j=0;j<f.hierarchy[i].keys.length;j++){var x=
{};for(v in o){for(p=0;p<f.hierarchy[i].keys[j].morphTargets.length;p++)if(f.hierarchy[i].keys[j].morphTargets[p]===v){x[v]=f.hierarchy[i].keys[j].morphTargetsInfluences[p];break}p===f.hierarchy[i].keys[j].morphTargets.length&&(x[v]=0)}f.hierarchy[i].keys[j].morphTargetsInfluences=x}}for(j=1;j<f.hierarchy[i].keys.length;j++)if(f.hierarchy[i].keys[j].time===f.hierarchy[i].keys[j-1].time){f.hierarchy[i].keys.splice(j,1);j--}for(j=1;j<f.hierarchy[i].keys.length;j++)f.hierarchy[i].keys[j].index=j}j=parseInt(f.length*
f.fps,10);f.JIT={};f.JIT.hierarchy=[];for(i=0;i<f.hierarchy.length;i++)f.JIT.hierarchy.push(Array(j));f.initialized=!0}};d.get=function(f){if(typeof f==="string")if(c[f])return c[f];else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+f);return null}};d.parse=function(f){var i=[];if(f instanceof THREE.SkinnedMesh)for(var j=0;j<f.bones.length;j++)i.push(f.bones[j]);else g(f,i);return i};var g=function(f,i){i.push(f);for(var j=0;j<f.children.length;j++)g(f.children[j],i)};d.LINEAR=
0;d.CATMULLROM=1;d.CATMULLROM_FORWARD=2;return d}();THREE.Animation=function(a,c,d,g){this.root=a;this.data=THREE.AnimationHandler.get(c);this.hierarchy=THREE.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.isPaused=!0;this.loop=!0;this.interpolationType=d!==undefined?d:THREE.AnimationHandler.LINEAR;this.JITCompile=g!==undefined?g:!0;this.points=[];this.target=new THREE.Vector3};
THREE.Animation.prototype.play=function(a,c){if(!this.isPlaying){this.isPlaying=!0;this.loop=a!==undefined?a:!0;this.currentTime=c!==undefined?c:0;var d,g=this.hierarchy.length,f;for(d=0;d<g;d++){f=this.hierarchy[d];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD)f.useQuaternion=!0;f.matrixAutoUpdate=!0;if(f.animationCache===undefined){f.animationCache={};f.animationCache.prevKey={pos:0,rot:0,scl:0};f.animationCache.nextKey={pos:0,rot:0,scl:0};f.animationCache.originalMatrix=
f instanceof THREE.Bone?f.skinMatrix:f.matrix}var i=f.animationCache.prevKey;f=f.animationCache.nextKey;i.pos=this.data.hierarchy[d].keys[0];i.rot=this.data.hierarchy[d].keys[0];i.scl=this.data.hierarchy[d].keys[0];f.pos=this.getNextKeyWith("pos",d,1);f.rot=this.getNextKeyWith("rot",d,1);f.scl=this.getNextKeyWith("scl",d,1)}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};
THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.Animation.prototype.stop=function(){this.isPlaying=!1;this.isPaused=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var a=0;a<this.hierarchy.length;a++)if(this.hierarchy[a].animationCache!==undefined){if(this.hierarchy[a]instanceof THREE.Bone)this.hierarchy[a].skinMatrix=this.hierarchy[a].animationCache.originalMatrix;else this.hierarchy[a].matrix=this.hierarchy[a].animationCache.originalMatrix;delete this.hierarchy[a].animationCache}};
THREE.Animation.prototype.update=function(a){if(this.isPlaying){var c=["pos","rot","scl"],d,g,f,i,j,o,p,v,x=this.data.JIT.hierarchy,y,D;this.currentTime+=a*this.timeScale;D=this.currentTime;y=this.currentTime%=this.data.length;v=parseInt(Math.min(y*this.data.fps,this.data.length*this.data.fps),10);for(var z=0,K=this.hierarchy.length;z<K;z++){a=this.hierarchy[z];p=a.animationCache;if(this.JITCompile&&x[z][v]!==undefined)if(a instanceof THREE.Bone){a.skinMatrix=x[z][v];a.matrixAutoUpdate=!1;a.matrixWorldNeedsUpdate=
!1}else{a.matrix=x[z][v];a.matrixAutoUpdate=!1;a.matrixWorldNeedsUpdate=!0}else{if(this.JITCompile)if(a instanceof THREE.Bone)a.skinMatrix=a.animationCache.originalMatrix;else a.matrix=a.animationCache.originalMatrix;for(var M=0;M<3;M++){d=c[M];j=p.prevKey[d];o=p.nextKey[d];if(o.time<=D){if(y<D)if(this.loop){j=this.data.hierarchy[z].keys[0];for(o=this.getNextKeyWith(d,z,1);o.time<y;){j=o;o=this.getNextKeyWith(d,z,o.index+1)}}else{this.stop();return}else{do{j=o;o=this.getNextKeyWith(d,z,o.index+1)}while(o.time<
y)}p.prevKey[d]=j;p.nextKey[d]=o}a.matrixAutoUpdate=!0;a.matrixWorldNeedsUpdate=!0;g=(y-j.time)/(o.time-j.time);f=j[d];i=o[d];if(g<0||g>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+g+" on bone "+z);g=g<0?0:1}if(d==="pos"){d=a.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){d.x=f[0]+(i[0]-f[0])*g;d.y=f[1]+(i[1]-f[1])*g;d.z=f[2]+(i[2]-f[2])*g}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=
this.getPrevKeyWith("pos",z,j.index-1).pos;this.points[1]=f;this.points[2]=i;this.points[3]=this.getNextKeyWith("pos",z,o.index+1).pos;g=g*0.33+0.33;f=this.interpolateCatmullRom(this.points,g);d.x=f[0];d.y=f[1];d.z=f[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){g=this.interpolateCatmullRom(this.points,g*1.01);this.target.set(g[0],g[1],g[2]);this.target.subSelf(d);this.target.y=0;this.target.normalize();g=Math.atan2(this.target.x,this.target.z);a.rotation.set(0,g,0)}}}else if(d===
"rot")THREE.Quaternion.slerp(f,i,a.quaternion,g);else if(d==="scl"){d=a.scale;d.x=f[0]+(i[0]-f[0])*g;d.y=f[1]+(i[1]-f[1])*g;d.z=f[2]+(i[2]-f[2])*g}}}}if(this.JITCompile&&x[0][v]===undefined){this.hierarchy[0].update(undefined,!0);for(z=0;z<this.hierarchy.length;z++)x[z][v]=this.hierarchy[z]instanceof THREE.Bone?this.hierarchy[z].skinMatrix.clone():this.hierarchy[z].matrix.clone()}}};
THREE.Animation.prototype.interpolateCatmullRom=function(a,c){var d=[],g=[],f,i,j,o,p,v;f=(a.length-1)*c;i=Math.floor(f);f-=i;d[0]=i==0?i:i-1;d[1]=i;d[2]=i>a.length-2?i:i+1;d[3]=i>a.length-3?i:i+2;i=a[d[0]];o=a[d[1]];p=a[d[2]];v=a[d[3]];d=f*f;j=f*d;g[0]=this.interpolate(i[0],o[0],p[0],v[0],f,d,j);g[1]=this.interpolate(i[1],o[1],p[1],v[1],f,d,j);g[2]=this.interpolate(i[2],o[2],p[2],v[2],f,d,j);return g};
THREE.Animation.prototype.interpolate=function(a,c,d,g,f,i,j){a=(d-a)*0.5;g=(g-c)*0.5;return(2*(c-d)+a+g)*j+(-3*(c-d)-2*a-g)*i+a*f+c};THREE.Animation.prototype.getNextKeyWith=function(a,c,d){var g=this.data.hierarchy[c].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)d=d<g.length-1?d:g.length-1;else d%=g.length;for(;d<g.length;d++)if(g[d][a]!==undefined)return g[d];return this.data.hierarchy[c].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(a,c,d){var g=this.data.hierarchy[c].keys;for(d=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?d>0?d:0:d>=0?d:d+g.length;d>=0;d--)if(g[d][a]!==undefined)return g[d];return this.data.hierarchy[c].keys[g.length-1]};
THREE.Camera=function(a,c,d,g,f){THREE.Object3D.call(this);this.fov=a||50;this.aspect=c||1;this.near=d||0.1;this.far=g||2E3;this.target=f||new THREE.Object3D;this.useTarget=!0;this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=null;this.updateProjectionMatrix()};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.supr=THREE.Object3D.prototype;
THREE.Camera.prototype.translate=function(a,c){this.matrix.rotateAxis(c);this.position.addSelf(c.multiplyScalar(a));this.target.position.addSelf(c.multiplyScalar(a))};THREE.Camera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};THREE.Camera.prototype.updateMatrix=function(){this.update(undefined,!0)};
THREE.Camera.prototype.update=function(a,c,d){if(this.useTarget){this.matrix.lookAt(this.position,this.target.position,this.up);this.matrix.setPosition(this.position);a?this.matrixWorld.multiply(a,this.matrix):this.matrixWorld.copy(this.matrix);THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse);c=!0}else{this.matrixAutoUpdate&&(c|=this.updateMatrix());if(c||this.matrixWorldNeedsUpdate){a?this.matrixWorld.multiply(a,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=
!1;c=!0;THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)}}for(a=0;a<this.children.length;a++)this.children[a].update(this.matrixWorld,c,d)};THREE.Light=function(a){THREE.Object3D.call(this);this.color=new THREE.Color(a)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(a){THREE.Light.call(this,a)};THREE.AmbientLight.prototype=new THREE.Light;
THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(a,c,d){THREE.Light.call(this,a);this.position=new THREE.Vector3(0,1,0);this.intensity=c||1;this.distance=d||0};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(a,c,d){THREE.Light.call(this,a);this.position=new THREE.Vector3;this.intensity=c||1;this.distance=d||0};THREE.PointLight.prototype=new THREE.Light;
THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.Material=function(a){this.id=THREE.MaterialCounter.value++;a=a||{};this.opacity=a.opacity!==undefined?a.opacity:1;this.transparent=a.transparent!==undefined?a.transparent:!1;this.blending=a.blending!==undefined?a.blending:THREE.NormalBlending;this.depthTest=a.depthTest!==undefined?a.depthTest:!0};THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;
THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.MaterialCounter={value:0};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};
THREE.LineBasicMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.linewidth=a.linewidth!==undefined?a.linewidth:1;this.linecap=a.linecap!==undefined?a.linecap:"round";this.linejoin=a.linejoin!==undefined?a.linejoin:"round";this.vertexColors=a.vertexColors?a.vertexColors:!1};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.MeshBasicMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.map=a.map!==undefined?a.map:null;this.lightMap=a.lightMap!==undefined?a.lightMap:null;this.envMap=a.envMap!==undefined?a.envMap:null;this.combine=a.combine!==undefined?a.combine:THREE.MultiplyOperation;this.reflectivity=a.reflectivity!==undefined?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==undefined?a.refractionRatio:0.98;this.shading=
a.shading!==undefined?a.shading:THREE.SmoothShading;this.wireframe=a.wireframe!==undefined?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==undefined?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==undefined?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==undefined?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==undefined?a.vertexColors:!1;this.skinning=a.skinning!==undefined?a.skinning:!1;this.morphTargets=a.morphTargets!==undefined?
a.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshLambertMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.map=a.map!==undefined?a.map:null;this.lightMap=a.lightMap!==undefined?a.lightMap:null;this.envMap=a.envMap!==undefined?a.envMap:null;this.combine=a.combine!==undefined?a.combine:THREE.MultiplyOperation;this.reflectivity=a.reflectivity!==undefined?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==undefined?a.refractionRatio:0.98;this.shading=
a.shading!==undefined?a.shading:THREE.SmoothShading;this.wireframe=a.wireframe!==undefined?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==undefined?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==undefined?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==undefined?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==undefined?a.vertexColors:!1;this.skinning=a.skinning!==undefined?a.skinning:!1;this.morphTargets=a.morphTargets!==undefined?
a.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshPhongMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.ambient=a.ambient!==undefined?new THREE.Color(a.ambient):new THREE.Color(328965);this.specular=a.specular!==undefined?new THREE.Color(a.specular):new THREE.Color(1118481);this.shininess=a.shininess!==undefined?a.shininess:30;this.map=a.map!==undefined?a.map:null;this.lightMap=a.lightMap!==undefined?a.lightMap:null;this.envMap=a.envMap!==undefined?
a.envMap:null;this.combine=a.combine!==undefined?a.combine:THREE.MultiplyOperation;this.reflectivity=a.reflectivity!==undefined?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==undefined?a.refractionRatio:0.98;this.shading=a.shading!==undefined?a.shading:THREE.SmoothShading;this.wireframe=a.wireframe!==undefined?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==undefined?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==undefined?a.wireframeLinecap:"round";this.wireframeLinejoin=
a.wireframeLinejoin!==undefined?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==undefined?a.vertexColors:!1;this.skinning=a.skinning!==undefined?a.skinning:!1;this.morphTargets=a.morphTargets!==undefined?a.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshDepthMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.shading=a.shading!==undefined?a.shading:THREE.SmoothShading;this.wireframe=a.wireframe!==undefined?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==undefined?a.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.shading=a.shading?a.shading:THREE.FlatShading;this.wireframe=a.wireframe?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth?a.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};
THREE.MeshShaderMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.fragmentShader=a.fragmentShader!==undefined?a.fragmentShader:"void main() {}";this.vertexShader=a.vertexShader!==undefined?a.vertexShader:"void main() {}";this.uniforms=a.uniforms!==undefined?a.uniforms:{};this.shading=a.shading!==undefined?a.shading:THREE.SmoothShading;this.wireframe=a.wireframe!==undefined?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==undefined?a.wireframeLinewidth:1;this.lights=a.lights!==
undefined?a.lights:!1;this.vertexColors=a.vertexColors!==undefined?a.vertexColors:!1;this.skinning=a.skinning!==undefined?a.skinning:!1;this.morphTargets=a.morphTargets!==undefined?a.morphTargets:!1};THREE.MeshShaderMaterial.prototype=new THREE.Material;THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial;
THREE.ParticleBasicMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.map=a.map!==undefined?a.map:null;this.size=a.size!==undefined?a.size:1;this.sizeAttenuation=a.sizeAttenuation!==undefined?a.sizeAttenuation:!0;this.vertexColors=a.vertexColors!==undefined?a.vertexColors:!1};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;
THREE.ShadowVolumeDynamicMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.map=a.map!==undefined?a.map:null;this.lightMap=a.lightMap!==undefined?a.lightMap:null;this.envMap=a.envMap!==undefined?a.envMap:null;this.combine=a.combine!==undefined?a.combine:THREE.MultiplyOperation;this.reflectivity=a.reflectivity!==undefined?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==undefined?a.refractionRatio:
0.98;this.shading=a.shading!==undefined?a.shading:THREE.SmoothShading;this.wireframe=a.wireframe!==undefined?a.wireframe:!1;this.wireframeLinewidth=a.wireframeLinewidth!==undefined?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==undefined?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==undefined?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==undefined?a.vertexColors:!1;this.skinning=a.skinning!==undefined?a.skinning:!1;this.morphTargets=a.morphTargets!==
undefined?a.morphTargets:!1};THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material;THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial;
THREE.Texture=function(a,c,d,g,f,i){this.image=a;this.mapping=c!==undefined?c:new THREE.UVMapping;this.wrapS=d!==undefined?d:THREE.ClampToEdgeWrapping;this.wrapT=g!==undefined?g:THREE.ClampToEdgeWrapping;this.magFilter=f!==undefined?f:THREE.LinearFilter;this.minFilter=i!==undefined?i:THREE.LinearMipMapLinearFilter;this.needsUpdate=!1};THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}};
THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;
THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;var Uniforms={clone:function(a){var c,d,g,f={};for(c in a){f[c]={};for(d in a[c]){g=a[c][d];f[c][d]=g instanceof THREE.Color||g instanceof THREE.Vector3||g instanceof THREE.Texture?g.clone():g}}return f},merge:function(a){var c,d,g,f={};for(c=0;c<a.length;c++){g=this.clone(a[c]);for(d in g)f[d]=g[d]}return f}};
THREE.Particle=function(a){THREE.Object3D.call(this);this.materials=a instanceof Array?a:[a];this.matrixAutoUpdate=!1};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;THREE.ParticleSystem=function(a,c){THREE.Object3D.call(this);this.geometry=a;this.materials=c instanceof Array?c:[c];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;
THREE.Line=function(a,c,d){THREE.Object3D.call(this);this.geometry=a;this.materials=c instanceof Array?c:[c];this.type=d!=undefined?d:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;
THREE.Mesh=function(a,c){THREE.Object3D.call(this);this.geometry=a;this.materials=c&&c.length?c:[c];this.flipSided=!1;this.doubleSided=!1;this.overdraw=!1;if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=a.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var d=0;d<this.geometry.morphTargets.length;d++){this.morphTargetInfluences.push(0);
this.morphTargetDictionary[this.geometry.morphTargets[d].name]=d}}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){if(this.morphTargetDictionary[a]!==undefined)return this.morphTargetDictionary[a];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};
THREE.Bone=function(a){THREE.Object3D.call(this);this.skin=a;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;
THREE.Bone.prototype.update=function(a,c,d){this.matrixAutoUpdate&&(c|=this.updateMatrix());if(c||this.matrixWorldNeedsUpdate){a?this.skinMatrix.multiply(a,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;c=!0}var g,f=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(g=0;g<f;g++){a=this.children[g];a instanceof THREE.Bone?a.update(this.skinMatrix,c,d):a.update(this.matrixWorld,!0,d)}}else for(g=0;g<f;g++)this.children[g].update(this.skinMatrix,
c,d)};THREE.Bone.prototype.addChild=function(a){if(this.children.indexOf(a)===-1){a.parent!==undefined&&a.parent.removeChild(a);a.parent=this;this.children.push(a);if(!(a instanceof THREE.Bone))this.hasNoneBoneChildren=!0}};if(!window.Float32Array)window.Float32Array=Array;
THREE.SkinnedMesh=function(a,c){THREE.Mesh.call(this,a,c);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var d,g,f,i,j,o;if(this.geometry.bones!==undefined){for(d=0;d<this.geometry.bones.length;d++){f=this.geometry.bones[d];i=f.pos;j=f.rotq;o=f.scl;g=this.addBone();g.name=f.name;g.position.set(i[0],i[1],i[2]);g.quaternion.set(j[0],j[1],j[2],j[3]);g.useQuaternion=!0;o!==undefined?g.scale.set(o[0],o[1],o[2]):g.scale.set(1,1,1)}for(d=0;d<this.bones.length;d++){f=this.geometry.bones[d];
g=this.bones[d];f.parent===-1?this.addChild(g):this.bones[f.parent].addChild(g)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;
THREE.SkinnedMesh.prototype.update=function(a,c,d){if(this.visible){this.matrixAutoUpdate&&(c|=this.updateMatrix());if(c||this.matrixWorldNeedsUpdate){a?this.matrixWorld.multiply(a,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;c=!0}var g,f=this.children.length;for(g=0;g<f;g++){a=this.children[g];a instanceof THREE.Bone?a.update(this.identityMatrix,!1,d):a.update(this.matrixWorld,c,d)}d=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(c=0;c<d;c++)ba[c].skinMatrix.flattenToArrayOffset(bm,
c*16)}};THREE.SkinnedMesh.prototype.addBone=function(a){a===undefined&&(a=new THREE.Bone(this));this.bones.push(a);return a};
THREE.SkinnedMesh.prototype.pose=function(){this.update(undefined,!0);for(var a,c=[],d=0;d<this.bones.length;d++){a=this.bones[d];c.push(THREE.Matrix4.makeInvert(a.skinMatrix));a.skinMatrix.flattenToArrayOffset(this.boneMatrices,d*16)}if(this.geometry.skinVerticesA===undefined){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var g;for(a=0;a<this.geometry.skinIndices.length;a++){d=this.geometry.vertices[a].position;var f=this.geometry.skinIndices[a].x,i=this.geometry.skinIndices[a].y;
g=new THREE.Vector3(d.x,d.y,d.z);this.geometry.skinVerticesA.push(c[f].multiplyVector3(g));g=new THREE.Vector3(d.x,d.y,d.z);this.geometry.skinVerticesB.push(c[i].multiplyVector3(g));if(this.geometry.skinWeights[a].x+this.geometry.skinWeights[a].y!==1){d=(1-(this.geometry.skinWeights[a].x+this.geometry.skinWeights[a].y))*0.5;this.geometry.skinWeights[a].x+=d;this.geometry.skinWeights[a].y+=d}}}};
THREE.Ribbon=function(a,c){THREE.Object3D.call(this);this.geometry=a;this.materials=c instanceof Array?c:[c];this.flipSided=!1;this.doubleSided=!1};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;
THREE.Sound=function(a,c,d,g){THREE.Object3D.call(this);this.isLoaded=!1;this.isAddedToDOM=!1;this.isPlaying=!1;this.duration=-1;this.radius=c!==undefined?Math.abs(c):100;this.volume=Math.min(1,Math.max(0,d!==undefined?d:1));this.domElement=document.createElement("audio");this.domElement.volume=0;this.domElement.pan=0;this.domElement.loop=g!==undefined?g:!0;this.sources=a instanceof Array?a:[a];var f;d=this.sources.length;for(a=0;a<d;a++){c=this.sources[a];c.toLowerCase();if(c.indexOf(".mp3")!==-1)f=
"audio/mpeg";else if(c.indexOf(".ogg")!==-1)f="audio/ogg";else c.indexOf(".wav")!==-1&&(f="audio/wav");if(this.domElement.canPlayType(f)){f=document.createElement("source");f.src=this.sources[a];this.domElement.THREESound=this;this.domElement.appendChild(f);this.domElement.addEventListener("canplay",this.onLoad,!0);this.domElement.load();break}}};THREE.Sound.prototype=new THREE.Object3D;THREE.Sound.prototype.constructor=THREE.Sound;THREE.Sound.prototype.supr=THREE.Object3D.prototype;
THREE.Sound.prototype.onLoad=function(){var a=this.THREESound;if(!a.isLoaded){this.removeEventListener("canplay",this.onLoad,!0);a.isLoaded=!0;a.duration=this.duration;a.isPlaying&&a.play()}};THREE.Sound.prototype.addToDOM=function(a){this.isAddedToDOM=!0;a.appendChild(this.domElement)};THREE.Sound.prototype.play=function(a){this.isPlaying=!0;if(this.isLoaded){this.domElement.play();if(a)this.domElement.currentTime=a%this.duration}};THREE.Sound.prototype.pause=function(){this.isPlaying=!1;this.domElement.pause()};
THREE.Sound.prototype.stop=function(){this.isPlaying=!1;this.domElement.pause();this.domElement.currentTime=0};THREE.Sound.prototype.calculateVolumeAndPan=function(a){a=a.length();this.domElement.volume=a<=this.radius?this.volume*(1-a/this.radius):0};
THREE.Sound.prototype.update=function(a,c,d){if(this.matrixAutoUpdate){this.matrix.setPosition(this.position);c=!0}if(c||this.matrixWorldNeedsUpdate){a?this.matrixWorld.multiply(a,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;c=!0}var g=this.children.length;for(a=0;a<g;a++)this.children[a].update(this.matrixWorld,c,d)};THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;
THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.add=function(a,c){c===undefined&&(c=0);c=Math.abs(c);for(var d=0;d<this.LODs.length;d++)if(c<this.LODs[d].visibleAtDistance)break;this.LODs.splice(d,0,{visibleAtDistance:c,object3D:a});this.addChild(a)};
THREE.LOD.prototype.update=function(a,c,d){this.matrixAutoUpdate&&(c|=this.updateMatrix());if(c||this.matrixWorldNeedsUpdate){a?this.matrixWorld.multiply(a,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=!1;c=!0}if(this.LODs.length>1){a=d.matrixWorldInverse;a=-(a.n31*this.position.x+a.n32*this.position.y+a.n33*this.position.z+a.n34);this.LODs[0].object3D.visible=!0;for(var g=1;g<this.LODs.length;g++)if(a>=this.LODs[g].visibleAtDistance){this.LODs[g-1].object3D.visible=
!1;this.LODs[g].object3D.visible=!0}else break;for(;g<this.LODs.length;g++)this.LODs[g].object3D.visible=!1}for(a=0;a<this.children.length;a++)this.children[a].update(this.matrixWorld,c,d)};THREE.ShadowVolume=function(a,c){THREE.Mesh.call(this,a.geometry,c?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);a.addChild(this);this.calculateShadowVolumeGeometry(a.geometry)};THREE.ShadowVolume.prototype=new THREE.Mesh;THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume;
THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype;
THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(a){this.geometry=new THREE.Geometry;this.geometry.boundingSphere=a.boundingSphere;this.geometry.edgeFaces=[];var c=this.geometry.vertices,d=this.geometry.faces,g=this.geometry.edgeFaces,f=a.faces;a=a.vertices;var i=f.length,j,o,p,v,x,y=["a","b","c","d"];for(p=0;p<i;p++){o=c.length;j=f[p];if(j instanceof THREE.Face4){v=4;o=new THREE.Face4(o,o+1,o+2,o+3)}else{v=3;o=new THREE.Face3(o,o+1,o+2)}o.normal.copy(j.normal);d.push(o);for(o=
0;o<v;o++){x=a[j[y[o]]];c.push(new THREE.Vertex(x.position.clone()))}}for(i=0;i<f.length-1;i++){a=d[i];for(j=i+1;j<f.length;j++){o=d[j];o=this.facesShareEdge(c,a,o);if(o!==undefined){o=new THREE.Face4(o.indices[0],o.indices[3],o.indices[2],o.indices[1]);o.normal.set(1,0,0);g.push(o)}}}};
THREE.ShadowVolume.prototype.facesShareEdge=function(a,c,d){var g,f,i,j,o,p,v,x,y,D,z,K,M,T=0,O=["a","b","c","d"];g=c instanceof THREE.Face4?4:3;f=d instanceof THREE.Face4?4:3;for(K=0;K<g;K++){i=c[O[K]];o=a[i];for(M=0;M<f;M++){j=d[O[M]];p=a[j];if(Math.abs(o.position.x-p.position.x)<1.0E-4&&Math.abs(o.position.y-p.position.y)<1.0E-4&&Math.abs(o.position.z-p.position.z)<1.0E-4){T++;if(T===1){v=o;x=p;y=i;D=j;z=O[K]}if(T===2){z+=O[K];return z==="ad"||z==="ac"?{faces:[c,d],vertices:[v,x,p,o],indices:[y,
D,j,i],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[c,d],vertices:[v,o,p,x],indices:[y,i,j,D],vertexTypes:[1,1,2,2],extrudable:!0}}}}}};THREE.Scene=function(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.fog=null;this.objects=[];this.lights=[];this.sounds=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;
THREE.Scene.prototype.addChild=function(a){this.supr.addChild.call(this,a);this.addChildRecurse(a)};THREE.Scene.prototype.addChildRecurse=function(a){if(a instanceof THREE.Light)this.lights.indexOf(a)===-1&&this.lights.push(a);else if(a instanceof THREE.Sound)this.sounds.indexOf(a)===-1&&this.sounds.push(a);else if(!(a instanceof THREE.Camera||a instanceof THREE.Bone)&&this.objects.indexOf(a)===-1){this.objects.push(a);this.__objectsAdded.push(a)}for(var c=0;c<a.children.length;c++)this.addChildRecurse(a.children[c])};
THREE.Scene.prototype.removeChild=function(a){this.supr.removeChild.call(this,a);this.removeChildRecurse(a)};THREE.Scene.prototype.removeChildRecurse=function(a){if(a instanceof THREE.Light){var c=this.lights.indexOf(a);c!==-1&&this.lights.splice(c,1)}else if(a instanceof THREE.Sound){c=this.sounds.indexOf(a);c!==-1&&this.sounds.splice(c,1)}else if(!(a instanceof THREE.Camera)){c=this.objects.indexOf(a);if(c!==-1){this.objects.splice(c,1);this.__objectsRemoved.push(a)}}for(c=0;c<a.children.length;c++)this.removeChildRecurse(a.children[c])};
THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild;THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild;THREE.Fog=function(a,c,d){this.color=new THREE.Color(a);this.near=c||1;this.far=d||1E3};THREE.FogExp2=function(a,c){this.color=new THREE.Color(a);this.density=c!==undefined?c:2.5E-4};
THREE.Projector=function(){function a(){var b=p[o]=p[o]||new THREE.RenderableVertex;o++;return b}function c(b,Q){return Q.z-b.z}function d(b,Q){var la=0,Ba=1,Ca=b.z+b.w,ta=Q.z+Q.w,W=-b.z+b.w,na=-Q.z+Q.w;if(Ca>=0&&ta>=0&&W>=0&&na>=0)return!0;else if(Ca<0&&ta<0||W<0&&na<0)return!1;else{if(Ca<0)la=Math.max(la,Ca/(Ca-ta));else ta<0&&(Ba=Math.min(Ba,Ca/(Ca-ta)));if(W<0)la=Math.max(la,W/(W-na));else na<0&&(Ba=Math.min(Ba,W/(W-na)));if(Ba<la)return!1;else{b.lerpSelf(Q,la);Q.lerpSelf(b,1-Ba);return!0}}}var g,
f,i=[],j,o,p=[],v,x,y=[],D,z=[],K,M,T=[],O,pa,Y=[],qa=new THREE.Vector4,V=new THREE.Vector4,E=new THREE.Matrix4,Fa=new THREE.Matrix4,ka=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],Da=new THREE.Vector4,$=new THREE.Vector4;this.projectVector=function(b,Q){E.multiply(Q.projectionMatrix,Q.matrixWorldInverse);E.multiplyVector3(b);return b};this.unprojectVector=function(b,Q){E.multiply(Q.matrixWorld,THREE.Matrix4.makeInvert(Q.projectionMatrix));
E.multiplyVector3(b);return b};this.projectObjects=function(b,Q,la){Q=[];var Ba,Ca,ta;f=0;Ca=b.objects;b=0;for(Ba=Ca.length;b<Ba;b++){ta=Ca[b];var W;if(!(W=!ta.visible))if(W=ta instanceof THREE.Mesh){a:{W=void 0;for(var na=ta.matrixWorld,aa=-ta.geometry.boundingSphere.radius*Math.max(ta.scale.x,Math.max(ta.scale.y,ta.scale.z)),oa=0;oa<6;oa++){W=ka[oa].x*na.n14+ka[oa].y*na.n24+ka[oa].z*na.n34+ka[oa].w;if(W<=aa){W=!1;break a}}W=!0}W=!W}if(!W){W=i[f]=i[f]||new THREE.RenderableObject;f++;g=W;qa.copy(ta.position);
E.multiplyVector3(qa);g.object=ta;g.z=qa.z;Q.push(g)}}la&&Q.sort(c);return Q};this.projectScene=function(b,Q,la){var Ba=[],Ca=Q.near,ta=Q.far,W,na,aa,oa,U,ra,ma,xa,ua,ca,La,Qa,Ra,cb,Na,ab,Ta;pa=M=D=x=0;Q.matrixAutoUpdate&&Q.updateMatrix();b.update(undefined,!1,Q);E.multiply(Q.projectionMatrix,Q.matrixWorldInverse);ka[0].set(E.n41-E.n11,E.n42-E.n12,E.n43-E.n13,E.n44-E.n14);ka[1].set(E.n41+E.n11,E.n42+E.n12,E.n43+E.n13,E.n44+E.n14);ka[2].set(E.n41+E.n21,E.n42+E.n22,E.n43+E.n23,E.n44+E.n24);ka[3].set(E.n41-
E.n21,E.n42-E.n22,E.n43-E.n23,E.n44-E.n24);ka[4].set(E.n41-E.n31,E.n42-E.n32,E.n43-E.n33,E.n44-E.n34);ka[5].set(E.n41+E.n31,E.n42+E.n32,E.n43+E.n33,E.n44+E.n34);for(W=0;W<6;W++){ua=ka[W];ua.divideScalar(Math.sqrt(ua.x*ua.x+ua.y*ua.y+ua.z*ua.z))}ua=this.projectObjects(b,Q,!0);b=0;for(W=ua.length;b<W;b++){ca=ua[b].object;if(ca.visible){La=ca.matrixWorld;Qa=ca.matrixRotationWorld;Ra=ca.materials;cb=ca.overdraw;o=0;if(ca instanceof THREE.Mesh){Na=ca.geometry;oa=Na.vertices;ab=Na.faces;Na=Na.faceVertexUvs;
na=0;for(aa=oa.length;na<aa;na++){j=a();j.positionWorld.copy(oa[na].position);La.multiplyVector3(j.positionWorld);j.positionScreen.copy(j.positionWorld);E.multiplyVector4(j.positionScreen);j.positionScreen.x/=j.positionScreen.w;j.positionScreen.y/=j.positionScreen.w;j.visible=j.positionScreen.z>Ca&&j.positionScreen.z<ta}oa=0;for(na=ab.length;oa<na;oa++){aa=ab[oa];if(aa instanceof THREE.Face3){U=p[aa.a];ra=p[aa.b];ma=p[aa.c];if(U.visible&&ra.visible&&ma.visible&&(ca.doubleSided||ca.flipSided!=(ma.positionScreen.x-
U.positionScreen.x)*(ra.positionScreen.y-U.positionScreen.y)-(ma.positionScreen.y-U.positionScreen.y)*(ra.positionScreen.x-U.positionScreen.x)<0)){xa=y[x]=y[x]||new THREE.RenderableFace3;x++;v=xa;v.v1.copy(U);v.v2.copy(ra);v.v3.copy(ma)}else continue}else if(aa instanceof THREE.Face4){U=p[aa.a];ra=p[aa.b];ma=p[aa.c];xa=p[aa.d];if(U.visible&&ra.visible&&ma.visible&&xa.visible&&(ca.doubleSided||ca.flipSided!=((xa.positionScreen.x-U.positionScreen.x)*(ra.positionScreen.y-U.positionScreen.y)-(xa.positionScreen.y-
U.positionScreen.y)*(ra.positionScreen.x-U.positionScreen.x)<0||(ra.positionScreen.x-ma.positionScreen.x)*(xa.positionScreen.y-ma.positionScreen.y)-(ra.positionScreen.y-ma.positionScreen.y)*(xa.positionScreen.x-ma.positionScreen.x)<0))){Ta=z[D]=z[D]||new THREE.RenderableFace4;D++;v=Ta;v.v1.copy(U);v.v2.copy(ra);v.v3.copy(ma);v.v4.copy(xa)}else continue}v.normalWorld.copy(aa.normal);Qa.multiplyVector3(v.normalWorld);v.centroidWorld.copy(aa.centroid);La.multiplyVector3(v.centroidWorld);v.centroidScreen.copy(v.centroidWorld);
E.multiplyVector3(v.centroidScreen);ma=aa.vertexNormals;U=0;for(ra=ma.length;U<ra;U++){xa=v.vertexNormalsWorld[U];xa.copy(ma[U]);Qa.multiplyVector3(xa)}U=0;for(ra=Na.length;U<ra;U++)if(Ta=Na[U][oa]){ma=0;for(xa=Ta.length;ma<xa;ma++)v.uvs[U][ma]=Ta[ma]}v.meshMaterials=Ra;v.faceMaterials=aa.materials;v.overdraw=cb;v.z=v.centroidScreen.z;Ba.push(v)}}else if(ca instanceof THREE.Line){Fa.multiply(E,La);oa=ca.geometry.vertices;U=a();U.positionScreen.copy(oa[0].position);Fa.multiplyVector4(U.positionScreen);
na=1;for(aa=oa.length;na<aa;na++){U=a();U.positionScreen.copy(oa[na].position);Fa.multiplyVector4(U.positionScreen);ra=p[o-2];Da.copy(U.positionScreen);$.copy(ra.positionScreen);if(d(Da,$)){Da.multiplyScalar(1/Da.w);$.multiplyScalar(1/$.w);La=T[M]=T[M]||new THREE.RenderableLine;M++;K=La;K.v1.positionScreen.copy(Da);K.v2.positionScreen.copy($);K.z=Math.max(Da.z,$.z);K.materials=ca.materials;Ba.push(K)}}}else if(ca instanceof THREE.Particle){V.set(ca.position.x,ca.position.y,ca.position.z,1);E.multiplyVector4(V);
V.z/=V.w;if(V.z>0&&V.z<1){La=Y[pa]=Y[pa]||new THREE.RenderableParticle;pa++;O=La;O.x=V.x/V.w;O.y=V.y/V.w;O.z=V.z;O.rotation=ca.rotation.z;O.scale.x=ca.scale.x*Math.abs(O.x-(V.x+Q.projectionMatrix.n11)/(V.w+Q.projectionMatrix.n14));O.scale.y=ca.scale.y*Math.abs(O.y-(V.y+Q.projectionMatrix.n22)/(V.w+Q.projectionMatrix.n24));O.materials=ca.materials;Ba.push(O)}}}}la&&Ba.sort(c);return Ba}};
THREE.SoundRenderer=function(){this.volume=1;this.domElement=document.createElement("div");this.domElement.id="THREESound";this.cameraPosition=new THREE.Vector3;this.soundPosition=new THREE.Vector3;this.render=function(a,c,d){d&&a.update(undefined,!1,c);d=a.sounds;var g,f=d.length;for(g=0;g<f;g++){a=d[g];this.soundPosition.set(a.matrixWorld.n14,a.matrixWorld.n24,a.matrixWorld.n34);this.soundPosition.subSelf(c.position);if(a.isPlaying&&a.isLoaded){a.isAddedToDOM||a.addToDOM(this.domElement);a.calculateVolumeAndPan(this.soundPosition)}}}};
THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",
envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",
envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",
map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",
lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",
lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",
lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",
default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",
value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},
fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}}};
THREE.ShaderLib={lensFlare:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nuniform    int         renderPink;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nif( renderPink == 1 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}\n}"},
shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main(void)\n{\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main( void )\n{\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm )), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",
fragmentShader:"void main() {\ngl_FragColor = vec4( 1, 1, 1, 1 );\n}"},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},
normal:{uniforms:{opacity:{type:"f",value:1}},fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",
THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,
THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:Uniforms.merge([THREE.UniformsLib.common,
THREE.UniformsLib.lights]),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,
THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:Uniforms.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",
THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),
vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",
THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}};
THREE.WebGLRenderer=function(a){function c(e,m,k){var h,n,u,r=e.vertices,t=r.length,q=e.colors,A=q.length,s=e.__vertexArray,G=e.__colorArray,B=e.__sortArray,L=e.__dirtyVertices,I=e.__dirtyColors;if(k.sortParticles){ca.multiplySelf(k.matrixWorld);for(h=0;h<t;h++){n=r[h].position;Ra.copy(n);ca.multiplyVector3(Ra);B[h]=[Ra.z,h]}B.sort(function(P,N){return N[0]-P[0]});for(h=0;h<t;h++){n=r[B[h][1]].position;u=h*3;s[u]=n.x;s[u+1]=n.y;s[u+2]=n.z}for(h=0;h<A;h++){u=h*3;color=q[B[h][1]];G[u]=color.r;G[u+1]=
color.g;G[u+2]=color.b}}else{if(L)for(h=0;h<t;h++){n=r[h].position;u=h*3;s[u]=n.x;s[u+1]=n.y;s[u+2]=n.z}if(I)for(h=0;h<A;h++){color=q[h];u=h*3;G[u]=color.r;G[u+1]=color.g;G[u+2]=color.b}}if(L||k.sortParticles){b.bindBuffer(b.ARRAY_BUFFER,e.__webglVertexBuffer);b.bufferData(b.ARRAY_BUFFER,s,m)}if(I||k.sortParticles){b.bindBuffer(b.ARRAY_BUFFER,e.__webglColorBuffer);b.bufferData(b.ARRAY_BUFFER,G,m)}}function d(e,m){e.uniforms=Uniforms.clone(m.uniforms);e.vertexShader=m.vertexShader;e.fragmentShader=
m.fragmentShader}function g(e,m,k,h,n){h.__webglProgram||ta.initMaterial(h,m,k,n);var u=h.program,r=u.uniforms,t=h.uniforms;if(u!=la){b.useProgram(u);la=u}b.uniformMatrix4fv(r.projectionMatrix,!1,La);if(k&&(h instanceof THREE.MeshBasicMaterial||h instanceof THREE.MeshLambertMaterial||h instanceof THREE.MeshPhongMaterial||h instanceof THREE.LineBasicMaterial||h instanceof THREE.ParticleBasicMaterial)){t.fogColor.value.setHex(k.color.hex);if(k instanceof THREE.Fog){t.fogNear.value=k.near;t.fogFar.value=
k.far}else if(k instanceof THREE.FogExp2)t.fogDensity.value=k.density}if(h instanceof THREE.MeshPhongMaterial||h instanceof THREE.MeshLambertMaterial||h.lights){var q,A,s=0,G=0,B=0,L,I,P,N,R=cb,C=R.directional.colors,F=R.directional.positions,J=R.point.colors,da=R.point.positions,ya=R.point.distances,Oa=0,ea=0;k=A=N=0;for(q=m.length;k<q;k++){A=m[k];L=A.color;I=A.position;P=A.intensity;N=A.distance;if(A instanceof THREE.AmbientLight){s+=L.r;G+=L.g;B+=L.b}else if(A instanceof THREE.DirectionalLight){N=
Oa*3;C[N]=L.r*P;C[N+1]=L.g*P;C[N+2]=L.b*P;F[N]=I.x;F[N+1]=I.y;F[N+2]=I.z;Oa+=1}else if(A instanceof THREE.PointLight){A=ea*3;J[A]=L.r*P;J[A+1]=L.g*P;J[A+2]=L.b*P;da[A]=I.x;da[A+1]=I.y;da[A+2]=I.z;ya[ea]=N;ea+=1}}for(k=Oa*3;k<C.length;k++)C[k]=0;for(k=ea*3;k<J.length;k++)J[k]=0;R.point.length=ea;R.directional.length=Oa;R.ambient[0]=s;R.ambient[1]=G;R.ambient[2]=B;k=cb;t.enableLighting.value=k.directional.length+k.point.length;t.ambientLightColor.value=k.ambient;t.directionalLightColor.value=k.directional.colors;
t.directionalLightDirection.value=k.directional.positions;t.pointLightColor.value=k.point.colors;t.pointLightPosition.value=k.point.positions;t.pointLightDistance.value=k.point.distances}if(h instanceof THREE.MeshBasicMaterial||h instanceof THREE.MeshLambertMaterial||h instanceof THREE.MeshPhongMaterial){t.diffuse.value.setRGB(h.color.r,h.color.g,h.color.b);t.opacity.value=h.opacity;t.map.texture=h.map;t.lightMap.texture=h.lightMap;t.envMap.texture=h.envMap;t.reflectivity.value=h.reflectivity;t.refractionRatio.value=
h.refractionRatio;t.combine.value=h.combine;t.useRefract.value=h.envMap&&h.envMap.mapping instanceof THREE.CubeRefractionMapping}if(h instanceof THREE.LineBasicMaterial){t.diffuse.value.setRGB(h.color.r,h.color.g,h.color.b);t.opacity.value=h.opacity}else if(h instanceof THREE.ParticleBasicMaterial){t.psColor.value.setRGB(h.color.r,h.color.g,h.color.b);t.opacity.value=h.opacity;t.size.value=h.size;t.scale.value=Q.height/2;t.map.texture=h.map}else if(h instanceof THREE.MeshPhongMaterial){t.ambient.value.setRGB(h.ambient.r,
h.ambient.g,h.ambient.b);t.specular.value.setRGB(h.specular.r,h.specular.g,h.specular.b);t.shininess.value=h.shininess}else if(h instanceof THREE.MeshDepthMaterial){t.mNear.value=e.near;t.mFar.value=e.far;t.opacity.value=h.opacity}else if(h instanceof THREE.MeshNormalMaterial)t.opacity.value=h.opacity;for(var X in t)if(G=u.uniforms[X]){q=t[X];s=q.type;k=q.value;if(s=="i")b.uniform1i(G,k);else if(s=="f")b.uniform1f(G,k);else if(s=="fv1")b.uniform1fv(G,k);else if(s=="fv")b.uniform3fv(G,k);else if(s==
"v2")b.uniform2f(G,k.x,k.y);else if(s=="v3")b.uniform3f(G,k.x,k.y,k.z);else if(s=="c")b.uniform3f(G,k.r,k.g,k.b);else if(s=="t"){b.uniform1i(G,k);if(q=q.texture)if(q.image instanceof Array&&q.image.length==6){if(q.image.length==6){if(q.needsUpdate){if(q.__webglInit){b.bindTexture(b.TEXTURE_CUBE_MAP,q.image.__webglTextureCube);for(s=0;s<6;++s)b.texSubImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,0,0,b.RGBA,b.UNSIGNED_BYTE,q.image[s])}else{q.image.__webglTextureCube=b.createTexture();b.bindTexture(b.TEXTURE_CUBE_MAP,
q.image.__webglTextureCube);for(s=0;s<6;++s)b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,q.image[s]);q.__webglInit=!0}V(b.TEXTURE_CUBE_MAP,q,q.image[0]);b.bindTexture(b.TEXTURE_CUBE_MAP,null);q.needsUpdate=!1}b.activeTexture(b.TEXTURE0+k);b.bindTexture(b.TEXTURE_CUBE_MAP,q.image.__webglTextureCube)}}else E(q,k)}}b.uniformMatrix4fv(r.modelViewMatrix,!1,n._modelViewMatrixArray);b.uniformMatrix3fv(r.normalMatrix,!1,n._normalMatrixArray);(h instanceof THREE.MeshShaderMaterial||
h instanceof THREE.MeshPhongMaterial||h.envMap)&&b.uniform3f(r.cameraPosition,e.position.x,e.position.y,e.position.z);(h instanceof THREE.MeshShaderMaterial||h.envMap||h.skinning)&&b.uniformMatrix4fv(r.objectMatrix,!1,n._objectMatrixArray);(h instanceof THREE.MeshPhongMaterial||h instanceof THREE.MeshLambertMaterial||h instanceof THREE.MeshShaderMaterial||h.skinning)&&b.uniformMatrix4fv(r.viewMatrix,!1,Qa);if(h instanceof THREE.ShadowVolumeDynamicMaterial){e=t.directionalLightDirection.value;e[0]=
-m.position.x;e[1]=-m.position.y;e[2]=-m.position.z;b.uniform3fv(r.directionalLightDirection,e);b.uniformMatrix4fv(r.objectMatrix,!1,n._objectMatrixArray);b.uniformMatrix4fv(r.viewMatrix,!1,Qa)}if(h.skinning){b.uniformMatrix4fv(r.cameraInverseMatrix,!1,Qa);b.uniformMatrix4fv(r.boneGlobalMatrices,!1,n.boneMatrices)}return u}function f(e,m,k,h,n,u){if(h.opacity!=0){e=g(e,m,k,h,u).attributes;if(h.morphTargets){m=h.program.attributes;u.morphTargetBase!==-1?b.bindBuffer(b.ARRAY_BUFFER,n.__webglMorphTargetsBuffers[u.morphTargetBase]):
b.bindBuffer(b.ARRAY_BUFFER,n.__webglVertexBuffer);b.vertexAttribPointer(m.position,3,b.FLOAT,!1,0,0);if(u.morphTargetForcedOrder.length){k=0;for(var r=u.morphTargetForcedOrder,t=u.morphTargetInfluences;k<h.numSupportedMorphTargets&&k<r.length;){b.bindBuffer(b.ARRAY_BUFFER,n.__webglMorphTargetsBuffers[r[k]]);b.vertexAttribPointer(m["morphTarget"+k],3,b.FLOAT,!1,0,0);u.__webglMorphTargetInfluences[k]=t[r[k]];k++}}else{r=[];var q=-1,A=0;t=u.morphTargetInfluences;var s,G=t.length;k=0;for(u.morphTargetBase!==
-1&&(r[u.morphTargetBase]=!0);k<h.numSupportedMorphTargets;){for(s=0;s<G;s++)if(!r[s]&&t[s]>q){A=s;q=t[A]}b.bindBuffer(b.ARRAY_BUFFER,n.__webglMorphTargetsBuffers[A]);b.vertexAttribPointer(m["morphTarget"+k],3,b.FLOAT,!1,0,0);u.__webglMorphTargetInfluences[k]=q;r[A]=1;q=-1;k++}}b.uniform1fv(h.program.uniforms.morphTargetInfluences,u.__webglMorphTargetInfluences)}else{b.bindBuffer(b.ARRAY_BUFFER,n.__webglVertexBuffer);b.vertexAttribPointer(e.position,3,b.FLOAT,!1,0,0)}if(e.color>=0){b.bindBuffer(b.ARRAY_BUFFER,
n.__webglColorBuffer);b.vertexAttribPointer(e.color,3,b.FLOAT,!1,0,0)}if(e.normal>=0){b.bindBuffer(b.ARRAY_BUFFER,n.__webglNormalBuffer);b.vertexAttribPointer(e.normal,3,b.FLOAT,!1,0,0)}if(e.tangent>=0){b.bindBuffer(b.ARRAY_BUFFER,n.__webglTangentBuffer);b.vertexAttribPointer(e.tangent,4,b.FLOAT,!1,0,0)}if(e.uv>=0)if(n.__webglUVBuffer){b.bindBuffer(b.ARRAY_BUFFER,n.__webglUVBuffer);b.vertexAttribPointer(e.uv,2,b.FLOAT,!1,0,0);b.enableVertexAttribArray(e.uv)}else b.disableVertexAttribArray(e.uv);if(e.uv2>=
0)if(n.__webglUV2Buffer){b.bindBuffer(b.ARRAY_BUFFER,n.__webglUV2Buffer);b.vertexAttribPointer(e.uv2,2,b.FLOAT,!1,0,0);b.enableVertexAttribArray(e.uv2)}else b.disableVertexAttribArray(e.uv2);if(h.skinning&&e.skinVertexA>=0&&e.skinVertexB>=0&&e.skinIndex>=0&&e.skinWeight>=0){b.bindBuffer(b.ARRAY_BUFFER,n.__webglSkinVertexABuffer);b.vertexAttribPointer(e.skinVertexA,4,b.FLOAT,!1,0,0);b.bindBuffer(b.ARRAY_BUFFER,n.__webglSkinVertexBBuffer);b.vertexAttribPointer(e.skinVertexB,4,b.FLOAT,!1,0,0);b.bindBuffer(b.ARRAY_BUFFER,
n.__webglSkinIndicesBuffer);b.vertexAttribPointer(e.skinIndex,4,b.FLOAT,!1,0,0);b.bindBuffer(b.ARRAY_BUFFER,n.__webglSkinWeightsBuffer);b.vertexAttribPointer(e.skinWeight,4,b.FLOAT,!1,0,0)}if(u instanceof THREE.Mesh)if(h.wireframe){b.lineWidth(h.wireframeLinewidth);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer);b.drawElements(b.LINES,n.__webglLineCount,b.UNSIGNED_SHORT,0)}else{b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer);b.drawElements(b.TRIANGLES,n.__webglFaceCount,b.UNSIGNED_SHORT,
0)}else if(u instanceof THREE.Line){u=u.type==THREE.LineStrip?b.LINE_STRIP:b.LINES;b.lineWidth(h.linewidth);b.drawArrays(u,0,n.__webglLineCount)}else if(u instanceof THREE.ParticleSystem)b.drawArrays(b.POINTS,0,n.__webglParticleCount);else u instanceof THREE.Ribbon&&b.drawArrays(b.TRIANGLE_STRIP,0,n.__webglVertexCount)}}function i(e,m){if(!e.__webglVertexBuffer)e.__webglVertexBuffer=b.createBuffer();if(!e.__webglNormalBuffer)e.__webglNormalBuffer=b.createBuffer();if(e.hasPos){b.bindBuffer(b.ARRAY_BUFFER,
e.__webglVertexBuffer);b.bufferData(b.ARRAY_BUFFER,e.positionArray,b.DYNAMIC_DRAW);b.enableVertexAttribArray(m.attributes.position);b.vertexAttribPointer(m.attributes.position,3,b.FLOAT,!1,0,0)}if(e.hasNormal){b.bindBuffer(b.ARRAY_BUFFER,e.__webglNormalBuffer);b.bufferData(b.ARRAY_BUFFER,e.normalArray,b.DYNAMIC_DRAW);b.enableVertexAttribArray(m.attributes.normal);b.vertexAttribPointer(m.attributes.normal,3,b.FLOAT,!1,0,0)}b.drawArrays(b.TRIANGLES,0,e.count);e.count=0}function j(e){if(W!=e.doubleSided){e.doubleSided?
b.disable(b.CULL_FACE):b.enable(b.CULL_FACE);W=e.doubleSided}if(na!=e.flipSided){e.flipSided?b.frontFace(b.CW):b.frontFace(b.CCW);na=e.flipSided}}function o(e){if(oa!=e){e?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST);oa=e}}function p(e){ua[0].set(e.n41-e.n11,e.n42-e.n12,e.n43-e.n13,e.n44-e.n14);ua[1].set(e.n41+e.n11,e.n42+e.n12,e.n43+e.n13,e.n44+e.n14);ua[2].set(e.n41+e.n21,e.n42+e.n22,e.n43+e.n23,e.n44+e.n24);ua[3].set(e.n41-e.n21,e.n42-e.n22,e.n43-e.n23,e.n44-e.n24);ua[4].set(e.n41-e.n31,e.n42-
e.n32,e.n43-e.n33,e.n44-e.n34);ua[5].set(e.n41+e.n31,e.n42+e.n32,e.n43+e.n33,e.n44+e.n34);var m;for(e=0;e<6;e++){m=ua[e];m.divideScalar(Math.sqrt(m.x*m.x+m.y*m.y+m.z*m.z))}}function v(e){for(var m=e.matrixWorld,k=-e.geometry.boundingSphere.radius*Math.max(e.scale.x,Math.max(e.scale.y,e.scale.z)),h=0;h<6;h++){e=ua[h].x*m.n14+ua[h].y*m.n24+ua[h].z*m.n34+ua[h].w;if(e<=k)return!1}return!0}function x(e,m){e.list[e.count]=m;e.count+=1}function y(e){var m,k,h=e.object,n=e.opaque,u=e.transparent;u.count=
0;e=n.count=0;for(m=h.materials.length;e<m;e++){k=h.materials[e];k.transparent?x(u,k):x(n,k)}}function D(e){var m,k,h,n,u=e.object,r=e.buffer,t=e.opaque,q=e.transparent;q.count=0;e=t.count=0;for(h=u.materials.length;e<h;e++){m=u.materials[e];if(m instanceof THREE.MeshFaceMaterial){m=0;for(k=r.materials.length;m<k;m++)(n=r.materials[m])&&(n.transparent?x(q,n):x(t,n))}else(n=m)&&(n.transparent?x(q,n):x(t,n))}}function z(e,m){return m.z-e.z}function K(e){b.enable(b.POLYGON_OFFSET_FILL);b.polygonOffset(0.1,
1);b.enable(b.STENCIL_TEST);b.depthMask(!1);b.colorMask(!1,!1,!1,!1);b.stencilFunc(b.ALWAYS,1,255);b.stencilOpSeparate(b.BACK,b.KEEP,b.INCR,b.KEEP);b.stencilOpSeparate(b.FRONT,b.KEEP,b.DECR,b.KEEP);var m,k=e.lights.length,h,n=e.lights,u=[],r,t,q,A,s,G=e.__webglShadowVolumes.length;for(m=0;m<k;m++){h=e.lights[m];if(h instanceof THREE.DirectionalLight){u[0]=-h.position.x;u[1]=-h.position.y;u[2]=-h.position.z;for(s=0;s<G;s++){h=e.__webglShadowVolumes[s].object;r=e.__webglShadowVolumes[s].buffer;t=h.materials[0];
t.program||ta.initMaterial(t,n,undefined,h);t=t.program;q=t.uniforms;A=t.attributes;if(la!==t){b.useProgram(t);la=t;b.uniformMatrix4fv(q.projectionMatrix,!1,La);b.uniformMatrix4fv(q.viewMatrix,!1,Qa);b.uniform3fv(q.directionalLightDirection,u)}h.matrixWorld.flattenToArray(h._objectMatrixArray);b.uniformMatrix4fv(q.objectMatrix,!1,h._objectMatrixArray);b.bindBuffer(b.ARRAY_BUFFER,r.__webglVertexBuffer);b.vertexAttribPointer(A.position,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ARRAY_BUFFER,r.__webglNormalBuffer);
b.vertexAttribPointer(A.normal,3,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,r.__webglFaceBuffer);b.cullFace(b.FRONT);b.drawElements(b.TRIANGLES,r.__webglFaceCount,b.UNSIGNED_SHORT,0);b.cullFace(b.BACK);b.drawElements(b.TRIANGLES,r.__webglFaceCount,b.UNSIGNED_SHORT,0)}}}b.disable(b.POLYGON_OFFSET_FILL);b.colorMask(!0,!0,!0,!0);b.stencilFunc(b.NOTEQUAL,0,255);b.stencilOp(b.KEEP,b.KEEP,b.KEEP);b.disable(b.DEPTH_TEST);aa="";la=S.program;b.useProgram(S.program);b.uniformMatrix4fv(S.projectionLocation,
!1,La);b.uniform1f(S.darknessLocation,S.darkness);b.bindBuffer(b.ARRAY_BUFFER,S.vertexBuffer);b.vertexAttribPointer(S.vertexLocation,3,b.FLOAT,!1,0,0);b.enableVertexAttribArray(S.vertexLocation);b.blendFunc(b.ONE,b.ONE_MINUS_SRC_ALPHA);b.blendEquation(b.FUNC_ADD);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,S.elementBuffer);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0);b.disable(b.STENCIL_TEST);b.enable(b.DEPTH_TEST);b.depthMask(Ca)}function M(e,m){var k,h,n,u=e.__webglLensFlares.length,r,t,q;r=new THREE.Vector3;
var A=xa/ma;t=ma*0.5;q=xa*0.5;var s=16/xa,G=[s*A,s],B=[1,1,0];s=[1,1];var L,I=H.readBackPixels,P,N,R=H.uniforms;k=H.attributes;b.useProgram(H.program);la=H.program;aa="";b.uniform1i(R.map,0);b.activeTexture(b.TEXTURE0);b.uniform1f(R.opacity,1);b.uniform1f(R.rotation,0);b.uniform2fv(R.scale,G);b.bindBuffer(b.ARRAY_BUFFER,H.vertexBuffer);b.vertexAttribPointer(k.vertex,2,b.FLOAT,!1,16,0);b.vertexAttribPointer(k.uv,2,b.FLOAT,!1,16,8);b.bindTexture(b.TEXTURE_2D,H.tempTexture);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
H.elementBuffer);b.disable(b.CULL_FACE);b.depthMask(!1);for(n=0;n<u;n++){k=e.__webglLensFlares[n].object;r.set(k.matrixWorld.n14,k.matrixWorld.n24,k.matrixWorld.n34);m.matrixWorldInverse.multiplyVector3(r);h=r.z;m.projectionMatrix.multiplyVector3(r);B[0]=r.x;B[1]=r.y;B[2]=r.z;s[0]=B[0]*t+t;s[1]=B[1]*q+q;b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,s[0]-8,s[1]-8,16,16);b.uniform3fv(R.screenPosition,B);b.uniform1i(R.renderPink,1);b.enable(b.DEPTH_TEST);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0);try{b.readPixels(s[0]-
8,s[1]-8,16,16,b.RGBA,b.UNSIGNED_BYTE,H.readBackPixels)}catch(C){console.log("WebGLRenderer.renderLensFlare: readPixels failed!")}b.getError()&&console.log("WebGLRenderer.renderLensFlare: readPixels failed!");sampleDistance=parseInt(5*(1-Math.max(0,Math.min(-h,m.far))/m.far),10)+2;h=sampleDistance*4;L=sampleDistance*64;N=0;P=28-h+(448-L);H.readBackPixels[P+0]===255&&H.readBackPixels[P+1]===0&&H.readBackPixels[P+2]===255&&(N+=0.2);P=28+h+(448-L);I[P+0]===255&&I[P+1]===0&&I[P+2]===255&&(N+=0.2);P=28+
h+(448+L);I[P+0]===255&&I[P+1]===0&&I[P+2]===255&&(N+=0.2);P=28-h+(448+L);I[P+0]===255&&I[P+1]===0&&I[P+2]===255&&(N+=0.2);P=476;I[P+0]===255&&I[P+1]===0&&I[P+2]===255&&(N+=0.2);k.positionScreen.x=B[0];k.positionScreen.y=B[1];k.positionScreen.z=B[2];k.customUpdateCallback?k.customUpdateCallback(N,k):k.updateLensFlares(N);b.uniform1i(R.renderPink,0);b.disable(b.DEPTH_TEST);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0)}for(n=0;n<u;n++){k=e.__webglLensFlares[n].object;r=0;for(t=k.lensFlares.length;r<
t;r++){q=k.lensFlares[r];if(q.opacity>0.001&&q.scale>0.001){B[0]=q.x;B[1]=q.y;B[2]=q.z;s=q.size*q.scale/xa;G[0]=s*A;G[1]=s;b.uniform3fv(R.screenPosition,B);b.uniform1f(R.rotation,q.rotation);b.uniform2fv(R.scale,G);b.uniform1f(R.opacity,q.opacity);qa(q.blending);E(q.texture,0);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0)}}}b.enable(b.CULL_FACE);b.enable(b.DEPTH_TEST);b.depthMask(Ca)}function T(e,m){e._modelViewMatrix.multiplyToArray(m.matrixWorldInverse,e.matrixWorld,e._modelViewMatrixArray);
THREE.Matrix4.makeInvert3x3(e._modelViewMatrix).transposeIntoArray(e._normalMatrixArray)}function O(e){var m,k,h;if(e instanceof THREE.Mesh){k=e.geometry;for(m in k.geometryGroups){h=k.geometryGroups[m];if(k.__dirtyVertices||k.__dirtyMorphTargets||k.__dirtyElements||k.__dirtyUvs||k.__dirtyNormals||k.__dirtyColors||k.__dirtyTangents){var n=b.DYNAMIC_DRAW,u=void 0,r=void 0,t=void 0,q=void 0;t=void 0;var A=void 0,s=void 0,G=void 0,B=void 0,L=void 0,I=void 0,P=void 0,N=void 0,R=void 0,C=void 0,F=void 0,
J=void 0,da=void 0;s=void 0;G=void 0;q=void 0;B=void 0;q=void 0;C=void 0;F=void 0;s=void 0;C=void 0;F=void 0;J=void 0;da=void 0;C=void 0;F=void 0;J=void 0;da=void 0;C=void 0;F=void 0;J=void 0;da=void 0;C=void 0;F=void 0;J=void 0;q=void 0;B=void 0;A=void 0;t=void 0;t=void 0;var ya=void 0,Oa=void 0,ea=void 0,X=0,va=0,Va=0,Wa=0,Ga=0,Ha=0,Z=0,Ia=0,sa=0,w=0,wa=0,za=h.__vertexArray,db=h.__uvArray,eb=h.__uv2Array,Ma=h.__normalArray,fa=h.__tangentArray,Aa=h.__colorArray,ga=h.__skinVertexAArray,ha=h.__skinVertexBArray,
ia=h.__skinIndexArray,ja=h.__skinWeightArray,fb=h.__morphTargetsArrays,Ja=h.__faceArray,Ka=h.__lineArray,mb=h.__needsSmoothNormals;I=h.__vertexColorType;L=h.__uvType;P=h.__normalType;var Ea=e.geometry,gb=Ea.__dirtyVertices,hb=Ea.__dirtyElements,bb=Ea.__dirtyUvs,ib=Ea.__dirtyNormals,jb=Ea.__dirtyTangents,kb=Ea.__dirtyColors,lb=Ea.__dirtyMorphTargets,Xa=Ea.vertices,nb=h.faces,rb=Ea.faces,ob=Ea.faceVertexUvs[0],pb=Ea.faceVertexUvs[1],Ya=Ea.skinVerticesA,Za=Ea.skinVerticesB,$a=Ea.skinIndices,Sa=Ea.skinWeights,
Ua=Ea.edgeFaces,Pa=Ea.morphTargets;u=0;for(r=nb.length;u<r;u++){t=nb[u];q=rb[t];ob&&(N=ob[t]);pb&&(R=pb[t]);t=q.vertexNormals;A=q.normal;s=q.vertexColors;G=q.color;B=q.vertexTangents;if(q instanceof THREE.Face3){if(gb){C=Xa[q.a].position;F=Xa[q.b].position;J=Xa[q.c].position;za[va]=C.x;za[va+1]=C.y;za[va+2]=C.z;za[va+3]=F.x;za[va+4]=F.y;za[va+5]=F.z;za[va+6]=J.x;za[va+7]=J.y;za[va+8]=J.z;va+=9}if(lb){ya=0;for(Oa=Pa.length;ya<Oa;ya++){C=Pa[ya].vertices[q.a].position;F=Pa[ya].vertices[q.b].position;
J=Pa[ya].vertices[q.c].position;ea=fb[ya];ea[wa+0]=C.x;ea[wa+1]=C.y;ea[wa+2]=C.z;ea[wa+3]=F.x;ea[wa+4]=F.y;ea[wa+5]=F.z;ea[wa+6]=J.x;ea[wa+7]=J.y;ea[wa+8]=J.z}wa+=9}if(Sa.length){C=Sa[q.a];F=Sa[q.b];J=Sa[q.c];ja[w]=C.x;ja[w+1]=C.y;ja[w+2]=C.z;ja[w+3]=C.w;ja[w+4]=F.x;ja[w+5]=F.y;ja[w+6]=F.z;ja[w+7]=F.w;ja[w+8]=J.x;ja[w+9]=J.y;ja[w+10]=J.z;ja[w+11]=J.w;C=$a[q.a];F=$a[q.b];J=$a[q.c];ia[w]=C.x;ia[w+1]=C.y;ia[w+2]=C.z;ia[w+3]=C.w;ia[w+4]=F.x;ia[w+5]=F.y;ia[w+6]=F.z;ia[w+7]=F.w;ia[w+8]=J.x;ia[w+9]=J.y;
ia[w+10]=J.z;ia[w+11]=J.w;C=Ya[q.a];F=Ya[q.b];J=Ya[q.c];ga[w]=C.x;ga[w+1]=C.y;ga[w+2]=C.z;ga[w+3]=1;ga[w+4]=F.x;ga[w+5]=F.y;ga[w+6]=F.z;ga[w+7]=1;ga[w+8]=J.x;ga[w+9]=J.y;ga[w+10]=J.z;ga[w+11]=1;C=Za[q.a];F=Za[q.b];J=Za[q.c];ha[w]=C.x;ha[w+1]=C.y;ha[w+2]=C.z;ha[w+3]=1;ha[w+4]=F.x;ha[w+5]=F.y;ha[w+6]=F.z;ha[w+7]=1;ha[w+8]=J.x;ha[w+9]=J.y;ha[w+10]=J.z;ha[w+11]=1;w+=12}if(kb&&I){if(s.length==3&&I==THREE.VertexColors){q=s[0];C=s[1];F=s[2]}else F=C=q=G;Aa[sa]=q.r;Aa[sa+1]=q.g;Aa[sa+2]=q.b;Aa[sa+3]=C.r;
Aa[sa+4]=C.g;Aa[sa+5]=C.b;Aa[sa+6]=F.r;Aa[sa+7]=F.g;Aa[sa+8]=F.b;sa+=9}if(jb&&Ea.hasTangents){s=B[0];G=B[1];q=B[2];fa[Z]=s.x;fa[Z+1]=s.y;fa[Z+2]=s.z;fa[Z+3]=s.w;fa[Z+4]=G.x;fa[Z+5]=G.y;fa[Z+6]=G.z;fa[Z+7]=G.w;fa[Z+8]=q.x;fa[Z+9]=q.y;fa[Z+10]=q.z;fa[Z+11]=q.w;Z+=12}if(ib&&P)if(t.length==3&&mb)for(B=0;B<3;B++){A=t[B];Ma[Ha]=A.x;Ma[Ha+1]=A.y;Ma[Ha+2]=A.z;Ha+=3}else for(B=0;B<3;B++){Ma[Ha]=A.x;Ma[Ha+1]=A.y;Ma[Ha+2]=A.z;Ha+=3}if(bb&&N!==undefined&&L)for(B=0;B<3;B++){t=N[B];db[Va]=t.u;db[Va+1]=t.v;Va+=
2}if(bb&&R!==undefined&&L)for(B=0;B<3;B++){t=R[B];eb[Wa]=t.u;eb[Wa+1]=t.v;Wa+=2}if(hb){Ja[Ga]=X;Ja[Ga+1]=X+1;Ja[Ga+2]=X+2;Ga+=3;Ka[Ia]=X;Ka[Ia+1]=X+1;Ka[Ia+2]=X;Ka[Ia+3]=X+2;Ka[Ia+4]=X+1;Ka[Ia+5]=X+2;Ia+=6;X+=3}}else if(q instanceof THREE.Face4){if(gb){C=Xa[q.a].position;F=Xa[q.b].position;J=Xa[q.c].position;da=Xa[q.d].position;za[va]=C.x;za[va+1]=C.y;za[va+2]=C.z;za[va+3]=F.x;za[va+4]=F.y;za[va+5]=F.z;za[va+6]=J.x;za[va+7]=J.y;za[va+8]=J.z;za[va+9]=da.x;za[va+10]=da.y;za[va+11]=da.z;va+=12}if(lb){ya=
0;for(Oa=Pa.length;ya<Oa;ya++){C=Pa[ya].vertices[q.a].position;F=Pa[ya].vertices[q.b].position;J=Pa[ya].vertices[q.c].position;da=Pa[ya].vertices[q.d].position;ea=fb[ya];ea[wa+0]=C.x;ea[wa+1]=C.y;ea[wa+2]=C.z;ea[wa+3]=F.x;ea[wa+4]=F.y;ea[wa+5]=F.z;ea[wa+6]=J.x;ea[wa+7]=J.y;ea[wa+8]=J.z;ea[wa+9]=da.x;ea[wa+10]=da.y;ea[wa+11]=da.z}wa+=12}if(Sa.length){C=Sa[q.a];F=Sa[q.b];J=Sa[q.c];da=Sa[q.d];ja[w]=C.x;ja[w+1]=C.y;ja[w+2]=C.z;ja[w+3]=C.w;ja[w+4]=F.x;ja[w+5]=F.y;ja[w+6]=F.z;ja[w+7]=F.w;ja[w+8]=J.x;ja[w+
9]=J.y;ja[w+10]=J.z;ja[w+11]=J.w;ja[w+12]=da.x;ja[w+13]=da.y;ja[w+14]=da.z;ja[w+15]=da.w;C=$a[q.a];F=$a[q.b];J=$a[q.c];da=$a[q.d];ia[w]=C.x;ia[w+1]=C.y;ia[w+2]=C.z;ia[w+3]=C.w;ia[w+4]=F.x;ia[w+5]=F.y;ia[w+6]=F.z;ia[w+7]=F.w;ia[w+8]=J.x;ia[w+9]=J.y;ia[w+10]=J.z;ia[w+11]=J.w;ia[w+12]=da.x;ia[w+13]=da.y;ia[w+14]=da.z;ia[w+15]=da.w;C=Ya[q.a];F=Ya[q.b];J=Ya[q.c];da=Ya[q.d];ga[w]=C.x;ga[w+1]=C.y;ga[w+2]=C.z;ga[w+3]=1;ga[w+4]=F.x;ga[w+5]=F.y;ga[w+6]=F.z;ga[w+7]=1;ga[w+8]=J.x;ga[w+9]=J.y;ga[w+10]=J.z;ga[w+
11]=1;ga[w+12]=da.x;ga[w+13]=da.y;ga[w+14]=da.z;ga[w+15]=1;C=Za[q.a];F=Za[q.b];J=Za[q.c];q=Za[q.d];ha[w]=C.x;ha[w+1]=C.y;ha[w+2]=C.z;ha[w+3]=1;ha[w+4]=F.x;ha[w+5]=F.y;ha[w+6]=F.z;ha[w+7]=1;ha[w+8]=J.x;ha[w+9]=J.y;ha[w+10]=J.z;ha[w+11]=1;ha[w+12]=q.x;ha[w+13]=q.y;ha[w+14]=q.z;ha[w+15]=1;w+=16}if(kb&&I){if(s.length==4&&I==THREE.VertexColors){q=s[0];C=s[1];F=s[2];s=s[3]}else s=F=C=q=G;Aa[sa]=q.r;Aa[sa+1]=q.g;Aa[sa+2]=q.b;Aa[sa+3]=C.r;Aa[sa+4]=C.g;Aa[sa+5]=C.b;Aa[sa+6]=F.r;Aa[sa+7]=F.g;Aa[sa+8]=F.b;Aa[sa+
9]=s.r;Aa[sa+10]=s.g;Aa[sa+11]=s.b;sa+=12}if(jb&&Ea.hasTangents){s=B[0];G=B[1];q=B[2];B=B[3];fa[Z]=s.x;fa[Z+1]=s.y;fa[Z+2]=s.z;fa[Z+3]=s.w;fa[Z+4]=G.x;fa[Z+5]=G.y;fa[Z+6]=G.z;fa[Z+7]=G.w;fa[Z+8]=q.x;fa[Z+9]=q.y;fa[Z+10]=q.z;fa[Z+11]=q.w;fa[Z+12]=B.x;fa[Z+13]=B.y;fa[Z+14]=B.z;fa[Z+15]=B.w;Z+=16}if(ib&&P)if(t.length==4&&mb)for(B=0;B<4;B++){A=t[B];Ma[Ha]=A.x;Ma[Ha+1]=A.y;Ma[Ha+2]=A.z;Ha+=3}else for(B=0;B<4;B++){Ma[Ha]=A.x;Ma[Ha+1]=A.y;Ma[Ha+2]=A.z;Ha+=3}if(bb&&N!==undefined&&L)for(B=0;B<4;B++){t=N[B];
db[Va]=t.u;db[Va+1]=t.v;Va+=2}if(bb&&R!==undefined&&L)for(B=0;B<4;B++){t=R[B];eb[Wa]=t.u;eb[Wa+1]=t.v;Wa+=2}if(hb){Ja[Ga]=X;Ja[Ga+1]=X+1;Ja[Ga+2]=X+3;Ja[Ga+3]=X+1;Ja[Ga+4]=X+2;Ja[Ga+5]=X+3;Ga+=6;Ka[Ia]=X;Ka[Ia+1]=X+1;Ka[Ia+2]=X;Ka[Ia+3]=X+3;Ka[Ia+4]=X+1;Ka[Ia+5]=X+2;Ka[Ia+6]=X+2;Ka[Ia+7]=X+3;Ia+=8;X+=4}}}if(Ua){u=0;for(r=Ua.length;u<r;u++){Ja[Ga]=Ua[u].a;Ja[Ga+1]=Ua[u].b;Ja[Ga+2]=Ua[u].c;Ja[Ga+3]=Ua[u].a;Ja[Ga+4]=Ua[u].c;Ja[Ga+5]=Ua[u].d;Ga+=6}}if(gb){b.bindBuffer(b.ARRAY_BUFFER,h.__webglVertexBuffer);
b.bufferData(b.ARRAY_BUFFER,za,n)}if(lb){ya=0;for(Oa=Pa.length;ya<Oa;ya++){b.bindBuffer(b.ARRAY_BUFFER,h.__webglMorphTargetsBuffers[ya]);b.bufferData(b.ARRAY_BUFFER,fb[ya],n)}}if(kb&&sa>0){b.bindBuffer(b.ARRAY_BUFFER,h.__webglColorBuffer);b.bufferData(b.ARRAY_BUFFER,Aa,n)}if(ib){b.bindBuffer(b.ARRAY_BUFFER,h.__webglNormalBuffer);b.bufferData(b.ARRAY_BUFFER,Ma,n)}if(jb&&Ea.hasTangents){b.bindBuffer(b.ARRAY_BUFFER,h.__webglTangentBuffer);b.bufferData(b.ARRAY_BUFFER,fa,n)}if(bb&&Va>0){b.bindBuffer(b.ARRAY_BUFFER,
h.__webglUVBuffer);b.bufferData(b.ARRAY_BUFFER,db,n)}if(bb&&Wa>0){b.bindBuffer(b.ARRAY_BUFFER,h.__webglUV2Buffer);b.bufferData(b.ARRAY_BUFFER,eb,n)}if(hb){b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,h.__webglFaceBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,Ja,n);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,h.__webglLineBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,Ka,n)}if(w>0){b.bindBuffer(b.ARRAY_BUFFER,h.__webglSkinVertexABuffer);b.bufferData(b.ARRAY_BUFFER,ga,n);b.bindBuffer(b.ARRAY_BUFFER,h.__webglSkinVertexBBuffer);
b.bufferData(b.ARRAY_BUFFER,ha,n);b.bindBuffer(b.ARRAY_BUFFER,h.__webglSkinIndicesBuffer);b.bufferData(b.ARRAY_BUFFER,ia,n);b.bindBuffer(b.ARRAY_BUFFER,h.__webglSkinWeightsBuffer);b.bufferData(b.ARRAY_BUFFER,ja,n)}}}k.__dirtyVertices=!1;k.__dirtyMorphTargets=!1;k.__dirtyElements=!1;k.__dirtyUvs=!1;k.__dirtyNormals=!1;k.__dirtyTangents=!1;k.__dirtyColors=!1}else if(e instanceof THREE.Ribbon){k=e.geometry;if(k.__dirtyVertices||k.__dirtyColors){e=k;m=b.DYNAMIC_DRAW;P=e.vertices;n=e.colors;N=P.length;
u=n.length;R=e.__vertexArray;r=e.__colorArray;X=e.__dirtyColors;if(e.__dirtyVertices){for(L=0;L<N;L++){I=P[L].position;h=L*3;R[h]=I.x;R[h+1]=I.y;R[h+2]=I.z}b.bindBuffer(b.ARRAY_BUFFER,e.__webglVertexBuffer);b.bufferData(b.ARRAY_BUFFER,R,m)}if(X){for(L=0;L<u;L++){color=n[L];h=L*3;r[h]=color.r;r[h+1]=color.g;r[h+2]=color.b}b.bindBuffer(b.ARRAY_BUFFER,e.__webglColorBuffer);b.bufferData(b.ARRAY_BUFFER,r,m)}}k.__dirtyVertices=!1;k.__dirtyColors=!1}else if(e instanceof THREE.Line){k=e.geometry;if(k.__dirtyVertices||
k.__dirtyColors){e=k;m=b.DYNAMIC_DRAW;P=e.vertices;n=e.colors;N=P.length;u=n.length;R=e.__vertexArray;r=e.__colorArray;X=e.__dirtyColors;if(e.__dirtyVertices){for(L=0;L<N;L++){I=P[L].position;h=L*3;R[h]=I.x;R[h+1]=I.y;R[h+2]=I.z}b.bindBuffer(b.ARRAY_BUFFER,e.__webglVertexBuffer);b.bufferData(b.ARRAY_BUFFER,R,m)}if(X){for(L=0;L<u;L++){color=n[L];h=L*3;r[h]=color.r;r[h+1]=color.g;r[h+2]=color.b}b.bindBuffer(b.ARRAY_BUFFER,e.__webglColorBuffer);b.bufferData(b.ARRAY_BUFFER,r,m)}}k.__dirtyVertices=!1;
k.__dirtyColors=!1}else if(e instanceof THREE.ParticleSystem){k=e.geometry;(k.__dirtyVertices||k.__dirtyColors||e.sortParticles)&&c(k,b.DYNAMIC_DRAW,e);k.__dirtyVertices=!1;k.__dirtyColors=!1}}function pa(e){function m(B){var L=[];k=0;for(h=B.length;k<h;k++)B[k]==undefined?L.push("undefined"):L.push(B[k].id);return L.join("_")}var k,h,n,u,r,t,q,A,s={},G=e.morphTargets!==undefined?e.morphTargets.length:0;e.geometryGroups={};n=0;for(u=e.faces.length;n<u;n++){r=e.faces[n];t=r.materials;q=m(t);s[q]==
undefined&&(s[q]={hash:q,counter:0});A=s[q].hash+"_"+s[q].counter;e.geometryGroups[A]==undefined&&(e.geometryGroups[A]={faces:[],materials:t,vertices:0,numMorphTargets:G});r=r instanceof THREE.Face3?3:4;if(e.geometryGroups[A].vertices+r>65535){s[q].counter+=1;A=s[q].hash+"_"+s[q].counter;e.geometryGroups[A]==undefined&&(e.geometryGroups[A]={faces:[],materials:t,vertices:0,numMorphTargets:G})}e.geometryGroups[A].faces.push(n);e.geometryGroups[A].vertices+=r}}function Y(e,m,k){e.push({buffer:m,object:k,
opaque:{list:[],count:0},transparent:{list:[],count:0}})}function qa(e){if(e!=aa){switch(e){case THREE.AdditiveAlphaBlending:b.blendEquation(b.FUNC_ADD);b.blendFunc(b.SRC_ALPHA,b.ONE);break;case THREE.AdditiveBlending:b.blendEquation(b.FUNC_ADD);b.blendFunc(b.SRC_ALPHA,b.ONE);break;case THREE.SubtractiveBlending:b.blendEquation(b.FUNC_ADD);b.blendFunc(b.ZERO,b.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:b.blendEquation(b.FUNC_ADD);b.blendFunc(b.ZERO,b.SRC_COLOR);break;default:b.blendEquationSeparate(b.FUNC_ADD,
b.FUNC_ADD);b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA)}aa=e}}function V(e,m,k){if((k.width&k.width-1)==0&&(k.height&k.height-1)==0){b.texParameteri(e,b.TEXTURE_WRAP_S,$(m.wrapS));b.texParameteri(e,b.TEXTURE_WRAP_T,$(m.wrapT));b.texParameteri(e,b.TEXTURE_MAG_FILTER,$(m.magFilter));b.texParameteri(e,b.TEXTURE_MIN_FILTER,$(m.minFilter));b.generateMipmap(e)}else{b.texParameteri(e,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(e,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);
b.texParameteri(e,b.TEXTURE_MAG_FILTER,Da(m.magFilter));b.texParameteri(e,b.TEXTURE_MIN_FILTER,Da(m.minFilter))}}function E(e,m){if(e.needsUpdate){if(e.__webglInit){b.bindTexture(b.TEXTURE_2D,e.__webglTexture);b.texSubImage2D(b.TEXTURE_2D,0,0,0,b.RGBA,b.UNSIGNED_BYTE,e.image)}else{e.__webglTexture=b.createTexture();b.bindTexture(b.TEXTURE_2D,e.__webglTexture);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,e.image);e.__webglInit=!0}V(b.TEXTURE_2D,e,e.image);b.bindTexture(b.TEXTURE_2D,null);
e.needsUpdate=!1}b.activeTexture(b.TEXTURE0+m);b.bindTexture(b.TEXTURE_2D,e.__webglTexture)}function Fa(e){if(e&&!e.__webglFramebuffer){e.__webglFramebuffer=b.createFramebuffer();e.__webglRenderbuffer=b.createRenderbuffer();e.__webglTexture=b.createTexture();b.bindRenderbuffer(b.RENDERBUFFER,e.__webglRenderbuffer);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,e.width,e.height);b.bindTexture(b.TEXTURE_2D,e.__webglTexture);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,$(e.wrapS));b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_WRAP_T,$(e.wrapT));b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,$(e.magFilter));b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,$(e.minFilter));b.texImage2D(b.TEXTURE_2D,0,$(e.format),e.width,e.height,0,$(e.format),$(e.type),null);b.bindFramebuffer(b.FRAMEBUFFER,e.__webglFramebuffer);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,e.__webglTexture,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,e.__webglRenderbuffer);b.bindTexture(b.TEXTURE_2D,
null);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindFramebuffer(b.FRAMEBUFFER,null)}var m,k;if(e){m=e.__webglFramebuffer;k=e.width;e=e.height}else{m=null;k=ma;e=xa}if(m!=Ba){b.bindFramebuffer(b.FRAMEBUFFER,m);b.viewport(U,ra,k,e);Ba=m}}function ka(e,m){var k;if(e=="fragment")k=b.createShader(b.FRAGMENT_SHADER);else e=="vertex"&&(k=b.createShader(b.VERTEX_SHADER));b.shaderSource(k,m);b.compileShader(k);if(!b.getShaderParameter(k,b.COMPILE_STATUS)){console.error(b.getShaderInfoLog(k));console.error(m);
return null}return k}function Da(e){switch(e){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return b.NEAREST;default:return b.LINEAR}}function $(e){switch(e){case THREE.RepeatWrapping:return b.REPEAT;case THREE.ClampToEdgeWrapping:return b.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return b.MIRRORED_REPEAT;case THREE.NearestFilter:return b.NEAREST;case THREE.NearestMipMapNearestFilter:return b.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return b.NEAREST_MIPMAP_LINEAR;
case THREE.LinearFilter:return b.LINEAR;case THREE.LinearMipMapNearestFilter:return b.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return b.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return b.BYTE;case THREE.UnsignedByteType:return b.UNSIGNED_BYTE;case THREE.ShortType:return b.SHORT;case THREE.UnsignedShortType:return b.UNSIGNED_SHORT;case THREE.IntType:return b.INT;case THREE.UnsignedShortType:return b.UNSIGNED_INT;case THREE.FloatType:return b.FLOAT;case THREE.AlphaFormat:return b.ALPHA;
case THREE.RGBFormat:return b.RGB;case THREE.RGBAFormat:return b.RGBA;case THREE.LuminanceFormat:return b.LUMINANCE;case THREE.LuminanceAlphaFormat:return b.LUMINANCE_ALPHA}return 0}var b,Q=document.createElement("canvas"),la=null,Ba=null,Ca=!0,ta=this,W=null,na=null,aa=null,oa=null,U=0,ra=0,ma=0,xa=0,ua=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],ca=new THREE.Matrix4,La=new Float32Array(16),Qa=new Float32Array(16),Ra=new THREE.Vector4,
cb={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}},Na=!0,ab=!0,Ta=new THREE.Color(0),qb=0;if(a){if(a.stencil!=undefined)Na=a.stencil;if(a.antialias!==undefined)ab=a.antialias;a.clearColor!==undefined&&Ta.setHex(a.clearColor);if(a.clearAlpha!==undefined)qb=a.clearAlpha}this.maxMorphTargets=8;this.domElement=Q;this.autoClear=!0;this.sortObjects=!0;(function(e,m,k,h){try{if(!(b=Q.getContext("experimental-webgl",{antialias:e,stencil:h})))throw"Error creating WebGL context.";
}catch(n){console.error(n)}b.clearColor(0,0,0,1);b.clearDepth(1);b.enable(b.DEPTH_TEST);b.depthFunc(b.LEQUAL);b.frontFace(b.CCW);b.cullFace(b.BACK);b.enable(b.CULL_FACE);b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);b.clearColor(m.r,m.g,m.b,k)})(ab,Ta,qb,Na);this.context=b;if(Na){var S={};S.vertices=new Float32Array(12);S.faces=new Uint16Array(6);S.darkness=0.5;S.vertices[0]=-2;S.vertices[1]=-1;S.vertices[2]=-1;S.vertices[3]=2;S.vertices[4]=-1;S.vertices[5]=
-1;S.vertices[6]=2;S.vertices[7]=1;S.vertices[8]=-1;S.vertices[9]=-2;S.vertices[10]=1;S.vertices[11]=-1;S.faces[0]=0;S.faces[1]=1;S.faces[2]=2;S.faces[3]=0;S.faces[4]=2;S.faces[5]=3;S.vertexBuffer=b.createBuffer();S.elementBuffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,S.vertexBuffer);b.bufferData(b.ARRAY_BUFFER,S.vertices,b.STATIC_DRAW);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,S.elementBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,S.faces,b.STATIC_DRAW);S.program=b.createProgram();b.attachShader(S.program,
ka("fragment",THREE.ShaderLib.shadowPost.fragmentShader));b.attachShader(S.program,ka("vertex",THREE.ShaderLib.shadowPost.vertexShader));b.linkProgram(S.program);S.vertexLocation=b.getAttribLocation(S.program,"position");S.projectionLocation=b.getUniformLocation(S.program,"projectionMatrix");S.darknessLocation=b.getUniformLocation(S.program,"darkness")}var H={};H.vertices=new Float32Array(16);H.faces=new Uint16Array(6);H.transparency=0.5;a=0;H.vertices[a++]=-1;H.vertices[a++]=-1;H.vertices[a++]=0;
H.vertices[a++]=0;H.vertices[a++]=1;H.vertices[a++]=-1;H.vertices[a++]=1;H.vertices[a++]=0;H.vertices[a++]=1;H.vertices[a++]=1;H.vertices[a++]=1;H.vertices[a++]=1;H.vertices[a++]=-1;H.vertices[a++]=1;H.vertices[a++]=0;H.vertices[a++]=1;a=0;H.faces[a++]=0;H.faces[a++]=1;H.faces[a++]=2;H.faces[a++]=0;H.faces[a++]=2;H.faces[a++]=3;H.vertexBuffer=b.createBuffer();H.elementBuffer=b.createBuffer();H.tempTexture=b.createTexture();H.readBackPixels=new Uint8Array(1024);b.bindBuffer(b.ARRAY_BUFFER,H.vertexBuffer);
b.bufferData(b.ARRAY_BUFFER,H.vertices,b.STATIC_DRAW);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,H.elementBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,H.faces,b.STATIC_DRAW);b.bindTexture(b.TEXTURE_2D,H.tempTexture);b.texImage2D(b.TEXTURE_2D,0,b.RGB,16,16,0,b.RGB,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,
b.NEAREST);H.program=b.createProgram();b.attachShader(H.program,ka("fragment",THREE.ShaderLib.lensFlare.fragmentShader));b.attachShader(H.program,ka("vertex",THREE.ShaderLib.lensFlare.vertexShader));b.linkProgram(H.program);H.attributes={};H.uniforms={};H.attributes.vertex=b.getAttribLocation(H.program,"position");H.attributes.uv=b.getAttribLocation(H.program,"UV");H.uniforms.map=b.getUniformLocation(H.program,"map");H.uniforms.opacity=b.getUniformLocation(H.program,"opacity");H.uniforms.scale=b.getUniformLocation(H.program,
"scale");H.uniforms.rotation=b.getUniformLocation(H.program,"rotation");H.uniforms.screenPosition=b.getUniformLocation(H.program,"screenPosition");H.uniforms.renderPink=b.getUniformLocation(H.program,"renderPink");this.setSize=function(e,m){Q.width=e;Q.height=m;this.setViewport(0,0,Q.width,Q.height)};this.setViewport=function(e,m,k,h){U=e;ra=m;ma=k;xa=h;b.viewport(U,ra,ma,xa)};this.setScissor=function(e,m,k,h){b.scissor(e,m,k,h)};this.enableScissorTest=function(e){e?b.enable(b.SCISSOR_TEST):b.disable(b.SCISSOR_TEST)};
this.enableDepthBufferWrite=function(e){Ca=e;b.depthMask(e)};this.setClearColorHex=function(e,m){var k=new THREE.Color(e);b.clearColor(k.r,k.g,k.b,m)};this.setClearColor=function(e,m){b.clearColor(e.r,e.g,e.b,m)};this.clear=function(){b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT|b.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=function(e){S.darkness=e};this.initMaterial=function(e,m,k,h){var n,u,r,t;if(e instanceof THREE.MeshDepthMaterial)d(e,THREE.ShaderLib.depth);else if(e instanceof THREE.ShadowVolumeDynamicMaterial)d(e,
THREE.ShaderLib.shadowVolumeDynamic);else if(e instanceof THREE.MeshNormalMaterial)d(e,THREE.ShaderLib.normal);else if(e instanceof THREE.MeshBasicMaterial)d(e,THREE.ShaderLib.basic);else if(e instanceof THREE.MeshLambertMaterial)d(e,THREE.ShaderLib.lambert);else if(e instanceof THREE.MeshPhongMaterial)d(e,THREE.ShaderLib.phong);else if(e instanceof THREE.LineBasicMaterial)d(e,THREE.ShaderLib.basic);else e instanceof THREE.ParticleBasicMaterial&&d(e,THREE.ShaderLib.particle_basic);if(!e.program){var q,
A,s;q=s=t=0;for(r=m.length;q<r;q++){A=m[q];A instanceof THREE.DirectionalLight&&s++;A instanceof THREE.PointLight&&t++}if(t+s<=4)m=s;else{m=Math.ceil(4*s/(t+s));t=4-m}t={directional:m,point:t};m=50;if(h!==undefined&&h instanceof THREE.SkinnedMesh)m=h.bones.length;r={map:e.map,envMap:e.envMap,lightMap:e.lightMap,vertexColors:e.vertexColors,fog:k,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,morphTargets:e.morphTargets,maxDirLights:t.directional,maxPointLights:t.point,maxBones:m};k=e.fragmentShader;
t=e.vertexShader;m=b.createProgram();q=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,r.fog?"#define USE_FOG":"",r.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.lightMap?"#define USE_LIGHTMAP":"",r.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");r=[b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>
0?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,"#define MAX_BONES "+r.maxBones,r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.lightMap?"#define USE_LIGHTMAP":"",r.vertexColors?"#define USE_COLOR":"",r.skinning?"#define USE_SKINNING":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");
b.attachShader(m,ka("fragment",q+k));b.attachShader(m,ka("vertex",r+t));b.linkProgram(m);b.getProgramParameter(m,b.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+b.getProgramParameter(m,b.VALIDATE_STATUS)+", gl error ["+b.getError()+"]");m.uniforms={};m.attributes={};e.program=m;k=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(n in e.uniforms)k.push(n);
n=e.program;t=0;for(m=k.length;t<m;t++){q=k[t];n.uniforms[q]=b.getUniformLocation(n,q)}k=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(n=0;n<this.maxMorphTargets;n++)k.push("morphTarget"+n);for(u in e.attributes)k.push(u);u=e.program;n=k;k=0;for(t=n.length;k<t;k++){m=n[k];u.attributes[m]=b.getAttribLocation(u,m)}u=e.program.attributes;b.enableVertexAttribArray(u.position);u.color>=0&&b.enableVertexAttribArray(u.color);u.normal>=0&&b.enableVertexAttribArray(u.normal);
u.tangent>=0&&b.enableVertexAttribArray(u.tangent);if(e.skinning&&u.skinVertexA>=0&&u.skinVertexB>=0&&u.skinIndex>=0&&u.skinWeight>=0){b.enableVertexAttribArray(u.skinVertexA);b.enableVertexAttribArray(u.skinVertexB);b.enableVertexAttribArray(u.skinIndex);b.enableVertexAttribArray(u.skinWeight)}if(e.morphTargets){e.numSupportedMorphTargets=0;if(u.morphTarget0>=0){b.enableVertexAttribArray(u.morphTarget0);e.numSupportedMorphTargets++}if(u.morphTarget1>=0){b.enableVertexAttribArray(u.morphTarget1);
e.numSupportedMorphTargets++}if(u.morphTarget2>=0){b.enableVertexAttribArray(u.morphTarget2);e.numSupportedMorphTargets++}if(u.morphTarget3>=0){b.enableVertexAttribArray(u.morphTarget3);e.numSupportedMorphTargets++}if(u.morphTarget4>=0){b.enableVertexAttribArray(u.morphTarget4);e.numSupportedMorphTargets++}if(u.morphTarget5>=0){b.enableVertexAttribArray(u.morphTarget5);e.numSupportedMorphTargets++}if(u.morphTarget6>=0){b.enableVertexAttribArray(u.morphTarget6);e.numSupportedMorphTargets++}if(u.morphTarget7>=
0){b.enableVertexAttribArray(u.morphTarget7);e.numSupportedMorphTargets++}h.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);n=0;for(u=this.maxMorphTargets;n<u;n++)h.__webglMorphTargetInfluences[n]=0}}e.__webglProgram=!0};this.render=function(e,m,k,h){var n,u,r,t,q,A,s,G,B=e.lights,L=e.fog;m.matrixAutoUpdate&&m.updateMatrix();e.update(undefined,!1,m);m.matrixWorldInverse.flattenToArray(Qa);m.projectionMatrix.flattenToArray(La);ca.multiply(m.projectionMatrix,m.matrixWorldInverse);
p(ca);this.initWebGLObjects(e);Fa(k);(this.autoClear||h)&&this.clear();q=e.__webglObjects.length;for(h=0;h<q;h++){n=e.__webglObjects[h];s=n.object;if(s.visible)if(!(s instanceof THREE.Mesh)||v(s)){s.matrixWorld.flattenToArray(s._objectMatrixArray);T(s,m);D(n);n.render=!0;if(this.sortObjects){Ra.copy(s.position);ca.multiplyVector3(Ra);n.z=Ra.z}}else n.render=!1;else n.render=!1}this.sortObjects&&e.__webglObjects.sort(z);A=e.__webglObjectsImmediate.length;for(h=0;h<A;h++){n=e.__webglObjectsImmediate[h];
s=n.object;if(s.visible){s.matrixAutoUpdate&&s.matrixWorld.flattenToArray(s._objectMatrixArray);T(s,m);y(n)}}qa(THREE.NormalBlending);for(h=0;h<q;h++){n=e.__webglObjects[h];if(n.render){s=n.object;G=n.buffer;r=n.opaque;j(s);for(n=0;n<r.count;n++){t=r.list[n];o(t.depthTest);f(m,B,L,t,G,s)}}}for(h=0;h<A;h++){n=e.__webglObjectsImmediate[h];s=n.object;if(s.visible){r=n.opaque;j(s);for(n=0;n<r.count;n++){t=r.list[n];o(t.depthTest);u=g(m,B,L,t,s);s.render(function(I){i(I,u)})}}}for(h=0;h<q;h++){n=e.__webglObjects[h];
if(n.render){s=n.object;G=n.buffer;r=n.transparent;j(s);for(n=0;n<r.count;n++){t=r.list[n];qa(t.blending);o(t.depthTest);f(m,B,L,t,G,s)}}}for(h=0;h<A;h++){n=e.__webglObjectsImmediate[h];s=n.object;if(s.visible){r=n.transparent;j(s);for(n=0;n<r.count;n++){t=r.list[n];qa(t.blending);o(t.depthTest);u=g(m,B,L,t,s);s.render(function(I){i(I,u)})}}}Na&&e.__webglShadowVolumes.length&&e.lights.length&&K(e);e.__webglLensFlares.length&&M(e,m);if(k&&k.minFilter!==THREE.NearestFilter&&k.minFilter!==THREE.LinearFilter){b.bindTexture(b.TEXTURE_2D,
k.__webglTexture);b.generateMipmap(b.TEXTURE_2D);b.bindTexture(b.TEXTURE_2D,null)}};this.initWebGLObjects=function(e){if(!e.__webglObjects){e.__webglObjects=[];e.__webglObjectsImmediate=[];e.__webglShadowVolumes=[];e.__webglLensFlares=[]}for(;e.__objectsAdded.length;){var m=e.__objectsAdded[0],k=e,h=void 0,n=void 0,u=void 0;if(m._modelViewMatrix==undefined){m._modelViewMatrix=new THREE.Matrix4;m._normalMatrixArray=new Float32Array(9);m._modelViewMatrixArray=new Float32Array(16);m._objectMatrixArray=
new Float32Array(16);m.matrixWorld.flattenToArray(m._objectMatrixArray)}if(m instanceof THREE.Mesh){n=m.geometry;n.geometryGroups==undefined&&pa(n);for(h in n.geometryGroups){u=n.geometryGroups[h];if(!u.__webglVertexBuffer){var r=u;r.__webglVertexBuffer=b.createBuffer();r.__webglNormalBuffer=b.createBuffer();r.__webglTangentBuffer=b.createBuffer();r.__webglColorBuffer=b.createBuffer();r.__webglUVBuffer=b.createBuffer();r.__webglUV2Buffer=b.createBuffer();r.__webglSkinVertexABuffer=b.createBuffer();
r.__webglSkinVertexBBuffer=b.createBuffer();r.__webglSkinIndicesBuffer=b.createBuffer();r.__webglSkinWeightsBuffer=b.createBuffer();r.__webglFaceBuffer=b.createBuffer();r.__webglLineBuffer=b.createBuffer();if(r.numMorphTargets){var t=void 0,q=void 0;r.__webglMorphTargetsBuffers=[];t=0;for(q=r.numMorphTargets;t<q;t++)r.__webglMorphTargetsBuffers.push(b.createBuffer())}r=u;t=m;var A=void 0,s=void 0,G=void 0;G=void 0;var B=q=0,L=0;A=void 0;s=void 0;var I=void 0;s=void 0;var P=t.geometry;I=P.faces;var N=
r.faces;A=0;for(s=N.length;A<s;A++){G=N[A];G=I[G];if(G instanceof THREE.Face3){q+=3;B+=1;L+=3}else if(G instanceof THREE.Face4){q+=4;B+=2;L+=4}}A=r;s=t;I=void 0;N=void 0;var R=void 0,C=void 0;R=void 0;G=[];I=0;for(N=s.materials.length;I<N;I++){R=s.materials[I];if(R instanceof THREE.MeshFaceMaterial){R=0;for(l=A.materials.length;R<l;R++)(C=A.materials[R])&&G.push(C)}else(C=R)&&G.push(C)}s=G;a:{A=void 0;I=void 0;N=s.length;for(A=0;A<N;A++){I=s[A];if(I.map||I.lightMap||I instanceof THREE.MeshShaderMaterial){A=
!0;break a}}A=!1}a:{I=void 0;N=void 0;G=s.length;for(I=0;I<G;I++){N=s[I];if(!(N instanceof THREE.MeshBasicMaterial&&!N.envMap||N instanceof THREE.MeshDepthMaterial)){I=N&&N.shading!=undefined&&N.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break a}}I=!1}a:{N=void 0;G=void 0;R=s.length;for(N=0;N<R;N++){G=s[N];if(G.vertexColors){s=G.vertexColors;break a}}s=!1}r.__vertexArray=new Float32Array(q*3);if(I)r.__normalArray=new Float32Array(q*3);if(P.hasTangents)r.__tangentArray=new Float32Array(q*
4);if(s)r.__colorArray=new Float32Array(q*3);if(A){if(P.faceUvs.length>0||P.faceVertexUvs.length>0)r.__uvArray=new Float32Array(q*2);if(P.faceUvs.length>1||P.faceVertexUvs.length>1)r.__uv2Array=new Float32Array(q*2)}if(t.geometry.skinWeights.length&&t.geometry.skinIndices.length){r.__skinVertexAArray=new Float32Array(q*4);r.__skinVertexBArray=new Float32Array(q*4);r.__skinIndexArray=new Float32Array(q*4);r.__skinWeightArray=new Float32Array(q*4)}r.__faceArray=new Uint16Array(B*3+(t.geometry.edgeFaces?
t.geometry.edgeFaces.length*6:0));r.__lineArray=new Uint16Array(L*2);if(r.numMorphTargets){P=void 0;N=void 0;r.__morphTargetsArrays=[];P=0;for(N=r.numMorphTargets;P<N;P++)r.__morphTargetsArrays.push(new Float32Array(q*3))}r.__needsSmoothNormals=I==THREE.SmoothShading;r.__uvType=A;r.__vertexColorType=s;r.__normalType=I;r.__webglFaceCount=B*3+(t.geometry.edgeFaces?t.geometry.edgeFaces.length*6:0);r.__webglLineCount=L*2;n.__dirtyVertices=!0;n.__dirtyMorphTargets=!0;n.__dirtyElements=!0;n.__dirtyUvs=
!0;n.__dirtyNormals=!0;n.__dirtyTangents=!0;n.__dirtyColors=!0}m instanceof THREE.ShadowVolume?Y(k.__webglShadowVolumes,u,m):Y(k.__webglObjects,u,m)}}else if(m instanceof THREE.LensFlare)Y(k.__webglLensFlares,undefined,m);else if(m instanceof THREE.Ribbon){n=m.geometry;if(!n.__webglVertexBuffer){h=n;h.__webglVertexBuffer=b.createBuffer();h.__webglColorBuffer=b.createBuffer();h=n;u=h.vertices.length;h.__vertexArray=new Float32Array(u*3);h.__colorArray=new Float32Array(u*3);h.__webglVertexCount=u;n.__dirtyVertices=
!0;n.__dirtyColors=!0}Y(k.__webglObjects,n,m)}else if(m instanceof THREE.Line){n=m.geometry;if(!n.__webglVertexBuffer){h=n;h.__webglVertexBuffer=b.createBuffer();h.__webglColorBuffer=b.createBuffer();h=n;u=h.vertices.length;h.__vertexArray=new Float32Array(u*3);h.__colorArray=new Float32Array(u*3);h.__webglLineCount=u;n.__dirtyVertices=!0;n.__dirtyColors=!0}Y(k.__webglObjects,n,m)}else if(m instanceof THREE.ParticleSystem){n=m.geometry;if(!n.__webglVertexBuffer){h=n;h.__webglVertexBuffer=b.createBuffer();
h.__webglColorBuffer=b.createBuffer();h=n;u=h.vertices.length;h.__vertexArray=new Float32Array(u*3);h.__colorArray=new Float32Array(u*3);h.__sortArray=[];h.__webglParticleCount=u;n.__dirtyVertices=!0;n.__dirtyColors=!0}Y(k.__webglObjects,n,m)}else THREE.MarchingCubes!==undefined&&m instanceof THREE.MarchingCubes&&k.__webglObjectsImmediate.push({object:m,opaque:{list:[],count:0},transparent:{list:[],count:0}});e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){m=e.__objectsRemoved[0];k=
e;n=void 0;h=void 0;for(n=k.__webglObjects.length-1;n>=0;n--){h=k.__webglObjects[n].object;m==h&&k.__webglObjects.splice(n,1)}e.__objectsRemoved.splice(0,1)}m=0;for(k=e.__webglObjects.length;m<k;m++)O(e.__webglObjects[m].object,e);m=0;for(k=e.__webglShadowVolumes.length;m<k;m++)O(e.__webglShadowVolumes[m].object,e);m=0;for(k=e.__webglLensFlares.length;m<k;m++)O(e.__webglLensFlares[m].object,e)};this.setFaceCulling=function(e,m){if(e){!m||m=="ccw"?b.frontFace(b.CCW):b.frontFace(b.CW);if(e=="back")b.cullFace(b.BACK);
else e=="front"?b.cullFace(b.FRONT):b.cullFace(b.FRONT_AND_BACK);b.enable(b.CULL_FACE)}else b.disable(b.CULL_FACE)};this.supportsVertexTextures=function(){return b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}};
THREE.WebGLRenderTarget=function(a,c,d){this.width=a;this.height=c;d=d||{};this.wrapS=d.wrapS!==undefined?d.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=d.wrapT!==undefined?d.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=d.magFilter!==undefined?d.magFilter:THREE.LinearFilter;this.minFilter=d.minFilter!==undefined?d.minFilter:THREE.LinearMipMapLinearFilter;this.format=d.format!==undefined?d.format:THREE.RGBFormat;this.type=d.type!==undefined?d.type:THREE.UnsignedByteType};
