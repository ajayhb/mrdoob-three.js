// ThreeDebug.js r20 - http://github.com/mrdoob/three.js
var THREE=THREE||{};THREE.Color=function(a){this.autoUpdate=true;this.setHex(a)};THREE.Color.prototype={setRGBA:function(f,e,c,d){this.r=f;this.g=e;this.b=c;this.a=d;if(this.autoUpdate){this.updateHex();this.updateStyleString()}},setHex:function(a){this.hex=a;if(this.autoUpdate){this.updateRGBA();this.updateStyleString()}},copyRGB:function(a){this.r=a.r;this.g=a.g;this.b=a.b},copyRGBA:function(a){this.r=a.r;this.g=a.g;this.b=a.b;this.a=a.a},multiplySelfRGB:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b},updateHex:function(){this.hex=Math.floor(this.a*255)<<24|Math.floor(this.r*255)<<16|Math.floor(this.g*255)<<8|Math.floor(this.b*255)},updateRGBA:function(){this.a=(this.hex>>24&255)/255;this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},updateStyleString:function(){this.__styleString="rgba("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+","+this.a+")"},toString:function(){return"THREE.Color ( r: "+this.r+", g: "+this.g+", b: "+this.b+", a: "+this.a+", hex: "+this.hex+" )"}};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};THREE.Vector2.prototype={set:function(a,b){this.x=a;this.y=b;return this},copy:function(a){this.x=a.x;this.y=a.y;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;return this},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},unit:function(){this.multiplyScalar(1/this.length());return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSq:function(){return this.x*this.x+this.y*this.y},negate:function(){this.x=-this.x;this.y=-this.y;return this},clone:function(){return new THREE.Vector2(this.x,this.y)},toString:function(){return"THREE.Vector2 ("+this.x+", "+this.y+")"}};THREE.Vector3=function(a,c,b){this.x=a||0;this.y=c||0;this.z=b||0};THREE.Vector3.prototype={set:function(a,c,b){this.x=a;this.y=c;this.z=b;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},cross:function(b,a){this.x=b.y*a.z-b.z*a.y;this.y=b.z*a.x-b.x*a.z;this.z=b.x*a.y-b.y*a.x;return this},crossSelf:function(c){var b=this.x,a=this.y,d=this.z;this.x=a*c.z-d*c.y;this.y=d*c.x-b*c.z;this.z=b*c.y-a*c.x;return this},multiplySelf:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divideScalar:function(a){this.x/=a;this.y/=a;this.z/=a;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(d){var c=this.x-d.x,b=this.y-d.y,a=this.z-d.z;return c*c+b*b+a*a},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},normalize:function(){if(this.length()>0){this.multiplyScalar(1/this.length())}else{this.multiplyScalar(0)}return this},setLength:function(a){return this.normalize().multiplyScalar(a)},isZero:function(){var a=0.0001;return(Math.abs(this.x)<a)&&(Math.abs(this.y)<a)&&(Math.abs(this.z)<a)},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},toString:function(){return"THREE.Vector3 ( "+this.x+", "+this.y+", "+this.z+" )"}};THREE.Vector4=function(a,d,c,b){this.x=a||0;this.y=d||0;this.z=c||0;this.w=b||1};THREE.Vector4.prototype={set:function(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this},add:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;this.w=b.w+a.w;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},sub:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;this.w=b.w-a.w;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},toString:function(){return"THREE.Vector4 ("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}};THREE.Rectangle=function(){var f,h,d,g,a,c,e=true;function b(){a=d-f;c=g-h}this.getX=function(){return f};this.getY=function(){return h};this.getWidth=function(){return a};this.getHeight=function(){return c};this.getX1=function(){return f};this.getY1=function(){return h};this.getX2=function(){return d};this.getY2=function(){return g};this.set=function(j,m,i,k){e=false;f=j;h=m;d=i;g=k;b()};this.addPoint=function(i,j){if(e){e=false;f=i;h=j;d=i;g=j}else{f=Math.min(f,i);h=Math.min(h,j);d=Math.max(d,i);g=Math.max(g,j)}b()};this.addRectangle=function(i){if(e){e=false;f=i.getX1();h=i.getY1();d=i.getX2();g=i.getY2()}else{f=Math.min(f,i.getX1());h=Math.min(h,i.getY1());d=Math.max(d,i.getX2());g=Math.max(g,i.getY2())}b()};this.inflate=function(i){f-=i;h-=i;d+=i;g+=i;b()};this.minSelf=function(i){f=Math.max(f,i.getX1());h=Math.max(h,i.getY1());d=Math.min(d,i.getX2());g=Math.min(g,i.getY2());b()};this.instersects=function(i){return Math.min(d,i.getX2())-Math.max(f,i.getX1())>=0&&Math.min(g,i.getY2())-Math.max(h,i.getY1())>=0};this.empty=function(){e=true;f=0;h=0;d=0;g=0;b()};this.isEmpty=function(){return e};this.toString=function(){return"THREE.Rectangle (x1: "+f+", y1: "+g+", x2: "+d+", y1: "+h+", width: "+a+", height: "+c+")"}};THREE.Matrix4=function(){this._x=new THREE.Vector3();this._y=new THREE.Vector3();this._z=new THREE.Vector3()};THREE.Matrix4.prototype={n11:1,n12:0,n13:0,n14:0,n21:0,n22:1,n23:0,n24:0,n31:0,n32:0,n33:1,n34:0,n41:0,n42:0,n43:0,n44:1,identity:function(){this.n11=1;this.n12=0;this.n13=0;this.n14=0;this.n21=0;this.n22=1;this.n23=0;this.n24=0;this.n31=0;this.n32=0;this.n33=1;this.n34=0;this.n41=0;this.n42=0;this.n43=0;this.n44=1},copy:function(a){this.n11=a.n11;this.n12=a.n12;this.n13=a.n13;this.n14=a.n14;this.n21=a.n21;this.n22=a.n22;this.n23=a.n23;this.n24=a.n24;this.n31=a.n31;this.n32=a.n32;this.n33=a.n33;this.n34=a.n34;this.n41=a.n41;this.n42=a.n42;this.n43=a.n43;this.n44=a.n44},lookAt:function(d,c,b){var a=this._x,f=this._y,e=this._z;e.sub(d,c);e.normalize();a.cross(b,e);a.normalize();f.cross(e,a);f.normalize();this.n11=a.x;this.n12=a.y;this.n13=a.z;this.n14=-a.dot(d);this.n21=f.x;this.n22=f.y;this.n23=f.z;this.n24=-f.dot(d);this.n31=e.x;this.n32=e.y;this.n33=e.z;this.n34=-e.dot(d);this.n41=0;this.n42=0;this.n43=0;this.n44=1},transform:function(a){var d=a.x,c=a.y,b=a.z,e=a.w?a.w:1;a.x=this.n11*d+this.n12*c+this.n13*b+this.n14*e;a.y=this.n21*d+this.n22*c+this.n23*b+this.n24*e;a.z=this.n31*d+this.n32*c+this.n33*b+this.n34*e;e=this.n41*d+this.n42*c+this.n43*b+this.n44*e;if(a.w){a.w=e}else{a.x=a.x/e;a.y=a.y/e;a.z=a.z/e}return a},crossVector:function(b){var c=new THREE.Vector4();c.x=this.n11*b.x+this.n12*b.y+this.n13*b.z+this.n14*b.w;c.y=this.n21*b.x+this.n22*b.y+this.n23*b.z+this.n24*b.w;c.z=this.n31*b.x+this.n32*b.y+this.n33*b.z+this.n34*b.w;c.w=(b.w)?this.n41*b.x+this.n42*b.y+this.n43*b.z+this.n44*b.w:1;return c},multiply:function(d,c){this.n11=d.n11*c.n11+d.n12*c.n21+d.n13*c.n31+d.n14*c.n41;this.n12=d.n11*c.n12+d.n12*c.n22+d.n13*c.n32+d.n14*c.n42;this.n13=d.n11*c.n13+d.n12*c.n23+d.n13*c.n33+d.n14*c.n43;this.n14=d.n11*c.n14+d.n12*c.n24+d.n13*c.n34+d.n14*c.n44;this.n21=d.n21*c.n11+d.n22*c.n21+d.n23*c.n31+d.n24*c.n41;this.n22=d.n21*c.n12+d.n22*c.n22+d.n23*c.n32+d.n24*c.n42;this.n23=d.n21*c.n13+d.n22*c.n23+d.n23*c.n33+d.n24*c.n43;this.n24=d.n21*c.n14+d.n22*c.n24+d.n23*c.n34+d.n24*c.n44;this.n31=d.n31*c.n11+d.n32*c.n21+d.n33*c.n31+d.n34*c.n41;this.n32=d.n31*c.n12+d.n32*c.n22+d.n33*c.n32+d.n34*c.n42;this.n33=d.n31*c.n13+d.n32*c.n23+d.n33*c.n33+d.n34*c.n43;this.n34=d.n31*c.n14+d.n32*c.n24+d.n33*c.n34+d.n34*c.n44;this.n41=d.n41*c.n11+d.n42*c.n21+d.n43*c.n31+d.n44*c.n41;this.n42=d.n41*c.n12+d.n42*c.n22+d.n43*c.n32+d.n44*c.n42;this.n43=d.n41*c.n13+d.n42*c.n23+d.n43*c.n33+d.n44*c.n43;this.n44=d.n41*c.n14+d.n42*c.n24+d.n43*c.n34+d.n44*c.n44},multiplySelf:function(c){var p=this.n11,o=this.n12,k=this.n13,i=this.n14,f=this.n21,e=this.n22,d=this.n23,b=this.n24,a=this.n31,s=this.n32,r=this.n33,q=this.n34,n=this.n41,j=this.n42,h=this.n43,g=this.n44;this.n11=p*c.n11+o*c.n21+k*c.n31+i*c.n41;this.n12=p*c.n12+o*c.n22+k*c.n32+i*c.n42;this.n13=p*c.n13+o*c.n23+k*c.n33+i*c.n43;this.n14=p*c.n14+o*c.n24+k*c.n34+i*c.n44;this.n21=f*c.n11+e*c.n21+d*c.n31+b*c.n41;this.n22=f*c.n12+e*c.n22+d*c.n32+b*c.n42;this.n23=f*c.n13+e*c.n23+d*c.n33+b*c.n43;this.n24=f*c.n14+e*c.n24+d*c.n34+b*c.n44;this.n31=a*c.n11+s*c.n21+r*c.n31+q*c.n41;this.n32=a*c.n12+s*c.n22+r*c.n32+q*c.n42;this.n33=a*c.n13+s*c.n23+r*c.n33+q*c.n43;this.n34=a*c.n14+s*c.n24+r*c.n34+q*c.n44;this.n41=n*c.n11+j*c.n21+h*c.n31+g*c.n41;this.n42=n*c.n12+j*c.n22+h*c.n32+g*c.n42;this.n43=n*c.n13+j*c.n23+h*c.n33+g*c.n43;this.n44=n*c.n14+j*c.n24+h*c.n34+g*c.n44},multiplyScalar:function(a){this.n11*=a;this.n12*=a;this.n13*=a;this.n14*=a;this.n21*=a;this.n22*=a;this.n23*=a;this.n24*=a;this.n31*=a;this.n32*=a;this.n33*=a;this.n34*=a;this.n41*=a;this.n42*=a;this.n43*=a;this.n44*=a},determinant:function(){return(this.n14*this.n23*this.n32*this.n41-this.n13*this.n24*this.n32*this.n41-this.n14*this.n22*this.n33*this.n41+this.n12*this.n24*this.n33*this.n41+this.n13*this.n22*this.n34*this.n41-this.n12*this.n23*this.n34*this.n41-this.n14*this.n23*this.n31*this.n42+this.n13*this.n24*this.n31*this.n42+this.n14*this.n21*this.n33*this.n42-this.n11*this.n24*this.n33*this.n42-this.n13*this.n21*this.n34*this.n42+this.n11*this.n23*this.n34*this.n42+this.n14*this.n22*this.n31*this.n43-this.n12*this.n24*this.n31*this.n43-this.n14*this.n21*this.n32*this.n43+this.n11*this.n24*this.n32*this.n43+this.n12*this.n21*this.n34*this.n43-this.n11*this.n22*this.n34*this.n43-this.n13*this.n22*this.n31*this.n44+this.n12*this.n23*this.n31*this.n44+this.n13*this.n21*this.n32*this.n44-this.n11*this.n23*this.n32*this.n44-this.n12*this.n21*this.n33*this.n44+this.n11*this.n22*this.n33*this.n44)},transpose:function(){function a(d,e,c){var b=d[e];d[e]=d[c];d[c]=b}a(this,"n21","n12");a(this,"n31","n13");a(this,"n32","n23");a(this,"n41","n14");a(this,"n42","n24");a(this,"n43","n34");return this},clone:function(){var a=new THREE.Matrix4();a.n11=this.n11;a.n12=this.n12;a.n13=this.n13;a.n14=this.n14;a.n21=this.n21;a.n22=this.n22;a.n23=this.n23;a.n24=this.n24;a.n31=this.n31;a.n32=this.n32;a.n33=this.n33;a.n34=this.n34;a.n41=this.n41;a.n42=this.n42;a.n43=this.n43;a.n44=this.n44;return a},flatten:function(){return[this.n11,this.n21,this.n31,this.n41,this.n12,this.n22,this.n32,this.n42,this.n13,this.n23,this.n33,this.n43,this.n14,this.n24,this.n34,this.n44]},toString:function(){return"| "+this.n11+" "+this.n12+" "+this.n13+" "+this.n14+" |\n| "+this.n21+" "+this.n22+" "+this.n23+" "+this.n24+" |\n| "+this.n31+" "+this.n32+" "+this.n33+" "+this.n34+" |\n| "+this.n41+" "+this.n42+" "+this.n43+" "+this.n44+" |"}};THREE.Matrix4.translationMatrix=function(b,d,c){var a=new THREE.Matrix4();a.n14=b;a.n24=d;a.n34=c;return a};THREE.Matrix4.scaleMatrix=function(b,d,c){var a=new THREE.Matrix4();a.n11=b;a.n22=d;a.n33=c;return a};THREE.Matrix4.rotationXMatrix=function(b){var a=new THREE.Matrix4();a.n22=a.n33=Math.cos(b);a.n32=Math.sin(b);a.n23=-a.n32;return a};THREE.Matrix4.rotationYMatrix=function(b){var a=new THREE.Matrix4();a.n11=a.n33=Math.cos(b);a.n13=Math.sin(b);a.n31=-a.n13;return a};THREE.Matrix4.rotationZMatrix=function(b){var a=new THREE.Matrix4();a.n11=a.n22=Math.cos(b);a.n21=Math.sin(b);a.n12=-a.n21;return a};THREE.Matrix4.rotationAxisAngleMatrix=function(b,d){var a=new THREE.Matrix4(),f=Math.cos(d),j=Math.sin(d),i=1-f,h=b.x,g=b.y,e=b.z;a.n11=i*h*h+f;a.n12=i*h*g-j*e;a.n13=i*h*e+j*g;a.n21=i*h*g+j*e;a.n22=i*g*g+f;a.n23=i*g*e-j*h;a.n31=i*h*e-j*g;a.n32=i*g*e+j*h;a.n33=i*e*e+f;return a};THREE.Matrix4.makeInvert=function(b){var a=new THREE.Matrix4();a.n11=b.n23*b.n34*b.n42-b.n24*b.n33*b.n42+b.n24*b.n32*b.n43-b.n22*b.n34*b.n43-b.n23*b.n32*b.n44+b.n22*b.n33*b.n44;a.n12=b.n14*b.n33*b.n42-b.n13*b.n34*b.n42-b.n14*b.n32*b.n43+b.n12*b.n34*b.n43+b.n13*b.n32*b.n44-b.n12*b.n33*b.n44;a.n13=b.n13*b.n24*b.n42-b.n14*b.n23*b.n42+b.n14*b.n22*b.n43-b.n12*b.n24*b.n43-b.n13*b.n22*b.n44+b.n12*b.n23*b.n44;a.n14=b.n14*b.n23*b.n32-b.n13*b.n24*b.n32-b.n14*b.n22*b.n33+b.n12*b.n24*b.n33+b.n13*b.n22*b.n34-b.n12*b.n23*b.n34;a.n21=b.n24*b.n33*b.n41-b.n23*b.n34*b.n41-b.n24*b.n31*b.n43+b.n21*b.n34*b.n43+b.n23*b.n31*b.n44-b.n21*b.n33*b.n44;a.n22=b.n13*b.n34*b.n41-b.n14*b.n33*b.n41+b.n14*b.n31*b.n43-b.n11*b.n34*b.n43-b.n13*b.n31*b.n44+b.n11*b.n33*b.n44;a.n23=b.n14*b.n23*b.n41-b.n13*b.n24*b.n41-b.n14*b.n21*b.n43+b.n11*b.n24*b.n43+b.n13*b.n21*b.n44-b.n11*b.n23*b.n44;a.n24=b.n13*b.n24*b.n31-b.n14*b.n23*b.n31+b.n14*b.n21*b.n33-b.n11*b.n24*b.n33-b.n13*b.n21*b.n34+b.n11*b.n23*b.n34;a.n31=b.n22*b.n34*b.n41-b.n24*b.n32*b.n41+b.n24*b.n31*b.n42-b.n21*b.n34*b.n42-b.n22*b.n31*b.n44+b.n21*b.n32*b.n44;a.n32=b.n14*b.n32*b.n41-b.n12*b.n34*b.n41-b.n14*b.n31*b.n42+b.n11*b.n34*b.n42+b.n12*b.n31*b.n44-b.n11*b.n32*b.n44;a.n33=b.n13*b.n24*b.n41-b.n14*b.n22*b.n41+b.n14*b.n21*b.n42-b.n11*b.n24*b.n42-b.n12*b.n21*b.n44+b.n11*b.n22*b.n44;a.n34=b.n14*b.n22*b.n31-b.n12*b.n24*b.n31-b.n14*b.n21*b.n32+b.n11*b.n24*b.n32+b.n12*b.n21*b.n34-b.n11*b.n22*b.n34;a.n41=b.n23*b.n32*b.n41-b.n22*b.n33*b.n41-b.n23*b.n31*b.n42+b.n21*b.n33*b.n42+b.n22*b.n31*b.n43-b.n21*b.n32*b.n43;a.n42=b.n12*b.n33*b.n41-b.n13*b.n32*b.n41+b.n13*b.n31*b.n42-b.n11*b.n33*b.n42-b.n12*b.n31*b.n43+b.n11*b.n32*b.n43;a.n43=b.n13*b.n22*b.n41-b.n12*b.n23*b.n41-b.n13*b.n21*b.n42+b.n11*b.n23*b.n42+b.n12*b.n21*b.n43-b.n11*b.n22*b.n43;a.n44=b.n12*b.n23*b.n31-b.n13*b.n22*b.n31+b.n13*b.n21*b.n32-b.n11*b.n23*b.n32-b.n12*b.n21*b.n33+b.n11*b.n22*b.n33;a.multiplyScalar(1/b.determinant());return a};THREE.Matrix4.makeFrustum=function(f,s,e,p,i,h){var g,r,o,q,n,k,j;g=new THREE.Matrix4();r=2*i/(s-f);o=2*i/(p-e);q=(s+f)/(s-f);n=(p+e)/(p-e);k=-(h+i)/(h-i);j=-2*h*i/(h-i);g.n11=r;g.n12=0;g.n13=q;g.n14=0;g.n21=0;g.n22=o;g.n23=n;g.n24=0;g.n31=0;g.n32=0;g.n33=k;g.n34=j;g.n41=0;g.n42=0;g.n43=-1;g.n44=0;return g};THREE.Matrix4.makePerspective=function(e,c,g,b){var a,f,h,d;a=g*Math.tan(e*Math.PI/360);f=-a;h=f*c;d=a*c;return THREE.Matrix4.makeFrustum(h,d,f,a,g,b)};THREE.Matrix4.makeOrtho=function(c,q,k,a,g,f){var d,n,j,i,o,e,b;d=new THREE.Matrix4();o=q-c;e=a-k;b=f-g;n=(q+c)/o;j=(a+k)/e;i=(f+g)/b;d.n11=2/o;d.n12=0;d.n13=0;d.n14=-n;d.n21=0;d.n22=2/e;d.n23=0;d.n24=-j;d.n31=0;d.n32=0;d.n33=-2/b;d.n34=-i;d.n41=0;d.n42=0;d.n43=0;d.n44=1;return d};THREE.Vertex=function(a,b){this.position=a||new THREE.Vector3();this.positionWorld=new THREE.Vector3();this.positionScreen=new THREE.Vector3();this.normal=b||new THREE.Vector3();this.normalWorld=new THREE.Vector3();this.normalScreen=new THREE.Vector3();this.__visible=true};THREE.Vertex.prototype={toString:function(){return"THREE.Vertex ( position: "+this.position+", normal: "+this.normal+" )"}};THREE.Face3=function(e,d,i,h,f,g){this.a=e;this.b=d;this.c=i;this.centroid=new THREE.Vector3();this.normal=h instanceof THREE.Vector3?h:new THREE.Vector3();this.color=f||new THREE.Color(4278190080);this.vertexNormals=h instanceof Array?h:[];this.material=g||0};THREE.Face3.prototype={getCenter:function(){return this.a.clone().addSelf(this.b).addSelf(this.c).divideScalar(3)},toString:function(){return"THREE.Face3 ( "+this.a+", "+this.b+", "+this.c+" )"}};THREE.Face4=function(f,e,k,j,i,g,h){this.a=f;this.b=e;this.c=k;this.d=j;this.centroid=new THREE.Vector3();this.normal=i instanceof THREE.Vector3?i:new THREE.Vector3();this.color=g||new THREE.Color(4278190080);this.vertexNormals=i instanceof Array?i:[];this.material=h||0};THREE.Face4.prototype={getCenter:function(){return this.a.clone().addSelf(this.b).addSelf(this.c).addSelf(this.d).divideScalar(4)},toString:function(){return"THREE.Face4 ( "+this.a+", "+this.b+", "+this.c+" "+this.d+" )"}};THREE.UV=function(b,a){this.u=b||0;this.v=a||0};THREE.UV.prototype={copy:function(a){this.u=a.u;this.v=a.v},toString:function(){return"THREE.UV ("+this.u+", "+this.v+")"}};THREE.Geometry=function(){this.vertices=[];this.faces=[];this.uvs=[]};THREE.Geometry.prototype={computeCentroids:function(){var c,b,a;for(c=0,b=this.faces.length;c<b;c++){a=this.faces[c];a.centroid.set(0,0,0);if(a instanceof THREE.Face3){a.centroid.addSelf(this.vertices[a.a].position);a.centroid.addSelf(this.vertices[a.b].position);a.centroid.addSelf(this.vertices[a.c].position);a.centroid.divideScalar(3)}else{if(a instanceof THREE.Face4){a.centroid.addSelf(this.vertices[a.a].position);a.centroid.addSelf(this.vertices[a.b].position);a.centroid.addSelf(this.vertices[a.c].position);a.centroid.addSelf(this.vertices[a.d].position);a.centroid.divideScalar(4)}}}},computeNormals:function(o){var e,b,p,g,i,j,m,k,d,c,a,h=new THREE.Vector3(),q=new THREE.Vector3();for(p=0,g=this.vertices.length;p<g;p++){i=this.vertices[p];i.normal.set(0,0,0)}for(j=0,m=this.faces.length;j<m;j++){k=this.faces[j];if(o&&k.vertexNormals.length){h.set(0,0,0);for(e=0,b=k.normal.length;e<b;e++){h.x+=k.vertexNormals[e].x;h.y+=k.vertexNormals[e].y;h.z+=k.vertexNormals[e].z}h.x/=3;h.y/=3;h.z/=3;if(!h.isZero()){h.normalize()}k.normal.copy(h)}else{d=this.vertices[k.a];c=this.vertices[k.b];a=this.vertices[k.c];h.sub(a.position,c.position);q.sub(d.position,c.position);h.crossSelf(q);if(!h.isZero()){h.normalize()}k.normal.copy(h)}}},computeBoundingBox:function(){if(this.vertices.length>0){this.bbox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};var a,b;for(a=1,b=this.vertices.length;a<b;a++){vertex=this.vertices[a];if(vertex.position.x<this.bbox.x[0]){this.bbox.x[0]=vertex.position.x}else{if(vertex.position.x>this.bbox.x[1]){this.bbox.x[1]=vertex.position.x}}if(vertex.position.y<this.bbox.y[0]){this.bbox.y[0]=vertex.position.y}else{if(vertex.position.y>this.bbox.y[1]){this.bbox.y[1]=vertex.position.y}}if(vertex.position.z<this.bbox.z[0]){this.bbox.z[0]=vertex.position.z}else{if(vertex.position.z>this.bbox.z[1]){this.bbox.z[1]=vertex.position.z}}}}},toString:function(){return"THREE.Geometry ( vertices: "+this.vertices+", faces: "+this.faces+" )"}};THREE.Camera=function(c,b,d,a){this.fov=c;this.aspect=b;this.position=new THREE.Vector3(0,0,0);this.target={position:new THREE.Vector3(0,0,0)};this.projectionMatrix=THREE.Matrix4.makePerspective(c,b,d,a);this.up=new THREE.Vector3(0,1,0);this.matrix=new THREE.Matrix4();this.autoUpdateMatrix=true;this.updateMatrix=function(){this.matrix.lookAt(this.position,this.target.position,this.up)};this.toString=function(){return"THREE.Camera ( "+this.position+", "+this.target.position+" )"}};THREE.Light=function(a){this.color=new THREE.Color(255<<24|a)};THREE.AmbientLight=function(a){THREE.Light.call(this,a)};THREE.AmbientLight.prototype=new THREE.Light();THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(b,a){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.intensity=a||1};THREE.DirectionalLight.prototype=new THREE.Light();THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(b,a){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,0,0);this.intensity=a||1};THREE.DirectionalLight.prototype=new THREE.Light();THREE.DirectionalLight.prototype.constructor=THREE.PointLight;THREE.Object3D=function(a){this.position=new THREE.Vector3();this.rotation=new THREE.Vector3();this.scale=new THREE.Vector3(1,1,1);this.matrix=new THREE.Matrix4();this.matrixTranslation=new THREE.Matrix4();this.matrixRotation=new THREE.Matrix4();this.matrixScale=new THREE.Matrix4();this.screen=new THREE.Vector3();this.autoUpdateMatrix=true;this.updateMatrix=function(){this.matrixPosition=THREE.Matrix4.translationMatrix(this.position.x,this.position.y,this.position.z);this.matrixRotation=THREE.Matrix4.rotationXMatrix(this.rotation.x);this.matrixRotation.multiplySelf(THREE.Matrix4.rotationYMatrix(this.rotation.y));this.matrixRotation.multiplySelf(THREE.Matrix4.rotationZMatrix(this.rotation.z));this.matrixScale=THREE.Matrix4.scaleMatrix(this.scale.x,this.scale.y,this.scale.z);this.matrix.copy(this.matrixPosition);this.matrix.multiplySelf(this.matrixRotation);this.matrix.multiplySelf(this.matrixScale)}};THREE.Particle=function(a){THREE.Object3D.call(this);this.material=a instanceof Array?a:[a];this.autoUpdateMatrix=false};THREE.Particle.prototype=new THREE.Object3D();THREE.Particle.prototype.constructor=THREE.Particle;THREE.Line=function(b,a){THREE.Object3D.call(this);this.geometry=b;this.material=a instanceof Array?a:[a]};THREE.Line.prototype=new THREE.Object3D();THREE.Line.prototype.constructor=THREE.Line;THREE.Mesh=function(b,a,c){THREE.Object3D.call(this);this.geometry=b;this.material=a instanceof Array?a:[a];this.flipSided=false;this.doubleSided=false;this.overdraw=false;this.materialFaces={};this.sortFacesByMaterial();if(c){this.normalizeUVs()}this.geometry.computeBoundingBox()};THREE.Mesh.prototype=new THREE.Object3D();THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.sortFacesByMaterial=function(){var d,c,b,a;for(d=0,c=this.geometry.faces.length;d<c;d++){b=this.geometry.faces[d];a=b.material;if(this.materialFaces[a]==undefined){this.materialFaces[a]={faces:[]}}this.materialFaces[a].faces.push(d)}};THREE.Mesh.prototype.normalizeUVs=function(){var c,a;for(c=0,l=this.geometry.uvs.length;c<l;c++){var b=this.geometry.uvs[c];for(a=0,jl=b.length;a<jl;a++){if(b[a].u!=1){b[a].u=b[a].u-Math.floor(b[a].u)}if(b[a].v!=1){b[a].v=b[a].v-Math.floor(b[a].v)}}}};THREE.LineColorMaterial=function(c,b,a){this.lineWidth=a||1;this.color=new THREE.Color((b>=0?(b*255)<<24:4278190080)|c)};THREE.LineColorMaterial.prototype={toString:function(){return"THREE.LineColorMaterial ( color: "+this.color+", lineWidth: "+this.lineWidth+" )"}};THREE.MeshBitmapUVMappingMaterial=function(a){this.bitmap=a;this.loaded=0;this.decalIndex=-1;this.toString=function(){return"THREE.MeshBitmapUVMappingMaterial ( bitmap: "+this.bitmap+" )"}};THREE.MeshColorFillMaterial=function(b,a){this.color=new THREE.Color((a>=0?(a*255)<<24:4278190080)|b);this.toString=function(){return"THREE.MeshColorFillMaterial ( color: "+this.color+" )"}};THREE.MeshColorStrokeMaterial=function(c,b,a){this.lineWidth=a||1;this.color=new THREE.Color((b>=0?(b*255)<<24:4278190080)|c);this.toString=function(){return"THREE.MeshColorStrokeMaterial ( lineWidth: "+this.lineWidth+", color: "+this.color+" )"}};THREE.MeshFaceColorFillMaterial=function(){this.toString=function(){return"THREE.MeshFaceColorFillMaterial ( )"}};THREE.MeshFaceColorStrokeMaterial=function(a){this.lineWidth=a||1;this.toString=function(){return"THREE.MeshFaceColorStrokeMaterial ( lineWidth: "+this.lineWidth+" )"}};THREE.ParticleBitmapMaterial=function(a){this.bitmap=a;this.offset=new THREE.Vector2();this.toString=function(){return"THREE.ParticleBitmapMaterial ( bitmap: "+this.bitmap+" )"}};THREE.ParticleCircleMaterial=function(b,a){this.color=new THREE.Color((a>=0?(a*255)<<24:4278190080)|b);this.toString=function(){return"THREE.ParticleCircleMaterial ( color: "+this.color+" )"}};THREE.ParticleDOMMaterial=function(a){this.domElement=a;this.toString=function(){return"THREE.ParticleDOMMaterial ( domElement: "+this.domElement+" )"}};THREE.Scene=function(){this.objects=[];this.lights=[];this.addObject=function(a){this.objects.push(a)};this.removeObject=function(b){for(var c=0,a=this.objects.length;c<a;c++){if(b==this.objects[c]){this.objects.splice(c,1);return}}};this.addLight=function(a){this.lights.push(a)};this.removeLight=function(b){for(var c=0,a=this.lights.length;c<a;c++){if(b==this.lights[c]){this.lights.splice(c,1);return}}};this.add=function(a){this.addObject(a)};this.toString=function(){return"THREE.Scene ( "+this.objects+" )"}};THREE.Projector=function(){var e=null,c,r,p=[],b,f,m=[],k,n,i=[],j,h,a=[],g=new THREE.Vector4(),d=new THREE.Matrix4(),q=new THREE.Matrix4();this.projectScene=function(L,I){var H,G,F,M,K,D,t,N,s,B,J,x,E,y,C,A,z,w,u;e=[];r=0,f=0,n=0,h=0;if(I.autoUpdateMatrix){I.updateMatrix()}d.multiply(I.projectionMatrix,I.matrix);t=L.objects;for(H=0,G=t.length;H<G;H++){N=t[H];s=N.matrix;if(N.autoUpdateMatrix){N.updateMatrix()}if(N instanceof THREE.Mesh){q.multiply(d,s);B=N.geometry.vertices;for(F=0,M=B.length;F<M;F++){J=B[F];x=J.positionScreen;x.copy(J.position);q.transform(x);J.__visible=x.z>0&&x.z<1}y=N.geometry.faces;for(K=0,D=y.length;K<D;K++){C=y[K];if(C instanceof THREE.Face3){A=B[C.a];z=B[C.b];w=B[C.c];if(A.__visible&&z.__visible&&w.__visible){if((N.doubleSided||(N.flipSided!=(w.positionScreen.x-A.positionScreen.x)*(z.positionScreen.y-A.positionScreen.y)-(w.positionScreen.y-A.positionScreen.y)*(z.positionScreen.x-A.positionScreen.x)<0))){c=p[r]=p[r]||new THREE.RenderableFace3();c.v1.copy(A.positionScreen);c.v2.copy(z.positionScreen);c.v3.copy(w.positionScreen);c.centroidWorld.copy(C.centroid);N.matrix.transform(c.centroidWorld);c.normalWorld.copy(C.normal);N.matrixRotation.transform(c.normalWorld);c.z=Math.max(A.positionScreen.z,Math.max(z.positionScreen.z,w.positionScreen.z));c.material=N.material;c.materialIndex=C.material;c.overdraw=N.overdraw;c.uvs=N.geometry.uvs[K];c.color=C.color;e.push(c);r++}}}else{if(C instanceof THREE.Face4){A=B[C.a];z=B[C.b];w=B[C.c];u=B[C.d];if(A.__visible&&z.__visible&&w.__visible&&u.__visible){if((N.doubleSided||(N.flipSided!=((u.positionScreen.x-A.positionScreen.x)*(z.positionScreen.y-A.positionScreen.y)-(u.positionScreen.y-A.positionScreen.y)*(z.positionScreen.x-A.positionScreen.x)<0||(z.positionScreen.x-w.positionScreen.x)*(u.positionScreen.y-w.positionScreen.y)-(z.positionScreen.y-w.positionScreen.y)*(u.positionScreen.x-w.positionScreen.x)<0)))){b=m[f]=m[f]||new THREE.RenderableFace4();b.v1.copy(A.positionScreen);b.v2.copy(z.positionScreen);b.v3.copy(w.positionScreen);b.v4.copy(u.positionScreen);b.centroidWorld.copy(C.centroid);N.matrix.transform(b.centroidWorld);b.normalWorld.copy(C.normal);N.matrixRotation.transform(b.normalWorld);b.z=Math.max(A.positionScreen.z,Math.max(z.positionScreen.z,Math.max(w.positionScreen.z,u.positionScreen.z)));b.material=N.material;b.materialIndex=C.material;b.overdraw=N.overdraw;b.uvs=N.geometry.uvs[K];b.color=C.color;e.push(b);f++}}}}}}else{if(N instanceof THREE.Line){q.multiply(d,s);B=N.geometry.vertices;for(F=0,M=B.length;F<M;F++){J=B[F];x=J.positionScreen;x.copy(J.position);q.transform(x);J.__visible=x.z>0&&x.z<1;if(F>0){E=N.geometry.vertices[F-1];if(J.__visible&&E.__visible){k=i[n]=i[n]||new THREE.RenderableLine();k.v1.copy(J.positionScreen);k.v2.copy(E.positionScreen);k.z=Math.max(J.positionScreen.z,E.positionScreen.z);k.material=N.material;e.push(k);n++}}}}else{if(N instanceof THREE.Particle){g.set(N.position.x,N.position.y,N.position.z,1);I.matrix.transform(g);I.projectionMatrix.transform(g);N.screen.set(g.x/g.w,g.y/g.w,g.z/g.w);if(N.screen.z>0&&N.screen.z<1){j=a[h]=a[h]||new THREE.RenderableParticle();j.x=N.screen.x;j.y=N.screen.y;j.z=N.screen.z;j.rotation=N.rotation.z;j.scale.x=N.scale.x*Math.abs(g.x/g.w-(g.x+I.projectionMatrix.n11)/(g.w+I.projectionMatrix.n14));j.scale.y=N.scale.y*Math.abs(g.y/g.w-(g.y+I.projectionMatrix.n22)/(g.w+I.projectionMatrix.n24));j.material=N.material;j.color=N.color;e.push(j);h++}}}}}e.sort(o);return e};function o(t,s){return s.z-t.z}};THREE.DOMRenderer=function(){THREE.Renderer.call(this);var e=null,g=new THREE.Projector(),b=document.createElement("div"),a,c,f,d;this.domElement=b;this.setSize=function(i,h){a=i;c=h;f=a/2;d=c/2};this.render=function(q,s){var r,h,i,o,p,t,n,k,j;e=g.projectScene(q,s);for(r=0,h=e.length;r<h;r++){p=e[r];if(p instanceof THREE.RenderableParticle){k=p.x*f+f;j=p.y*d+d;for(i=0,o=p.material.length;i<o;i++){t=p.material[i];if(t instanceof THREE.ParticleDOMMaterial){n=t.domElement;n.style.left=k+"px";n.style.top=j+"px"}}}}}};THREE.CanvasRenderer=function(){var v=null,p=new THREE.Projector(),n=document.createElement("canvas"),o=n.getContext("2d"),h,A,k,c,z=new THREE.Rectangle(),j=new THREE.Rectangle(),t=new THREE.Rectangle(),i=new THREE.Color(4294967295),r=new THREE.Color(4294967295),e=new THREE.Color(4294967295),g=new THREE.Vector2(),f=new THREE.Vector3(),d=new THREE.Vector2(),a=new THREE.Vector2(),y=new THREE.UV(),x=new THREE.UV(),u=new THREE.UV(),s=new THREE.UV();this.domElement=n;this.autoClear=true;this.setSize=function(C,B){h=C;A=B;k=h/2;c=A/2;n.width=h;n.height=A;z.set(-k,-c,k,c)};this.clear=function(){if(!j.isEmpty()){j.inflate(1);j.minSelf(z);o.setTransform(1,0,0,-1,k,c);o.clearRect(j.getX(),j.getY(),j.getWidth(),j.getHeight());j.empty()}};this.render=function(ab,W){var aa,E,G,Q,X,M,O=Math.PI*2,I,H,U,S,D,B,K,J,V,T,F,C,P,N,ad,ac,Z,Y,ae,L,R;if(this.autoClear){this.clear()}v=p.projectScene(ab,W);o.setTransform(1,0,0,-1,k,c);o.fillStyle="rgba(0, 255, 255, 0.5)";o.fillRect(z.getX(),z.getY(),z.getWidth(),z.getHeight());w(ab,e);for(aa=0,E=v.length;aa<E;aa++){G=v[aa];t.empty();if(G instanceof THREE.RenderableParticle){I=G.x*k;H=G.y*c;for(Q=0,X=G.material.length;Q<X;Q++){M=G.material[Q];if(M instanceof THREE.ParticleCircleMaterial){r.copyRGB(e);i.copyRGBA(M.color);i.multiplySelfRGB(r);i.updateStyleString();P=G.scale.x*k;N=G.scale.y*c;t.set(I-P,H-N,I+P,H+N);if(!z.instersects(t)){continue}o.save();o.translate(I,H);o.rotate(-G.rotation);o.scale(P,N);o.beginPath();o.arc(0,0,1,0,O,true);o.closePath();o.fillStyle=i.__styleString;o.fill();o.restore()}else{if(M instanceof THREE.ParticleBitmapMaterial){ae=M.bitmap;L=ae.width/2;R=ae.height/2;ad=G.scale.x*k;ac=G.scale.y*c;P=ad*L;N=ac*R;Z=M.offset.x*ad;Y=M.offset.y*ac;t.set(I+Z-P,H+Y-N,I+Z+P,H+Y+N);if(!z.instersects(t)){continue}o.save();o.translate(I,H);o.rotate(-G.rotation);o.scale(ad,-ac);o.translate(-L+M.offset.x,-R-M.offset.y);o.drawImage(ae,0,0);o.restore();o.beginPath();o.moveTo(I-10,H);o.lineTo(I+10,H);o.moveTo(I,H-10);o.lineTo(I,H+10);o.closePath();o.strokeStyle="rgb(255,255,0)";o.stroke()}}}}else{if(G instanceof THREE.RenderableLine){I=G.v1.x*k;H=G.v1.y*c;U=G.v2.x*k;S=G.v2.y*c;t.addPoint(I,H);t.addPoint(U,S);if(!z.instersects(t)){continue}o.beginPath();o.moveTo(I,H);o.lineTo(U,S);o.closePath();for(Q=0,X=G.material.length;Q<X;Q++){M=G.material[Q];if(M instanceof THREE.LineColorMaterial){r.copyRGB(e);i.copyRGBA(M.color);i.multiplySelfRGB(r);i.updateStyleString();o.lineWidth=M.lineWidth;o.lineJoin="round";o.lineCap="round";o.strokeStyle=i.__styleString;o.stroke();t.inflate(o.lineWidth)}}}else{if(G instanceof THREE.RenderableFace3){G.v1.x*=k;G.v1.y*=c;G.v2.x*=k;G.v2.y*=c;G.v3.x*=k;G.v3.y*=c;if(G.overdraw){b(G.v1,G.v2);b(G.v2,G.v3);b(G.v3,G.v1)}I=G.v1.x;H=G.v1.y;U=G.v2.x;S=G.v2.y;D=G.v3.x;B=G.v3.y;t.addPoint(I,H);t.addPoint(U,S);t.addPoint(D,B);if(!z.instersects(t)){continue}for(Q=0,X=G.material.length;Q<X;Q++){M=G.material[Q];if(M instanceof THREE.MeshColorFillMaterial){r.copyRGB(e);m(ab,G,r);i.copyRGBA(M.color);i.multiplySelfRGB(r);i.updateStyleString();o.beginPath();o.moveTo(I,H);o.lineTo(U,S);o.lineTo(D,B);o.lineTo(I,H);o.closePath();o.fillStyle=i.__styleString;o.fill()}else{if(M instanceof THREE.MeshColorStrokeMaterial){r.copyRGB(e);m(ab,G,r);i.copyRGBA(M.color);i.multiplySelfRGB(r);i.updateStyleString();o.beginPath();o.moveTo(I,H);o.lineTo(U,S);o.lineTo(D,B);o.lineTo(I,H);o.closePath();o.lineWidth=M.lineWidth;o.lineJoin="round";o.lineCap="round";o.strokeStyle=i.__styleString;o.stroke();t.inflate(o.lineWidth)}else{if(M instanceof THREE.MeshFaceColorFillMaterial){r.copyRGB(e);m(ab,G,r);i.copyRGBA(G.color);i.multiplySelfRGB(r);i.updateStyleString();o.beginPath();o.moveTo(I,H);o.lineTo(U,S);o.lineTo(D,B);o.lineTo(I,H);o.closePath();o.fillStyle=i.__styleString;o.fill()}else{if(M instanceof THREE.MeshFaceColorStrokeMaterial){r.copyRGB(e);m(ab,G,r);i.copyRGBA(G.color);i.multiplySelfRGB(r);i.updateStyleString();o.beginPath();o.moveTo(I,H);o.lineTo(U,S);o.lineTo(D,B);o.lineTo(I,H);o.closePath();o.lineWidth=M.lineWidth;o.lineJoin="round";o.lineCap="round";o.strokeStyle=i.__styleString;o.stroke();t.inflate(o.lineWidth)}else{if(M instanceof THREE.MeshBitmapUVMappingMaterial&&(Q==G.materialIndex||G.materialIndex==M.decalIndex)){ae=M.bitmap;L=ae.width-1;R=ae.height-1;if(!G.uvs[0]||!G.uvs[1]||!G.uvs[2]){o.beginPath();o.moveTo(I,H);o.lineTo(U,S);o.lineTo(D,B);o.lineTo(I,H);o.closePath();o.fillStyle="rgb(0, 255, 0)";o.fill();continue}y.copy(G.uvs[0]);x.copy(G.uvs[1]);u.copy(G.uvs[2]);y.u*=L;y.v*=R;x.u*=L;x.v*=R;u.u*=L;u.v*=R;q(ae,I,H,U,S,D,B,y.u,y.v,x.u,x.v,u.u,u.v)}}}}}}}else{if(G instanceof THREE.RenderableFace4){G.v1.x*=k;G.v1.y*=c;G.v2.x*=k;G.v2.y*=c;G.v3.x*=k;G.v3.y*=c;G.v4.x*=k;G.v4.y*=c;d.copy(G.v2);a.copy(G.v4);if(G.overdraw){b(G.v1,G.v2);b(G.v2,G.v4);b(G.v4,G.v1)}I=G.v1.x;H=G.v1.y;U=G.v2.x;S=G.v2.y;K=G.v4.x;J=G.v4.y;if(G.overdraw){b(G.v3,d);b(G.v3,a)}D=G.v3.x;B=G.v3.y;V=d.x;T=d.y;F=a.x;C=a.y;t.addPoint(I,H);t.addPoint(U,S);t.addPoint(D,B);t.addPoint(K,J);if(!z.instersects(t)){continue}for(Q=0,X=G.material.length;Q<X;Q++){M=G.material[Q];if(M instanceof THREE.MeshColorFillMaterial){r.copyRGB(e);m(ab,G,r);i.copyRGBA(M.color);i.multiplySelfRGB(r);i.updateStyleString();o.beginPath();o.moveTo(I,H);o.lineTo(U,S);o.lineTo(D,B);o.lineTo(K,J);o.lineTo(I,H);o.closePath();o.fillStyle=i.__styleString;o.fill()}else{if(M instanceof THREE.MeshColorStrokeMaterial){r.copyRGB(e);m(ab,G,r);i.copyRGBA(M.color);i.multiplySelfRGB(r);i.updateStyleString();o.beginPath();o.moveTo(I,H);o.lineTo(U,S);o.lineTo(D,B);o.lineTo(K,J);o.lineTo(I,H);o.closePath();o.lineWidth=M.lineWidth;o.lineJoin="round";o.lineCap="round";o.strokeStyle=i.__styleString;o.stroke();t.inflate(o.lineWidth)}else{if(M instanceof THREE.MeshFaceColorFillMaterial){r.copyRGB(e);m(ab,G,r);i.copyRGBA(G.color);i.multiplySelfRGB(r);i.updateStyleString();o.beginPath();o.moveTo(I,H);o.lineTo(U,S);o.lineTo(D,B);o.lineTo(K,J);o.lineTo(I,H);o.closePath();o.fillStyle=i.__styleString;o.fill()}else{if(M instanceof THREE.MeshFaceColorStrokeMaterial){r.copyRGB(e);m(ab,G,r);i.copyRGBA(G.color);i.multiplySelfRGB(r);i.updateStyleString();o.beginPath();o.moveTo(I,H);o.lineTo(U,S);o.lineTo(D,B);o.lineTo(K,J);o.lineTo(I,H);o.closePath();o.lineWidth=M.lineWidth;o.lineJoin="round";o.lineCap="round";o.strokeStyle=i.__styleString;o.stroke();t.inflate(o.lineWidth)}else{if(M instanceof THREE.MeshBitmapUVMappingMaterial&&(Q==G.materialIndex||G.materialIndex==M.decalIndex)){ae=M.bitmap;L=ae.width-1;R=ae.height-1;if(!G.uvs[0]||!G.uvs[1]||!G.uvs[2]||!G.uvs[3]){o.beginPath();o.moveTo(I,H);o.lineTo(U,S);o.lineTo(D,B);o.lineTo(K,J);o.lineTo(I,H);o.closePath();o.fillStyle="rgb(255, 0, 255)";o.fill();continue}y.copy(G.uvs[0]);x.copy(G.uvs[1]);u.copy(G.uvs[2]);s.copy(G.uvs[3]);y.u*=L;y.v*=R;x.u*=L;x.v*=R;u.u*=L;u.v*=R;s.u*=L;s.v*=R;q(ae,I,H,U,S,K,J,y.u,y.v,x.u,x.v,s.u,s.v);q(ae,V,T,D,B,F,C,x.u,x.v,u.u,u.v,s.u,s.v)}}}}}}}}}}j.addRectangle(t)}o.lineWidth=1;o.strokeStyle="rgba( 255, 0, 0, 0.5 )";o.strokeRect(j.getX(),j.getY(),j.getWidth(),j.getHeight());o.setTransform(1,0,0,1,0,0)};function w(F,D){var C,E,B;D.setRGBA(1,1,1,1);for(C=0,E=F.lights.length;C<E;C++){B=F.lights[C];if(B instanceof THREE.AmbientLight){D.r*=B.color.r;D.g*=B.color.g;D.b*=B.color.b}}}function m(H,F,D){var C,G,B,E;for(C=0,G=H.lights.length;C<G;C++){B=H.lights[C];if(B instanceof THREE.DirectionalLight){E=F.normalWorld.dot(B.position)*B.intensity;if(E>0){D.r+=B.color.r*E;D.g+=B.color.g*E;D.b+=B.color.b*E}}else{if(B instanceof THREE.PointLight){f.sub(B.position,F.centroidWorld);f.normalize();E=F.normalWorld.dot(f)*B.intensity;if(E>0){D.r+=B.color.r*E;D.g+=B.color.g*E;D.b+=B.color.b*E}}}}}function q(U,J,I,P,O,D,B,R,Q,F,E,N,M){var C,T,S,H,G,L,K;o.beginPath();o.moveTo(J,I);o.lineTo(P,O);o.lineTo(D,B);o.lineTo(J,I);o.closePath();o.save();o.clip();C=R*(M-E)-F*M+N*E+(F-N)*Q;T=-(Q*(D-P)-E*D+M*P+(E-M)*J)/C;S=(E*B+Q*(O-B)-M*O+(M-E)*I)/C;H=(R*(D-P)-F*D+N*P+(F-N)*J)/C;G=-(F*B+R*(O-B)-N*O+(N-F)*I)/C;L=(R*(M*P-E*D)+Q*(F*D-N*P)+(N*E-F*M)*J)/C;K=(R*(M*O-E*B)+Q*(F*B-N*O)+(N*E-F*M)*I)/C;o.transform(T,S,H,G,L,K);o.drawImage(U,0,0);o.restore()}function b(C,B){g.sub(B,C);g.unit();g.multiplyScalar(0.75);B.addSelf(g);C.subSelf(g)}};THREE.SVGRenderer=function(){var q=null,k=new THREE.Projector(),m=document.createElementNS("http://www.w3.org/2000/svg","svg"),e,u,i,a,s=new THREE.Rectangle(),p=new THREE.Rectangle(),f=new THREE.Color(4294967295),o=new THREE.Color(4294967295),b=new THREE.Color(4294967295),d=new THREE.Vector3(),c=[],g=[],t=1;this.domElement=m;this.autoClear=true;this.setQuality=function(v){switch(v){case"high":t=1;break;case"low":t=0;break}};this.setSize=function(w,v){e=w;u=v;i=e/2;a=u/2;m.setAttribute("viewBox",(-i)+" "+(-a)+" "+e+" "+u);m.setAttribute("width",e);m.setAttribute("height",u);s.set(-i,-a,i,a)};this.clear=function(){while(m.childNodes.length>0){m.removeChild(m.childNodes[0])}};this.render=function(O,L){var N,x,I,M,y,E,H=0,z=0,F,C,A,K,J,w,v,D,B,G;if(this.autoClear){this.clear()}q=k.projectScene(O,L);r(O,b);for(N=0,x=q.length;N<x;N++){y=q[N];for(I=0,M=y.material.length;I<M;I++){E=y.material[I];p.empty();if(y instanceof THREE.RenderableParticle){C=y.x*i;A=y.y*-a;G=y.size*i;p.set(C-G,A-G,C+G,A+G);if(!s.instersects(p)){continue}F=n(z++);F.setAttribute("cx",C);F.setAttribute("cy",A);F.setAttribute("r",G)}else{if(y instanceof THREE.RenderableFace3){C=y.v1.x*i;A=y.v1.y*-a;K=y.v2.x*i;J=y.v2.y*-a;w=y.v3.x*i;v=y.v3.y*-a;p.addPoint(C,A);p.addPoint(K,J);p.addPoint(w,v);if(!s.instersects(p)){continue}F=h(H++);F.setAttribute("d","M "+C+" "+A+" L "+K+" "+J+" L "+w+","+v+"z")}else{if(y instanceof THREE.RenderableFace4){C=y.v1.x*i;A=y.v1.y*-a;K=y.v2.x*i;J=y.v2.y*-a;w=y.v3.x*i;v=y.v3.y*-a;D=y.v4.x*i;B=y.v4.y*-a;p.addPoint(C,A);p.addPoint(K,J);p.addPoint(w,v);p.addPoint(D,B);if(!s.instersects(p)){continue}F=h(H++);F.setAttribute("d","M "+C+" "+A+" L "+K+" "+J+" L "+w+","+v+" L "+D+","+B+"z")}}}if(E instanceof THREE.MeshColorFillMaterial){o.copyRGB(b);j(O,y,o);f.copyRGBA(E.color);f.multiplySelfRGB(o);f.updateStyleString();F.setAttribute("style","fill: "+f.__styleString)}else{if(E instanceof THREE.MeshFaceColorFillMaterial){o.copyRGB(b);j(O,y,o);f.copyRGBA(y.color);f.multiplySelfRGB(o);f.updateStyleString();F.setAttribute("style","fill: "+f.__styleString)}else{if(E instanceof THREE.MeshColorStrokeMaterial){o.copyRGB(b);j(O,y,o);f.copyRGBA(E.color);f.multiplySelfRGB(o);f.updateStyleString();F.setAttribute("style","fill: none; stroke: "+f.__styleString+"; stroke-width: "+E.lineWidth+"; stroke-linecap: round; stroke-linejoin: round")}else{if(E instanceof THREE.MeshFaceColorStrokeMaterial){o.copyRGB(b);j(O,y,o);f.copyRGBA(y.color);f.multiplySelfRGB(o);f.updateStyleString();F.setAttribute("style","fill: none; stroke: "+f.__styleString+"; stroke-width: "+E.lineWidth+"; stroke-linecap: round; stroke-linejoin: round")}}}}m.appendChild(F)}}};function r(z,x){var w,y,v;x.setRGBA(1,1,1,1);for(w=0,y=z.lights.length;w<y;w++){v=z.lights[w];if(v instanceof THREE.AmbientLight){x.r*=v.color.r;x.g*=v.color.g;x.b*=v.color.b}}}function j(B,z,x){var w,A,v,y;for(w=0,A=B.lights.length;w<A;w++){v=B.lights[w];if(v instanceof THREE.DirectionalLight){y=z.normalWorld.dot(v.position)*v.intensity;if(y>0){x.r+=v.color.r*y;x.g+=v.color.g*y;x.b+=v.color.b*y}}else{if(v instanceof THREE.PointLight){d.sub(v.position,z.centroidWorld);d.normalize();y=z.normalWorld.dot(d)*v.intensity;if(y>0){x.r+=v.color.r*y;x.g+=v.color.g*y;x.b+=v.color.b*y}}}}}function h(v){if(c[v]==null){c[v]=document.createElementNS("http://www.w3.org/2000/svg","path");if(t==0){c[v].setAttribute("shape-rendering","crispEdges")}return c[v]}return c[v]}function n(v){if(g[v]==null){g[v]=document.createElementNS("http://www.w3.org/2000/svg","circle");if(t==0){g[v].setAttribute("shape-rendering","crispEdges")}return g[v]}return g[v]}};THREE.WebGLRenderer=function(){var e=document.createElement("canvas"),a,h,d=new THREE.Matrix4(),g;this.domElement=e;this.autoClear=true;f();c();this.setSize=function(j,i){e.width=j;e.height=i;a.viewport(0,0,e.width,e.height)};this.clear=function(){a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)};this.render=function(O,K){var v,P,R,C,Q,G,u,q,B,D,s,N,y,F,A,M,w,H,L,J,p,n,k,j,I,x,t,E;if(this.autoClear){this.clear()}a.uniform1i(h.enableLighting,O.lights.length);for(I=0,x=O.lights.length;I<x;I++){q=O.lights[I];if(q instanceof THREE.AmbientLight){G=q.color;a.uniform3f(h.ambientColor,G.r,G.g,G.b)}else{if(q instanceof THREE.DirectionalLight){G=q.color;u=q.position;a.uniform3f(h.lightingDirection,u.x,u.y,u.z);a.uniform3f(h.directionalColor,G.r,G.g,G.b)}}}for(F=0,A=O.objects.length;F<A;F++){R=O.objects[F];var r,z;if(R instanceof THREE.Mesh){d.multiply(K.matrix,R.matrix);h.viewMatrixArray=new Float32Array(d.flatten());h.projectionMatrixArray=new Float32Array(K.projectionMatrix.flatten());g=THREE.Matrix4.makeInvert(d).transpose();h.normalMatrixArray=new Float32Array(g.flatten());a.uniformMatrix4fv(h.viewMatrix,false,h.viewMatrixArray);a.uniformMatrix4fv(h.projectionMatrix,false,h.projectionMatrixArray);a.uniformMatrix4fv(h.normalMatrix,false,h.normalMatrixArray);for(var H in R.materialFaces){r=R.materialFaces[H];C=R.material[H];if(!C){continue}if(!r.__webGLVertexBuffer){B=[];D=[];s=[];N=[];E=[];y=0;for(M=0,w=r.faces.length;M<w;M++){z=r.faces[M];v=R.geometry.faces[z];P=v.color;vertexNormals=v.vertexNormals;Q=v.normal;t=R.geometry.uvs[z];if(v instanceof THREE.Face3){p=R.geometry.vertices[v.a].position;n=R.geometry.vertices[v.b].position;k=R.geometry.vertices[v.c].position;B.push(p.x,p.y,p.z);B.push(n.x,n.y,n.z);B.push(k.x,k.y,k.z);if(vertexNormals.length==3){N.push(vertexNormals[0].x,vertexNormals[0].y,vertexNormals[0].z);N.push(vertexNormals[1].x,vertexNormals[1].y,vertexNormals[1].z);N.push(vertexNormals[2].x,vertexNormals[2].y,vertexNormals[2].z)}else{N.push(Q.x,Q.y,Q.z);N.push(Q.x,Q.y,Q.z);N.push(Q.x,Q.y,Q.z)}s.push(P.r,P.g,P.b,P.a);s.push(P.r,P.g,P.b,P.a);s.push(P.r,P.g,P.b,P.a);if(t){E.push(t[0].u,t[0].v);E.push(t[1].u,t[1].v);E.push(t[2].u,t[2].v)}D.push(y,y+1,y+2);y+=3}else{if(v instanceof THREE.Face4){p=R.geometry.vertices[v.a].position;n=R.geometry.vertices[v.b].position;k=R.geometry.vertices[v.c].position;j=R.geometry.vertices[v.d].position;B.push(p.x,p.y,p.z);B.push(n.x,n.y,n.z);B.push(k.x,k.y,k.z);B.push(j.x,j.y,j.z);if(vertexNormals.length==4){N.push(vertexNormals[0].x,vertexNormals[0].y,vertexNormals[0].z);N.push(vertexNormals[1].x,vertexNormals[1].y,vertexNormals[1].z);N.push(vertexNormals[2].x,vertexNormals[2].y,vertexNormals[2].z);N.push(vertexNormals[3].x,vertexNormals[3].y,vertexNormals[3].z)}else{N.push(Q.x,Q.y,Q.z);N.push(Q.x,Q.y,Q.z);N.push(Q.x,Q.y,Q.z);N.push(Q.x,Q.y,Q.z)}s.push(P.r,P.g,P.b,P.a);s.push(P.r,P.g,P.b,P.a);s.push(P.r,P.g,P.b,P.a);s.push(P.r,P.g,P.b,P.a);if(t){E.push(t[0].u,t[0].v);E.push(t[1].u,t[1].v);E.push(t[2].u,t[2].v);E.push(t[3].u,t[3].v)}D.push(y,y+1,y+2);D.push(y,y+2,y+3);y+=4}}}if(!B.length){continue}r.__webGLVertexBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,r.__webGLVertexBuffer);a.bufferData(a.ARRAY_BUFFER,new Float32Array(B),a.STATIC_DRAW);r.__webGLNormalBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,r.__webGLNormalBuffer);a.bufferData(a.ARRAY_BUFFER,new Float32Array(N),a.STATIC_DRAW);if(C instanceof THREE.MeshFaceColorFillMaterial||C instanceof THREE.MeshBitmapUVMappingMaterial){r.__webGLColorBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,r.__webGLColorBuffer);a.bufferData(a.ARRAY_BUFFER,new Float32Array(s),a.STATIC_DRAW)}r.__webGLUVBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,r.__webGLUVBuffer);a.bufferData(a.ARRAY_BUFFER,new Float32Array(E),a.STATIC_DRAW);r.__webGLFaceBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r.__webGLFaceBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(D),a.STATIC_DRAW);r.__webGLFaceCount=D.length}if(C instanceof THREE.MeshColorFillMaterial){if(!r.__webGLColorBuffer){s=[];for(J=0;J<r.__webGLFaceCount;J++){s.push(C.color.r,C.color.g,C.color.b,C.color.a)}r.__webGLColorBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,r.__webGLColorBuffer);a.bufferData(a.ARRAY_BUFFER,new Float32Array(s),a.STATIC_DRAW)}a.uniform1i(h.enableTexture,0)}else{if(C instanceof THREE.MeshFaceColorFillMaterial){a.uniform1i(h.enableTexture,0)}else{if(C instanceof THREE.MeshBitmapUVMappingMaterial){if(!C.__webGLTexture&&C.loaded){C.__webGLTexture=a.createTexture();a.bindTexture(a.TEXTURE_2D,C.__webGLTexture);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,C.bitmap);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR);a.generateMipmap(a.TEXTURE_2D);a.bindTexture(a.TEXTURE_2D,null)}a.uniform1i(h.enableTexture,1);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,C.__webGLTexture);a.uniform1i(h.diffuse,0)}}}a.bindBuffer(a.ARRAY_BUFFER,r.__webGLVertexBuffer);a.vertexAttribPointer(h.position,3,a.FLOAT,false,0,0);a.bindBuffer(a.ARRAY_BUFFER,r.__webGLNormalBuffer);a.vertexAttribPointer(h.normal,3,a.FLOAT,false,0,0);a.bindBuffer(a.ARRAY_BUFFER,r.__webGLUVBuffer);if(R.geometry.uvs.length){a.enableVertexAttribArray(h.uv);a.vertexAttribPointer(h.uv,2,a.FLOAT,false,0,0)}else{a.disableVertexAttribArray(h.uv)}a.bindBuffer(a.ARRAY_BUFFER,r.__webGLColorBuffer);a.enableVertexAttribArray(h.color);a.vertexAttribPointer(h.color,4,a.FLOAT,false,0,0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r.__webGLFaceBuffer);a.drawElements(a.TRIANGLES,r.__webGLFaceCount,a.UNSIGNED_SHORT,0)}}}};function f(){try{a=e.getContext("experimental-webgl",{antialias:true})}catch(i){}if(!a){alert("WebGL not supported");throw"cannot create webgl context"}a.clearColor(0,0,0,1);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);a.clearColor(0,0,0,0)}function c(){h=a.createProgram();a.attachShader(h,b("fragment",["#ifdef GL_ES","precision highp float;","#endif","uniform bool enableTexture;","uniform sampler2D diffuse;","varying vec2 vuv;","varying vec4 vcolor;","varying vec3 lightWeighting;","void main(){","if(enableTexture) {","vec4 texelColor = texture2D(diffuse, vuv);","gl_FragColor = vec4(texelColor.rgb * lightWeighting, texelColor.a);","} else {","gl_FragColor = vec4(vcolor.rgb * lightWeighting, vcolor.a);","}","}"].join("\n")));a.attachShader(h,b("vertex",["attribute vec3 position;","attribute vec3 normal;","attribute vec4 color;","attribute vec2 uv;","uniform bool enableLighting;","uniform vec3 ambientColor;","uniform vec3 directionalColor;","uniform vec3 lightingDirection;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 normalMatrix;","varying vec4 vcolor;","varying vec3 lightWeighting;","varying vec2 vuv;","void main(void) {","if(!enableLighting) {","lightWeighting = vec3(1.0, 1.0, 1.0);","} else {","vec4 transformedNormal = normalMatrix * vec4(normal, 1.0);","float directionalLightWeighting = max(dot(normalize(transformedNormal.xyz), lightingDirection), 0.0);","lightWeighting = ambientColor + directionalColor * directionalLightWeighting;","}","vcolor = color;","vuv = uv;","gl_Position = projectionMatrix * viewMatrix * vec4( position, 1.0 );","}"].join("\n")));a.linkProgram(h);if(!a.getProgramParameter(h,a.LINK_STATUS)){alert("Could not initialise shaders")}a.useProgram(h);h.viewMatrix=a.getUniformLocation(h,"viewMatrix");h.projectionMatrix=a.getUniformLocation(h,"projectionMatrix");h.normalMatrix=a.getUniformLocation(h,"normalMatrix");h.enableLighting=a.getUniformLocation(h,"enableLighting");h.ambientColor=a.getUniformLocation(h,"ambientColor");h.directionalColor=a.getUniformLocation(h,"directionalColor");h.lightingDirection=a.getUniformLocation(h,"lightingDirection");h.enableTexture=a.getUniformLocation(h,"enableTexture");h.color=a.getAttribLocation(h,"color");a.enableVertexAttribArray(h.color);h.position=a.getAttribLocation(h,"position");a.enableVertexAttribArray(h.position);h.normal=a.getAttribLocation(h,"normal");a.enableVertexAttribArray(h.normal);h.uv=a.getAttribLocation(h,"uv");a.enableVertexAttribArray(h.uv);h.diffuse=a.getUniformLocation(h,"diffuse");a.uniform1i(h.diffuse,0);h.viewMatrixArray=new Float32Array(16);h.projectionMatrixArray=new Float32Array(16)}function b(j,i){var k;if(j=="fragment"){k=a.createShader(a.FRAGMENT_SHADER)}else{if(j=="vertex"){k=a.createShader(a.VERTEX_SHADER)}}a.shaderSource(k,i);a.compileShader(k);if(!a.getShaderParameter(k,a.COMPILE_STATUS)){alert(a.getShaderInfoLog(k));return null}return k}};THREE.RenderableFace3=function(){this.v1=new THREE.Vector2();this.v2=new THREE.Vector2();this.v3=new THREE.Vector2();this.centroidWorld=new THREE.Vector3();this.normalWorld=new THREE.Vector3();this.z=null;this.color=null;this.material=null};THREE.RenderableFace4=function(){this.v1=new THREE.Vector2();this.v2=new THREE.Vector2();this.v3=new THREE.Vector2();this.v4=new THREE.Vector2();this.centroidWorld=new THREE.Vector3();this.normalWorld=new THREE.Vector3();this.z=null;this.color=null;this.material=null};THREE.RenderableParticle=function(){this.x=null;this.y=null;this.z=null;this.rotation=null;this.scale=new THREE.Vector2();this.color=null;this.material=null};THREE.RenderableLine=function(){this.v1=new THREE.Vector2();this.v2=new THREE.Vector2();this.z=null;this.color=null;this.material=null};