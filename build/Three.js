// Three.js r31 - http://github.com/mrdoob/three.js
var THREE=THREE||{};THREE.Color=function(a){this.autoUpdate=true;this.setHex(a)};
THREE.Color.prototype={setRGB:function(a,b,f){this.r=a;this.g=b;this.b=f;if(this.autoUpdate){this.updateHex();this.updateStyleString()}},setHex:function(a){this.hex=~~a&16777215;if(this.autoUpdate){this.updateRGBA();this.updateStyleString()}},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGBA:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},updateStyleString:function(){this.__styleString="rgb("+~~(this.r*255)+
","+~~(this.g*255)+","+~~(this.b*255)+")"},toString:function(){return"THREE.Color ( r: "+this.r+", g: "+this.g+", b: "+this.b+", hex: "+this.hex+" )"}};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};
THREE.Vector2.prototype={set:function(a,b){this.x=a;this.y=b;return this},copy:function(a){this.x=a.x;this.y=a.y;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;return this},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},unit:function(){this.multiplyScalar(1/this.length());return this},length:function(){return Math.sqrt(this.x*
this.x+this.y*this.y)},lengthSq:function(){return this.x*this.x+this.y*this.y},negate:function(){this.x=-this.x;this.y=-this.y;return this},clone:function(){return new THREE.Vector2(this.x,this.y)},toString:function(){return"THREE.Vector2 ("+this.x+", "+this.y+")"}};THREE.Vector3=function(a,b,f){this.x=a||0;this.y=b||0;this.z=f||0};
THREE.Vector3.prototype={set:function(a,b,f){this.x=a;this.y=b;this.z=f;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},
cross:function(a,b){this.x=a.y*b.z-a.z*b.y;this.y=a.z*b.x-a.x*b.z;this.z=a.x*b.y-a.y*b.x;return this},crossSelf:function(a){var b=this.x,f=this.y,d=this.z;this.x=f*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-f*a.x;return this},multiply:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},multiplySelf:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divideScalar:function(a){this.x/=a;this.y/=a;this.z/=
a;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},distanceTo:function(a){var b=this.x-a.x,f=this.y-a.y;a=this.z-a.z;return Math.sqrt(b*b+f*f+a*a)},distanceToSquared:function(a){var b=this.x-a.x,f=this.y-a.y;a=this.z-a.z;return b*b+f*f+a*a},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},normalize:function(){var a=
Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);a>0?this.multiplyScalar(1/a):this.set(0,0,0);return this},setLength:function(a){return this.normalize().multiplyScalar(a)},isZero:function(){return Math.abs(this.x)<1.0E-4&&Math.abs(this.y)<1.0E-4&&Math.abs(this.z)<1.0E-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},toString:function(){return"THREE.Vector3 ( "+this.x+", "+this.y+", "+this.z+" )"}};
THREE.Vector4=function(a,b,f,d){this.x=a||0;this.y=b||0;this.z=f||0;this.w=d||1};
THREE.Vector4.prototype={set:function(a,b,f,d){this.x=a;this.y=b;this.z=f;this.w=d;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w||1;return this},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;
return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divideScalar:function(a){this.x/=a;this.y/=a;this.z/=a;this.w/=a;return this},lerpSelf:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},toString:function(){return"THREE.Vector4 ("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}};
THREE.Ray=function(a,b){this.origin=a||new THREE.Vector3;this.direction=b||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(a){var b,f,d=a.objects,j=[];a=0;for(b=d.length;a<b;a++){f=d[a];if(f instanceof THREE.Mesh)j=j.concat(this.intersectObject(f))}j.sort(function(k,q){return k.distance-q.distance});return j},intersectObject:function(a){function b(N,s,T,B){B=B.clone().subSelf(s);T=T.clone().subSelf(s);var L=N.clone().subSelf(s);N=B.dot(B);s=B.dot(T);B=B.dot(L);var O=T.dot(T);T=T.dot(L);L=1/(N*O-s*s);O=(O*B-s*T)*L;N=(N*T-s*B)*L;return O>0&&N>0&&O+N<1}var f,d,j,k,q,l,p,y,c,C,
u,t=a.geometry,J=t.vertices,R=[];f=0;for(d=t.faces.length;f<d;f++){j=t.faces[f];C=this.origin.clone();u=this.direction.clone();k=a.matrix.multiplyVector3(J[j.a].position.clone());q=a.matrix.multiplyVector3(J[j.b].position.clone());l=a.matrix.multiplyVector3(J[j.c].position.clone());p=j instanceof THREE.Face4?a.matrix.multiplyVector3(J[j.d].position.clone()):null;y=a.rotationMatrix.multiplyVector3(j.normal.clone());c=u.dot(y);if(c<0){y=y.dot((new THREE.Vector3).sub(k,C))/c;C=C.addSelf(u.multiplyScalar(y));
if(j instanceof THREE.Face3){if(b(C,k,q,l)){j={distance:this.origin.distanceTo(C),point:C,face:j,object:a};R.push(j)}}else if(j instanceof THREE.Face4)if(b(C,k,q,p)||b(C,q,l,p)){j={distance:this.origin.distanceTo(C),point:C,face:j,object:a};R.push(j)}}}return R}};
THREE.Rectangle=function(){function a(){k=d-b;q=j-f}var b,f,d,j,k,q,l=true;this.getX=function(){return b};this.getY=function(){return f};this.getWidth=function(){return k};this.getHeight=function(){return q};this.getLeft=function(){return b};this.getTop=function(){return f};this.getRight=function(){return d};this.getBottom=function(){return j};this.set=function(p,y,c,C){l=false;b=p;f=y;d=c;j=C;a()};this.addPoint=function(p,y){if(l){l=false;b=p;f=y;d=p;j=y}else{b=b<p?b:p;f=f<y?f:y;d=d>p?d:p;j=j>y?
j:y}a()};this.add3Points=function(p,y,c,C,u,t){if(l){l=false;b=p<c?p<u?p:u:c<u?c:u;f=y<C?y<t?y:t:C<t?C:t;d=p>c?p>u?p:u:c>u?c:u;j=y>C?y>t?y:t:C>t?C:t}else{b=p<c?p<u?p<b?p:b:u<b?u:b:c<u?c<b?c:b:u<b?u:b;f=y<C?y<t?y<f?y:f:t<f?t:f:C<t?C<f?C:f:t<f?t:f;d=p>c?p>u?p>d?p:d:u>d?u:d:c>u?c>d?c:d:u>d?u:d;j=y>C?y>t?y>j?y:j:t>j?t:j:C>t?C>j?C:j:t>j?t:j}a()};this.addRectangle=function(p){if(l){l=false;b=p.getLeft();f=p.getTop();d=p.getRight();j=p.getBottom()}else{b=b<p.getLeft()?b:p.getLeft();f=f<p.getTop()?f:p.getTop();
d=d>p.getRight()?d:p.getRight();j=j>p.getBottom()?j:p.getBottom()}a()};this.inflate=function(p){b-=p;f-=p;d+=p;j+=p;a()};this.minSelf=function(p){b=b>p.getLeft()?b:p.getLeft();f=f>p.getTop()?f:p.getTop();d=d<p.getRight()?d:p.getRight();j=j<p.getBottom()?j:p.getBottom();a()};this.instersects=function(p){return Math.min(d,p.getRight())-Math.max(b,p.getLeft())>=0&&Math.min(j,p.getBottom())-Math.max(f,p.getTop())>=0};this.empty=function(){l=true;j=d=f=b=0;a()};this.isEmpty=function(){return l};this.toString=
function(){return"THREE.Rectangle ( left: "+b+", right: "+d+", top: "+f+", bottom: "+j+", width: "+k+", height: "+q+" )"}};THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={transpose:function(){var a;a=this.m[1];this.m[1]=this.m[3];this.m[3]=a;a=this.m[2];this.m[2]=this.m[6];this.m[6]=a;a=this.m[5];this.m[5]=this.m[7];this.m[7]=a;return this}};
THREE.Matrix4=function(a,b,f,d,j,k,q,l,p,y,c,C,u,t,J,R){this.n11=a||1;this.n12=b||0;this.n13=f||0;this.n14=d||0;this.n21=j||0;this.n22=k||1;this.n23=q||0;this.n24=l||0;this.n31=p||0;this.n32=y||0;this.n33=c||1;this.n34=C||0;this.n41=u||0;this.n42=t||0;this.n43=J||0;this.n44=R||1};
THREE.Matrix4.prototype={identity:function(){this.n11=1;this.n21=this.n14=this.n13=this.n12=0;this.n22=1;this.n32=this.n31=this.n24=this.n23=0;this.n33=1;this.n43=this.n42=this.n41=this.n34=0;this.n44=1;return this},set:function(a,b,f,d,j,k,q,l,p,y,c,C,u,t,J,R){this.n11=a;this.n12=b;this.n13=f;this.n14=d;this.n21=j;this.n22=k;this.n23=q;this.n24=l;this.n31=p;this.n32=y;this.n33=c;this.n34=C;this.n41=u;this.n42=t;this.n43=J;this.n44=R;return this},copy:function(a){this.n11=a.n11;this.n12=a.n12;this.n13=
a.n13;this.n14=a.n14;this.n21=a.n21;this.n22=a.n22;this.n23=a.n23;this.n24=a.n24;this.n31=a.n31;this.n32=a.n32;this.n33=a.n33;this.n34=a.n34;this.n41=a.n41;this.n42=a.n42;this.n43=a.n43;this.n44=a.n44;return this},lookAt:function(a,b,f){var d=new THREE.Vector3,j=new THREE.Vector3,k=new THREE.Vector3;k.sub(a,b).normalize();d.cross(f,k).normalize();j.cross(k,d).normalize();this.n11=d.x;this.n12=d.y;this.n13=d.z;this.n14=-d.dot(a);this.n21=j.x;this.n22=j.y;this.n23=j.z;this.n24=-j.dot(a);this.n31=k.x;
this.n32=k.y;this.n33=k.z;this.n34=-k.dot(a);this.n43=this.n42=this.n41=0;this.n44=1;return this},multiplyVector3:function(a){var b=a.x,f=a.y,d=a.z,j=1/(this.n41*b+this.n42*f+this.n43*d+this.n44);a.x=(this.n11*b+this.n12*f+this.n13*d+this.n14)*j;a.y=(this.n21*b+this.n22*f+this.n23*d+this.n24)*j;a.z=(this.n31*b+this.n32*f+this.n33*d+this.n34)*j;return a},multiplyVector4:function(a){var b=a.x,f=a.y,d=a.z,j=a.w;a.x=this.n11*b+this.n12*f+this.n13*d+this.n14*j;a.y=this.n21*b+this.n22*f+this.n23*d+this.n24*
j;a.z=this.n31*b+this.n32*f+this.n33*d+this.n34*j;a.w=this.n41*b+this.n42*f+this.n43*d+this.n44*j;return a},crossVector:function(a){var b=new THREE.Vector4;b.x=this.n11*a.x+this.n12*a.y+this.n13*a.z+this.n14*a.w;b.y=this.n21*a.x+this.n22*a.y+this.n23*a.z+this.n24*a.w;b.z=this.n31*a.x+this.n32*a.y+this.n33*a.z+this.n34*a.w;b.w=a.w?this.n41*a.x+this.n42*a.y+this.n43*a.z+this.n44*a.w:1;return b},multiply:function(a,b){var f=a.n11,d=a.n12,j=a.n13,k=a.n14,q=a.n21,l=a.n22,p=a.n23,y=a.n24,c=a.n31,C=a.n32,
u=a.n33,t=a.n34,J=a.n41,R=a.n42,N=a.n43,s=a.n44,T=b.n11,B=b.n12,L=b.n13,O=b.n14,Q=b.n21,e=b.n22,h=b.n23,m=b.n24,i=b.n31,n=b.n32,g=b.n33,o=b.n34,r=b.n41,D=b.n42,M=b.n43,H=b.n44;this.n11=f*T+d*Q+j*i+k*r;this.n12=f*B+d*e+j*n+k*D;this.n13=f*L+d*h+j*g+k*M;this.n14=f*O+d*m+j*o+k*H;this.n21=q*T+l*Q+p*i+y*r;this.n22=q*B+l*e+p*n+y*D;this.n23=q*L+l*h+p*g+y*M;this.n24=q*O+l*m+p*o+y*H;this.n31=c*T+C*Q+u*i+t*r;this.n32=c*B+C*e+u*n+t*D;this.n33=c*L+C*h+u*g+t*M;this.n34=c*O+C*m+u*o+t*H;this.n41=J*T+R*Q+N*i+s*r;
this.n42=J*B+R*e+N*n+s*D;this.n43=J*L+R*h+N*g+s*M;this.n44=J*O+R*m+N*o+s*H;return this},multiplySelf:function(a){var b=this.n11,f=this.n12,d=this.n13,j=this.n14,k=this.n21,q=this.n22,l=this.n23,p=this.n24,y=this.n31,c=this.n32,C=this.n33,u=this.n34,t=this.n41,J=this.n42,R=this.n43,N=this.n44,s=a.n11,T=a.n21,B=a.n31,L=a.n41,O=a.n12,Q=a.n22,e=a.n32,h=a.n42,m=a.n13,i=a.n23,n=a.n33,g=a.n43,o=a.n14,r=a.n24,D=a.n34;a=a.n44;this.n11=b*s+f*T+d*B+j*L;this.n12=b*O+f*Q+d*e+j*h;this.n13=b*m+f*i+d*n+j*g;this.n14=
b*o+f*r+d*D+j*a;this.n21=k*s+q*T+l*B+p*L;this.n22=k*O+q*Q+l*e+p*h;this.n23=k*m+q*i+l*n+p*g;this.n24=k*o+q*r+l*D+p*a;this.n31=y*s+c*T+C*B+u*L;this.n32=y*O+c*Q+C*e+u*h;this.n33=y*m+c*i+C*n+u*g;this.n34=y*o+c*r+C*D+u*a;this.n41=t*s+J*T+R*B+N*L;this.n42=t*O+J*Q+R*e+N*h;this.n43=t*m+J*i+R*n+N*g;this.n44=t*o+J*r+R*D+N*a;return this},multiplyScalar:function(a){this.n11*=a;this.n12*=a;this.n13*=a;this.n14*=a;this.n21*=a;this.n22*=a;this.n23*=a;this.n24*=a;this.n31*=a;this.n32*=a;this.n33*=a;this.n34*=a;this.n41*=
a;this.n42*=a;this.n43*=a;this.n44*=a;return this},determinant:function(){return this.n14*this.n23*this.n32*this.n41-this.n13*this.n24*this.n32*this.n41-this.n14*this.n22*this.n33*this.n41+this.n12*this.n24*this.n33*this.n41+this.n13*this.n22*this.n34*this.n41-this.n12*this.n23*this.n34*this.n41-this.n14*this.n23*this.n31*this.n42+this.n13*this.n24*this.n31*this.n42+this.n14*this.n21*this.n33*this.n42-this.n11*this.n24*this.n33*this.n42-this.n13*this.n21*this.n34*this.n42+this.n11*this.n23*this.n34*
this.n42+this.n14*this.n22*this.n31*this.n43-this.n12*this.n24*this.n31*this.n43-this.n14*this.n21*this.n32*this.n43+this.n11*this.n24*this.n32*this.n43+this.n12*this.n21*this.n34*this.n43-this.n11*this.n22*this.n34*this.n43-this.n13*this.n22*this.n31*this.n44+this.n12*this.n23*this.n31*this.n44+this.n13*this.n21*this.n32*this.n44-this.n11*this.n23*this.n32*this.n44-this.n12*this.n21*this.n33*this.n44+this.n11*this.n22*this.n33*this.n44},transpose:function(){function a(b,f,d){var j=b[f];b[f]=b[d];
b[d]=j}a(this,"n21","n12");a(this,"n31","n13");a(this,"n32","n23");a(this,"n41","n14");a(this,"n42","n24");a(this,"n43","n34");return this},clone:function(){var a=new THREE.Matrix4;a.n11=this.n11;a.n12=this.n12;a.n13=this.n13;a.n14=this.n14;a.n21=this.n21;a.n22=this.n22;a.n23=this.n23;a.n24=this.n24;a.n31=this.n31;a.n32=this.n32;a.n33=this.n33;a.n34=this.n34;a.n41=this.n41;a.n42=this.n42;a.n43=this.n43;a.n44=this.n44;return a},flatten:function(){return[this.n11,this.n21,this.n31,this.n41,this.n12,
this.n22,this.n32,this.n42,this.n13,this.n23,this.n33,this.n43,this.n14,this.n24,this.n34,this.n44]},toString:function(){return"| "+this.n11+" "+this.n12+" "+this.n13+" "+this.n14+" |\n| "+this.n21+" "+this.n22+" "+this.n23+" "+this.n24+" |\n| "+this.n31+" "+this.n32+" "+this.n33+" "+this.n34+" |\n| "+this.n41+" "+this.n42+" "+this.n43+" "+this.n44+" |"}};THREE.Matrix4.translationMatrix=function(a,b,f){var d=new THREE.Matrix4;d.n14=a;d.n24=b;d.n34=f;return d};
THREE.Matrix4.scaleMatrix=function(a,b,f){var d=new THREE.Matrix4;d.n11=a;d.n22=b;d.n33=f;return d};THREE.Matrix4.rotationXMatrix=function(a){var b=new THREE.Matrix4;b.n22=b.n33=Math.cos(a);b.n32=Math.sin(a);b.n23=-b.n32;return b};THREE.Matrix4.rotationYMatrix=function(a){var b=new THREE.Matrix4;b.n11=b.n33=Math.cos(a);b.n13=Math.sin(a);b.n31=-b.n13;return b};THREE.Matrix4.rotationZMatrix=function(a){var b=new THREE.Matrix4;b.n11=b.n22=Math.cos(a);b.n21=Math.sin(a);b.n12=-b.n21;return b};
THREE.Matrix4.rotationAxisAngleMatrix=function(a,b){var f=new THREE.Matrix4,d=Math.cos(b),j=Math.sin(b),k=1-d,q=a.x,l=a.y,p=a.z;f.n11=k*q*q+d;f.n12=k*q*l-j*p;f.n13=k*q*p+j*l;f.n21=k*q*l+j*p;f.n22=k*l*l+d;f.n23=k*l*p-j*q;f.n31=k*q*p-j*l;f.n32=k*l*p+j*q;f.n33=k*p*p+d;return f};
THREE.Matrix4.makeInvert=function(a){var b=new THREE.Matrix4;b.n11=a.n23*a.n34*a.n42-a.n24*a.n33*a.n42+a.n24*a.n32*a.n43-a.n22*a.n34*a.n43-a.n23*a.n32*a.n44+a.n22*a.n33*a.n44;b.n12=a.n14*a.n33*a.n42-a.n13*a.n34*a.n42-a.n14*a.n32*a.n43+a.n12*a.n34*a.n43+a.n13*a.n32*a.n44-a.n12*a.n33*a.n44;b.n13=a.n13*a.n24*a.n42-a.n14*a.n23*a.n42+a.n14*a.n22*a.n43-a.n12*a.n24*a.n43-a.n13*a.n22*a.n44+a.n12*a.n23*a.n44;b.n14=a.n14*a.n23*a.n32-a.n13*a.n24*a.n32-a.n14*a.n22*a.n33+a.n12*a.n24*a.n33+a.n13*a.n22*a.n34-a.n12*
a.n23*a.n34;b.n21=a.n24*a.n33*a.n41-a.n23*a.n34*a.n41-a.n24*a.n31*a.n43+a.n21*a.n34*a.n43+a.n23*a.n31*a.n44-a.n21*a.n33*a.n44;b.n22=a.n13*a.n34*a.n41-a.n14*a.n33*a.n41+a.n14*a.n31*a.n43-a.n11*a.n34*a.n43-a.n13*a.n31*a.n44+a.n11*a.n33*a.n44;b.n23=a.n14*a.n23*a.n41-a.n13*a.n24*a.n41-a.n14*a.n21*a.n43+a.n11*a.n24*a.n43+a.n13*a.n21*a.n44-a.n11*a.n23*a.n44;b.n24=a.n13*a.n24*a.n31-a.n14*a.n23*a.n31+a.n14*a.n21*a.n33-a.n11*a.n24*a.n33-a.n13*a.n21*a.n34+a.n11*a.n23*a.n34;b.n31=a.n22*a.n34*a.n41-a.n24*a.n32*
a.n41+a.n24*a.n31*a.n42-a.n21*a.n34*a.n42-a.n22*a.n31*a.n44+a.n21*a.n32*a.n44;b.n32=a.n14*a.n32*a.n41-a.n12*a.n34*a.n41-a.n14*a.n31*a.n42+a.n11*a.n34*a.n42+a.n12*a.n31*a.n44-a.n11*a.n32*a.n44;b.n33=a.n13*a.n24*a.n41-a.n14*a.n22*a.n41+a.n14*a.n21*a.n42-a.n11*a.n24*a.n42-a.n12*a.n21*a.n44+a.n11*a.n22*a.n44;b.n34=a.n14*a.n22*a.n31-a.n12*a.n24*a.n31-a.n14*a.n21*a.n32+a.n11*a.n24*a.n32+a.n12*a.n21*a.n34-a.n11*a.n22*a.n34;b.n41=a.n23*a.n32*a.n41-a.n22*a.n33*a.n41-a.n23*a.n31*a.n42+a.n21*a.n33*a.n42+a.n22*
a.n31*a.n43-a.n21*a.n32*a.n43;b.n42=a.n12*a.n33*a.n41-a.n13*a.n32*a.n41+a.n13*a.n31*a.n42-a.n11*a.n33*a.n42-a.n12*a.n31*a.n43+a.n11*a.n32*a.n43;b.n43=a.n13*a.n22*a.n41-a.n12*a.n23*a.n41-a.n13*a.n21*a.n42+a.n11*a.n23*a.n42+a.n12*a.n21*a.n43-a.n11*a.n22*a.n43;b.n44=a.n12*a.n23*a.n31-a.n13*a.n22*a.n31+a.n13*a.n21*a.n32-a.n11*a.n23*a.n32-a.n12*a.n21*a.n33+a.n11*a.n22*a.n33;b.multiplyScalar(1/a.determinant());return b};
THREE.Matrix4.makeInvert3x3=function(a){var b=a.flatten();a=new THREE.Matrix3;var f=b[10]*b[5]-b[6]*b[9],d=-b[10]*b[1]+b[2]*b[9],j=b[6]*b[1]-b[2]*b[5],k=-b[10]*b[4]+b[6]*b[8],q=b[10]*b[0]-b[2]*b[8],l=-b[6]*b[0]+b[2]*b[4],p=b[9]*b[4]-b[5]*b[8],y=-b[9]*b[0]+b[1]*b[8],c=b[5]*b[0]-b[1]*b[4];b=b[0]*f+b[1]*k+b[2]*p;if(b==0)throw"matrix not invertible";b=1/b;a.m[0]=b*f;a.m[1]=b*d;a.m[2]=b*j;a.m[3]=b*k;a.m[4]=b*q;a.m[5]=b*l;a.m[6]=b*p;a.m[7]=b*y;a.m[8]=b*c;return a};
THREE.Matrix4.makeFrustum=function(a,b,f,d,j,k){var q,l,p;q=new THREE.Matrix4;l=2*j/(b-a);p=2*j/(d-f);a=(b+a)/(b-a);f=(d+f)/(d-f);d=-(k+j)/(k-j);j=-2*k*j/(k-j);q.n11=l;q.n12=0;q.n13=a;q.n14=0;q.n21=0;q.n22=p;q.n23=f;q.n24=0;q.n31=0;q.n32=0;q.n33=d;q.n34=j;q.n41=0;q.n42=0;q.n43=-1;q.n44=0;return q};THREE.Matrix4.makePerspective=function(a,b,f,d){var j;a=f*Math.tan(a*Math.PI/360);j=-a;return THREE.Matrix4.makeFrustum(j*b,a*b,j,a,f,d)};
THREE.Matrix4.makeOrtho=function(a,b,f,d,j,k){var q,l,p,y;q=new THREE.Matrix4;l=b-a;p=f-d;y=k-j;a=(b+a)/l;f=(f+d)/p;j=(k+j)/y;q.n11=2/l;q.n12=0;q.n13=0;q.n14=-a;q.n21=0;q.n22=2/p;q.n23=0;q.n24=-f;q.n31=0;q.n32=0;q.n33=-2/y;q.n34=-j;q.n41=0;q.n42=0;q.n43=0;q.n44=1;return q};
THREE.Vertex=function(a,b){this.position=a||new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.normal=b||new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.normalScreen=new THREE.Vector3;this.tangent=new THREE.Vector4;this.__visible=true};THREE.Vertex.prototype={toString:function(){return"THREE.Vertex ( position: "+this.position+", normal: "+this.normal+" )"}};
THREE.Face3=function(a,b,f,d,j){this.a=a;this.b=b;this.c=f;this.centroid=new THREE.Vector3;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.materials=j instanceof Array?j:[j]};THREE.Face3.prototype={toString:function(){return"THREE.Face3 ( "+this.a+", "+this.b+", "+this.c+" )"}};
THREE.Face4=function(a,b,f,d,j,k){this.a=a;this.b=b;this.c=f;this.d=d;this.centroid=new THREE.Vector3;this.normal=j instanceof THREE.Vector3?j:new THREE.Vector3;this.vertexNormals=j instanceof Array?j:[];this.materials=k instanceof Array?k:[k]};THREE.Face4.prototype={toString:function(){return"THREE.Face4 ( "+this.a+", "+this.b+", "+this.c+" "+this.d+" )"}};THREE.UV=function(a,b){this.u=a||0;this.v=b||0};
THREE.UV.prototype={copy:function(a){this.u=a.u;this.v=a.v},toString:function(){return"THREE.UV ("+this.u+", "+this.v+")"}};THREE.Geometry=function(){this.vertices=[];this.faces=[];this.uvs=[];this.boundingSphere=this.boundingBox=null;this.geometryChunks={};this.hasTangents=false};
THREE.Geometry.prototype={computeCentroids:function(){var a,b,f;a=0;for(b=this.faces.length;a<b;a++){f=this.faces[a];f.centroid.set(0,0,0);if(f instanceof THREE.Face3){f.centroid.addSelf(this.vertices[f.a].position);f.centroid.addSelf(this.vertices[f.b].position);f.centroid.addSelf(this.vertices[f.c].position);f.centroid.divideScalar(3)}else if(f instanceof THREE.Face4){f.centroid.addSelf(this.vertices[f.a].position);f.centroid.addSelf(this.vertices[f.b].position);f.centroid.addSelf(this.vertices[f.c].position);
f.centroid.addSelf(this.vertices[f.d].position);f.centroid.divideScalar(4)}}},computeFaceNormals:function(a){var b,f,d,j,k,q,l=new THREE.Vector3,p=new THREE.Vector3;d=0;for(j=this.vertices.length;d<j;d++){k=this.vertices[d];k.normal.set(0,0,0)}d=0;for(j=this.faces.length;d<j;d++){k=this.faces[d];if(a&&k.vertexNormals.length){l.set(0,0,0);b=0;for(f=k.normal.length;b<f;b++)l.addSelf(k.vertexNormals[b]);l.divideScalar(3)}else{b=this.vertices[k.a];f=this.vertices[k.b];q=this.vertices[k.c];l.sub(q.position,
f.position);p.sub(b.position,f.position);l.crossSelf(p)}l.isZero()||l.normalize();k.normal.copy(l)}},computeVertexNormals:function(){var a,b=[],f,d;a=0;for(vl=this.vertices.length;a<vl;a++)b[a]=new THREE.Vector3;a=0;for(f=this.faces.length;a<f;a++){d=this.faces[a];if(d instanceof THREE.Face3){b[d.a].addSelf(d.normal);b[d.b].addSelf(d.normal);b[d.c].addSelf(d.normal)}else if(d instanceof THREE.Face4){b[d.a].addSelf(d.normal);b[d.b].addSelf(d.normal);b[d.c].addSelf(d.normal);b[d.d].addSelf(d.normal)}}a=
0;for(vl=this.vertices.length;a<vl;a++)b[a].normalize();a=0;for(f=this.faces.length;a<f;a++){d=this.faces[a];if(d instanceof THREE.Face3){d.vertexNormals[0]=b[d.a].clone();d.vertexNormals[1]=b[d.b].clone();d.vertexNormals[2]=b[d.c].clone()}else if(d instanceof THREE.Face4){d.vertexNormals[0]=b[d.a].clone();d.vertexNormals[1]=b[d.b].clone();d.vertexNormals[2]=b[d.c].clone();d.vertexNormals[3]=b[d.d].clone()}}},computeTangents:function(){function a(o,r,D,M){k=o.vertices[r].position;q=o.vertices[D].position;
l=o.vertices[M].position;p=j[0];y=j[1];c=j[2];C=q.x-k.x;u=l.x-k.x;t=q.y-k.y;J=l.y-k.y;R=q.z-k.z;N=l.z-k.z;s=y.u-p.u;T=c.u-p.u;B=y.v-p.v;L=c.v-p.v;O=1/(s*L-T*B);m.set((L*C-B*u)*O,(L*t-B*J)*O,(L*R-B*N)*O);i.set((s*u-T*C)*O,(s*J-T*t)*O,(s*N-T*R)*O);e[r].addSelf(m);e[D].addSelf(m);e[M].addSelf(m);h[r].addSelf(i);h[D].addSelf(i);h[M].addSelf(i)}var b,f,d,j,k,q,l,p,y,c,C,u,t,J,R,N,s,T,B,L,O,Q,e=[],h=[],m=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3,g=new THREE.Vector3;Q=new THREE.Vector3;b=
0;for(f=this.vertices.length;b<f;b++){e[b]=new THREE.Vector3;h[b]=new THREE.Vector3}b=0;for(f=this.faces.length;b<f;b++){d=this.faces[b];j=this.uvs[b];if(d instanceof THREE.Face3){a(this,d.a,d.b,d.c);this.vertices[d.a].normal.copy(d.vertexNormals[0]);this.vertices[d.b].normal.copy(d.vertexNormals[1]);this.vertices[d.c].normal.copy(d.vertexNormals[2])}else if(d instanceof THREE.Face4){a(this,d.a,d.b,d.c);this.vertices[d.a].normal.copy(d.vertexNormals[0]);this.vertices[d.b].normal.copy(d.vertexNormals[1]);
this.vertices[d.c].normal.copy(d.vertexNormals[2]);this.vertices[d.d].normal.copy(d.vertexNormals[3])}}b=0;for(f=this.vertices.length;b<f;b++){Q.copy(this.vertices[b].normal);d=e[b];n.copy(d);n.subSelf(Q.multiplyScalar(Q.dot(d))).normalize();g.cross(this.vertices[b].normal,d);test=g.dot(h[b]);d=test<0?-1:1;this.vertices[b].tangent.set(n.x,n.y,n.z,d)}this.hasTangents=true},computeBoundingBox:function(){var a;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],
y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var b=1,f=this.vertices.length;b<f;b++){a=this.vertices[b];if(a.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=a.position.x;else if(a.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=a.position.x;if(a.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=a.position.y;else if(a.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=a.position.y;if(a.position.z<
this.boundingBox.z[0])this.boundingBox.z[0]=a.position.z;else if(a.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=a.position.z}}},computeBoundingSphere:function(){for(var a=this.boundingSphere===null?0:this.boundingSphere.radius,b=0,f=this.vertices.length;b<f;b++)a=Math.max(a,this.vertices[b].position.length());this.boundingSphere={radius:a}},sortFacesByMaterial:function(){function a(y){var c=[];b=0;for(f=y.length;b<f;b++)y[b]==undefined?c.push("undefined"):c.push(y[b].toString());return c.join("_")}
var b,f,d,j,k,q,l,p={};d=0;for(j=this.faces.length;d<j;d++){k=this.faces[d];materials=k.materials;q=a(materials);if(p[q]==undefined)p[q]={hash:q,counter:0};l=p[q].hash+"_"+p[q].counter;if(this.geometryChunks[l]==undefined)this.geometryChunks[l]={faces:[],materials:materials,vertices:0};k=k instanceof THREE.Face3?3:4;if(this.geometryChunks[l].vertices+k>65535){p[q].counter+=1;l=p[q].hash+"_"+p[q].counter;if(this.geometryChunks[l]==undefined)this.geometryChunks[l]={faces:[],materials:materials,vertices:0}}this.geometryChunks[l].faces.push(d);
this.geometryChunks[l].vertices+=k}},toString:function(){return"THREE.Geometry ( vertices: "+this.vertices+", faces: "+this.faces+", uvs: "+this.uvs+" )"}};
THREE.Camera=function(a,b,f,d){this.position=new THREE.Vector3;this.target={position:new THREE.Vector3};this.up=new THREE.Vector3(0,1,0);this.matrix=new THREE.Matrix4;this.projectionMatrix=THREE.Matrix4.makePerspective(a,b,f,d);this.autoUpdateMatrix=true;this.translateX=function(j){j=this.target.position.clone().subSelf(this.position).normalize().multiplyScalar(j);j.cross(j.clone(),this.up);this.position.addSelf(j);this.target.position.addSelf(j)};this.translateZ=function(j){j=this.target.position.clone().subSelf(this.position).normalize().multiplyScalar(j);
this.position.subSelf(j);this.target.position.subSelf(j)};this.updateMatrix=function(){this.matrix.lookAt(this.position,this.target.position,this.up)};this.toString=function(){return"THREE.Camera ( "+this.position+", "+this.target.position+" )"}};THREE.Light=function(a){this.color=new THREE.Color(a)};THREE.AmbientLight=function(a){THREE.Light.call(this,a)};THREE.AmbientLight.prototype=new THREE.Light;THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;
THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a);this.position=new THREE.Vector3(0,1,0);this.intensity=b||1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(a,b){THREE.Light.call(this,a);this.position=new THREE.Vector3;this.intensity=b||1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.PointLight;
THREE.Object3D=function(){this.id=THREE.Object3DCounter.value++;this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.scale=new THREE.Vector3(1,1,1);this.matrix=new THREE.Matrix4;this.translationMatrix=new THREE.Matrix4;this.rotationMatrix=new THREE.Matrix4;this.scaleMatrix=new THREE.Matrix4;this.screen=new THREE.Vector3;this.visible=this.autoUpdateMatrix=true};
THREE.Object3D.prototype={updateMatrix:function(){this.matrixPosition=THREE.Matrix4.translationMatrix(this.position.x,this.position.y,this.position.z);this.rotationMatrix=THREE.Matrix4.rotationXMatrix(this.rotation.x);this.rotationMatrix.multiplySelf(THREE.Matrix4.rotationYMatrix(this.rotation.y));this.rotationMatrix.multiplySelf(THREE.Matrix4.rotationZMatrix(this.rotation.z));this.scaleMatrix=THREE.Matrix4.scaleMatrix(this.scale.x,this.scale.y,this.scale.z);this.matrix.copy(this.matrixPosition);
this.matrix.multiplySelf(this.rotationMatrix);this.matrix.multiplySelf(this.scaleMatrix)}};THREE.Object3DCounter={value:0};THREE.Particle=function(a){THREE.Object3D.call(this);this.materials=a instanceof Array?a:[a];this.autoUpdateMatrix=false};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;THREE.Line=function(a,b){THREE.Object3D.call(this);this.geometry=a;this.materials=b instanceof Array?b:[b]};THREE.Line.prototype=new THREE.Object3D;
THREE.Line.prototype.constructor=THREE.Line;THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.geometry=a;this.materials=b instanceof Array?b:[b];this.overdraw=this.doubleSided=this.flipSided=false;this.geometry.boundingSphere||this.geometry.computeBoundingSphere()};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.FlatShading=0;THREE.SmoothShading=1;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;
THREE.LineBasicMaterial=function(a){this.color=new THREE.Color(16777215);this.opacity=1;this.blending=THREE.NormalBlending;this.linewidth=1;this.linejoin=this.linecap="round";if(a){a.color!==undefined&&this.color.setHex(a.color);if(a.opacity!==undefined)this.opacity=a.opacity;if(a.blending!==undefined)this.blending=a.blending;if(a.linewidth!==undefined)this.linewidth=a.linewidth;if(a.linecap!==undefined)this.linecap=a.linecap;if(a.linejoin!==undefined)this.linejoin=a.linejoin}};
THREE.LineBasicMaterial.prototype={toString:function(){return"THREE.LineBasicMaterial (<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>linewidth: "+this.linewidth+"<br/>linecap: "+this.linecap+"<br/>linejoin: "+this.linejoin+"<br/>)"}};
THREE.MeshBasicMaterial=function(a){this.id=THREE.MeshBasicMaterialCounter.value++;this.color=new THREE.Color(16777215);this.env_map=this.map=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refraction_ratio=0.98;this.fog=true;this.opacity=1;this.shading=THREE.SmoothShading;this.blending=THREE.NormalBlending;this.wireframe=false;this.wireframe_linewidth=1;this.wireframe_linejoin=this.wireframe_linecap="round";if(a){a.color!==undefined&&this.color.setHex(a.color);if(a.map!==undefined)this.map=
a.map;if(a.env_map!==undefined)this.env_map=a.env_map;if(a.combine!==undefined)this.combine=a.combine;if(a.reflectivity!==undefined)this.reflectivity=a.reflectivity;if(a.refraction_ratio!==undefined)this.refraction_ratio=a.refraction_ratio;if(a.fog!==undefined)this.fog=a.fog;if(a.opacity!==undefined)this.opacity=a.opacity;if(a.shading!==undefined)this.shading=a.shading;if(a.blending!==undefined)this.blending=a.blending;if(a.wireframe!==undefined)this.wireframe=a.wireframe;if(a.wireframe_linewidth!==
undefined)this.wireframe_linewidth=a.wireframe_linewidth;if(a.wireframe_linecap!==undefined)this.wireframe_linecap=a.wireframe_linecap;if(a.wireframe_linejoin!==undefined)this.wireframe_linejoin=a.wireframe_linejoin}};
THREE.MeshBasicMaterial.prototype={toString:function(){return"THREE.MeshBasicMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+
"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>)"}};THREE.MeshBasicMaterialCounter={value:0};
THREE.MeshLambertMaterial=function(a){this.id=THREE.MeshLambertMaterialCounter.value++;this.color=new THREE.Color(16777215);this.env_map=this.map=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refraction_ratio=0.98;this.fog=true;this.opacity=1;this.shading=THREE.SmoothShading;this.blending=THREE.NormalBlending;this.wireframe=false;this.wireframe_linewidth=1;this.wireframe_linejoin=this.wireframe_linecap="round";if(a){a.color!==undefined&&this.color.setHex(a.color);if(a.map!==undefined)this.map=
a.map;if(a.env_map!==undefined)this.env_map=a.env_map;if(a.combine!==undefined)this.combine=a.combine;if(a.reflectivity!==undefined)this.reflectivity=a.reflectivity;if(a.refraction_ratio!==undefined)this.refraction_ratio=a.refraction_ratio;if(a.fog!==undefined)this.fog=a.fog;if(a.opacity!==undefined)this.opacity=a.opacity;if(a.shading!==undefined)this.shading=a.shading;if(a.blending!==undefined)this.blending=a.blending;if(a.wireframe!==undefined)this.wireframe=a.wireframe;if(a.wireframe_linewidth!==
undefined)this.wireframe_linewidth=a.wireframe_linewidth;if(a.wireframe_linecap!==undefined)this.wireframe_linecap=a.wireframe_linecap;if(a.wireframe_linejoin!==undefined)this.wireframe_linejoin=a.wireframe_linejoin}};
THREE.MeshLambertMaterial.prototype={toString:function(){return"THREE.MeshLambertMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>shading: "+this.shading+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+
this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/> )"}};THREE.MeshLambertMaterialCounter={value:0};
THREE.MeshPhongMaterial=function(a){this.id=THREE.MeshPhongMaterialCounter.value++;this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(328965);this.specular=new THREE.Color(1118481);this.shininess=30;this.env_map=this.specular_map=this.map=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refraction_ratio=0.98;this.fog=true;this.opacity=1;this.shading=THREE.SmoothShading;this.blending=THREE.NormalBlending;this.wireframe=false;this.wireframe_linewidth=1;this.wireframe_linejoin=
this.wireframe_linecap="round";if(a){if(a.color!==undefined)this.color=new THREE.Color(a.color);if(a.ambient!==undefined)this.ambient=new THREE.Color(a.ambient);if(a.specular!==undefined)this.specular=new THREE.Color(a.specular);if(a.shininess!==undefined)this.shininess=a.shininess;if(a.map!==undefined)this.map=a.map;if(a.specular_map!==undefined)this.specular_map=a.specular_map;if(a.env_map!==undefined)this.env_map=a.env_map;if(a.combine!==undefined)this.combine=a.combine;if(a.reflectivity!==undefined)this.reflectivity=
a.reflectivity;if(a.refraction_ratio!==undefined)this.refraction_ratio=a.refraction_ratio;if(a.fog!==undefined)this.fog=a.fog;if(a.opacity!==undefined)this.opacity=a.opacity;if(a.shading!==undefined)this.shading=a.shading;if(a.blending!==undefined)this.blending=a.blending;if(a.wireframe!==undefined)this.wireframe=a.wireframe;if(a.wireframe_linewidth!==undefined)this.wireframe_linewidth=a.wireframe_linewidth;if(a.wireframe_linecap!==undefined)this.wireframe_linecap=a.wireframe_linecap;if(a.wireframe_linejoin!==
undefined)this.wireframe_linejoin=a.wireframe_linejoin}};
THREE.MeshPhongMaterial.prototype={toString:function(){return"THREE.MeshPhongMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>ambient: "+this.ambient+"<br/>specular: "+this.specular+"<br/>shininess: "+this.shininess+"<br/>map: "+this.map+"<br/>specular_map: "+this.specular_map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>shading: "+this.shading+"<br/>wireframe: "+
this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>)"}};THREE.MeshPhongMaterialCounter={value:0};
THREE.MeshDepthMaterial=function(a){this.near=1;this.far=1E3;this.opacity=1;this.shading=THREE.SmoothShading;this.blending=THREE.NormalBlending;this.wireframe=false;this.wireframe_linewidth=1;this.wireframe_linejoin=this.wireframe_linecap="round";if(a){if(a.near!==undefined)this.near=a.near;if(a.far!==undefined)this.far=a.far;if(a.opacity!==undefined)this.opacity=a.opacity;if(a.blending!==undefined)this.blending=a.blending}this.__2near=2*this.near;this.__farPlusNear=this.far+this.near;this.__farMinusNear=
this.far-this.near};THREE.MeshDepthMaterial.prototype={toString:function(){return"THREE.MeshDepthMaterial"}};THREE.MeshNormalMaterial=function(a){this.opacity=1;this.shading=THREE.FlatShading;this.blending=THREE.NormalBlending;if(a){if(a.opacity!==undefined)this.opacity=a.opacity;if(a.shading!==undefined)this.shading=a.shading;if(a.blending!==undefined)this.blending=a.blending}};THREE.MeshNormalMaterial.prototype={toString:function(){return"THREE.MeshNormalMaterial"}};THREE.MeshFaceMaterial=function(){};
THREE.MeshFaceMaterial.prototype={toString:function(){return"THREE.MeshFaceMaterial"}};
THREE.MeshShaderMaterial=function(a){this.id=THREE.MeshShaderMaterialCounter.value++;this.vertex_shader=this.fragment_shader="void main() {}";this.uniforms={};this.opacity=1;this.shading=THREE.SmoothShading;this.blending=THREE.NormalBlending;this.wireframe=false;this.wireframe_linewidth=1;this.wireframe_linejoin=this.wireframe_linecap="round";if(a){if(a.fragment_shader!==undefined)this.fragment_shader=a.fragment_shader;if(a.vertex_shader!==undefined)this.vertex_shader=a.vertex_shader;if(a.uniforms!==
undefined)this.uniforms=a.uniforms;if(a.shading!==undefined)this.shading=a.shading;if(a.blending!==undefined)this.blending=a.blending;if(a.wireframe!==undefined)this.wireframe=a.wireframe;if(a.wireframe_linewidth!==undefined)this.wireframe_linewidth=a.wireframe_linewidth;if(a.wireframe_linecap!==undefined)this.wireframe_linecap=a.wireframe_linecap;if(a.wireframe_linejoin!==undefined)this.wireframe_linejoin=a.wireframe_linejoin}};
THREE.MeshShaderMaterial.prototype={toString:function(){return"THREE.MeshShaderMaterial (<br/>id: "+this.id+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>)"}};THREE.MeshShaderMaterialCounter={value:0};
THREE.ParticleBasicMaterial=function(a){this.color=new THREE.Color(16777215);this.map=null;this.opacity=1;this.blending=THREE.NormalBlending;this.offset=new THREE.Vector2;if(a){a.color!==undefined&&this.color.setHex(a.color);if(a.map!==undefined)this.map=a.map;if(a.opacity!==undefined)this.opacity=a.opacity;if(a.blending!==undefined)this.blending=a.blending}};
THREE.ParticleBasicMaterial.prototype={toString:function(){return"THREE.ParticleBasicMaterial (<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>)"}};THREE.ParticleCircleMaterial=function(a){this.color=new THREE.Color(16777215);this.opacity=1;this.blending=THREE.NormalBlending;if(a){a.color!==undefined&&this.color.setHex(a.color);if(a.opacity!==undefined)this.opacity=a.opacity;if(a.blending!==undefined)this.blending=a.blending}};
THREE.ParticleCircleMaterial.prototype={toString:function(){return"THREE.ParticleCircleMaterial (<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>)"}};THREE.ParticleDOMMaterial=function(a){this.domElement=a};THREE.ParticleDOMMaterial.prototype={toString:function(){return"THREE.ParticleDOMMaterial ( domElement: "+this.domElement+" )"}};
THREE.Texture=function(a,b,f,d,j,k){this.image=a;this.mapping=b!==undefined?b:new THREE.UVMapping;this.wrap_s=f!==undefined?f:THREE.ClampToEdgeWrapping;this.wrap_t=d!==undefined?d:THREE.ClampToEdgeWrapping;this.mag_filter=j!==undefined?j:THREE.LinearFilter;this.min_filter=k!==undefined?k:THREE.LinearMipMapLinearFilter};
THREE.Texture.prototype={toString:function(){return"THREE.Texture (<br/>image: "+this.image+"<br/>wrap_s: "+this.wrap_s+"<br/>wrap_t: "+this.wrap_t+"<br/>mag_filter: "+this.mag_filter+"<br/>min_filter: "+this.min_filter+"<br/>)"}};THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;
THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};
THREE.Scene=function(){this.objects=[];this.lights=[];this.fog=null;this.addObject=function(a){this.objects.indexOf(a)===-1&&this.objects.push(a)};this.removeObject=function(a){a=this.objects.indexOf(a);a!==-1&&this.objects.splice(a,1)};this.addLight=function(a){this.lights.indexOf(a)===-1&&this.lights.push(a)};this.removeLight=function(a){a=this.lights.indexOf(a);a!==-1&&this.lights.splice(a,1)};this.toString=function(){return"THREE.Scene ( "+this.objects+" )"}};
THREE.Fog=function(a,b){this.color=new THREE.Color(a);this.density=b||2.5E-4};
THREE.Projector=function(){function a(e,h){return h.z-e.z}function b(e,h){var m=0,i=1,n=e.z+e.w,g=h.z+h.w,o=-e.z+e.w,r=-h.z+h.w;if(n>=0&&g>=0&&o>=0&&r>=0)return true;else if(n<0&&g<0||o<0&&r<0)return false;else{if(n<0)m=Math.max(m,n/(n-g));else if(g<0)i=Math.min(i,n/(n-g));if(o<0)m=Math.max(m,o/(o-r));else if(r<0)i=Math.min(i,o/(o-r));if(i<m)return false;else{e.lerpSelf(h,m);h.lerpSelf(e,1-i);return true}}}var f,d,j=[],k,q,l,p=[],y,c,C=[],u,t,J=[],R=new THREE.Vector4,N=new THREE.Vector4,s=new THREE.Matrix4,
T=new THREE.Matrix4,B=[],L=new THREE.Vector4,O=new THREE.Vector4,Q;this.projectObjects=function(e,h,m){var i=[],n,g;d=0;s.multiply(h.projectionMatrix,h.matrix);B[0]=new THREE.Vector4(s.n41-s.n11,s.n42-s.n12,s.n43-s.n13,s.n44-s.n14);B[1]=new THREE.Vector4(s.n41+s.n11,s.n42+s.n12,s.n43+s.n13,s.n44+s.n14);B[2]=new THREE.Vector4(s.n41+s.n21,s.n42+s.n22,s.n43+s.n23,s.n44+s.n24);B[3]=new THREE.Vector4(s.n41-s.n21,s.n42-s.n22,s.n43-s.n23,s.n44-s.n24);B[4]=new THREE.Vector4(s.n41-s.n31,s.n42-s.n32,s.n43-
s.n33,s.n44-s.n34);B[5]=new THREE.Vector4(s.n41+s.n31,s.n42+s.n32,s.n43+s.n33,s.n44+s.n34);h=0;for(n=B.length;h<n;h++){g=B[h];g.divideScalar(Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z))}n=e.objects;e=0;for(h=n.length;e<h;e++){g=n[e];var o;if(!(o=!g.visible)){if(o=g instanceof THREE.Mesh){a:{o=void 0;for(var r=g.position,D=-g.geometry.boundingSphere.radius*Math.max(g.scale.x,Math.max(g.scale.y,g.scale.z)),M=0;M<6;M++){o=B[M].x*r.x+B[M].y*r.y+B[M].z*r.z+B[M].w;if(o<=D){o=false;break a}}o=true}o=!o}o=o}if(!o){f=
j[d]=j[d]||new THREE.RenderableObject;R.copy(g.position);s.multiplyVector3(R);f.object=g;f.z=R.z;i.push(f);d++}}m&&i.sort(a);return i};this.projectScene=function(e,h,m){var i=[],n,g,o,r,D,M,H,z,S,E,U,F,w,x,K,G;l=c=t=0;h.autoUpdateMatrix&&h.updateMatrix();s.multiply(h.projectionMatrix,h.matrix);M=this.projectObjects(e,h,true);e=0;for(n=M.length;e<n;e++){H=M[e].object;if(H.visible){H.autoUpdateMatrix&&H.updateMatrix();z=H.matrix;S=H.rotationMatrix;E=H.materials;U=H.overdraw;if(H instanceof THREE.Mesh){F=
H.geometry;w=F.vertices;g=0;for(o=w.length;g<o;g++){x=w[g];x.positionWorld.copy(x.position);z.multiplyVector3(x.positionWorld);r=x.positionScreen;r.copy(x.positionWorld);s.multiplyVector4(r);r.multiplyScalar(1/r.w);x.__visible=r.z>0&&r.z<1}F=F.faces;g=0;for(o=F.length;g<o;g++){x=F[g];if(x instanceof THREE.Face3){r=w[x.a];D=w[x.b];K=w[x.c];if(r.__visible&&D.__visible&&K.__visible)if(H.doubleSided||H.flipSided!=(K.positionScreen.x-r.positionScreen.x)*(D.positionScreen.y-r.positionScreen.y)-(K.positionScreen.y-
r.positionScreen.y)*(D.positionScreen.x-r.positionScreen.x)<0){k=p[l]=p[l]||new THREE.RenderableFace3;k.v1.positionWorld.copy(r.positionWorld);k.v2.positionWorld.copy(D.positionWorld);k.v3.positionWorld.copy(K.positionWorld);k.v1.positionScreen.copy(r.positionScreen);k.v2.positionScreen.copy(D.positionScreen);k.v3.positionScreen.copy(K.positionScreen);k.normalWorld.copy(x.normal);S.multiplyVector3(k.normalWorld);k.centroidWorld.copy(x.centroid);z.multiplyVector3(k.centroidWorld);k.centroidScreen.copy(k.centroidWorld);
s.multiplyVector3(k.centroidScreen);K=x.vertexNormals;Q=k.vertexNormalsWorld;r=0;for(D=K.length;r<D;r++){G=Q[r]=Q[r]||new THREE.Vector3;G.copy(K[r]);S.multiplyVector3(G)}k.z=k.centroidScreen.z;k.meshMaterials=E;k.faceMaterials=x.materials;k.overdraw=U;if(H.geometry.uvs[g]){k.uvs[0]=H.geometry.uvs[g][0];k.uvs[1]=H.geometry.uvs[g][1];k.uvs[2]=H.geometry.uvs[g][2]}i.push(k);l++}}else if(x instanceof THREE.Face4){r=w[x.a];D=w[x.b];K=w[x.c];G=w[x.d];if(r.__visible&&D.__visible&&K.__visible&&G.__visible)if(H.doubleSided||
H.flipSided!=((G.positionScreen.x-r.positionScreen.x)*(D.positionScreen.y-r.positionScreen.y)-(G.positionScreen.y-r.positionScreen.y)*(D.positionScreen.x-r.positionScreen.x)<0||(D.positionScreen.x-K.positionScreen.x)*(G.positionScreen.y-K.positionScreen.y)-(D.positionScreen.y-K.positionScreen.y)*(G.positionScreen.x-K.positionScreen.x)<0)){k=p[l]=p[l]||new THREE.RenderableFace3;k.v1.positionWorld.copy(r.positionWorld);k.v2.positionWorld.copy(D.positionWorld);k.v3.positionWorld.copy(G.positionWorld);
k.v1.positionScreen.copy(r.positionScreen);k.v2.positionScreen.copy(D.positionScreen);k.v3.positionScreen.copy(G.positionScreen);k.normalWorld.copy(x.normal);S.multiplyVector3(k.normalWorld);k.centroidWorld.copy(x.centroid);z.multiplyVector3(k.centroidWorld);k.centroidScreen.copy(k.centroidWorld);s.multiplyVector3(k.centroidScreen);k.z=k.centroidScreen.z;k.meshMaterials=E;k.faceMaterials=x.materials;k.overdraw=U;if(H.geometry.uvs[g]){k.uvs[0]=H.geometry.uvs[g][0];k.uvs[1]=H.geometry.uvs[g][1];k.uvs[2]=
H.geometry.uvs[g][3]}i.push(k);l++;q=p[l]=p[l]||new THREE.RenderableFace3;q.v1.positionWorld.copy(D.positionWorld);q.v2.positionWorld.copy(K.positionWorld);q.v3.positionWorld.copy(G.positionWorld);q.v1.positionScreen.copy(D.positionScreen);q.v2.positionScreen.copy(K.positionScreen);q.v3.positionScreen.copy(G.positionScreen);q.normalWorld.copy(k.normalWorld);q.centroidWorld.copy(k.centroidWorld);q.centroidScreen.copy(k.centroidScreen);q.z=q.centroidScreen.z;q.meshMaterials=E;q.faceMaterials=x.materials;
q.overdraw=U;if(H.geometry.uvs[g]){q.uvs[0]=H.geometry.uvs[g][1];q.uvs[1]=H.geometry.uvs[g][2];q.uvs[2]=H.geometry.uvs[g][3]}i.push(q);l++}}}}else if(H instanceof THREE.Line){T.multiply(s,z);w=H.geometry.vertices;x=w[0];x.positionScreen.copy(x.position);T.multiplyVector4(x.positionScreen);g=1;for(o=w.length;g<o;g++){r=w[g];r.positionScreen.copy(r.position);T.multiplyVector4(r.positionScreen);D=w[g-1];L.copy(r.positionScreen);O.copy(D.positionScreen);if(b(L,O)){L.multiplyScalar(1/L.w);O.multiplyScalar(1/
O.w);y=C[c]=C[c]||new THREE.RenderableLine;y.v1.positionScreen.copy(L);y.v2.positionScreen.copy(O);y.z=Math.max(L.z,O.z);y.materials=H.materials;i.push(y);c++}}}else if(H instanceof THREE.Particle){N.set(H.position.x,H.position.y,H.position.z,1);s.multiplyVector4(N);N.z/=N.w;if(N.z>0&&N.z<1){u=J[t]=J[t]||new THREE.RenderableParticle;u.x=N.x/N.w;u.y=N.y/N.w;u.z=N.z;u.rotation=H.rotation.z;u.scale.x=H.scale.x*Math.abs(u.x-(N.x+h.projectionMatrix.n11)/(N.w+h.projectionMatrix.n14));u.scale.y=H.scale.y*
Math.abs(u.y-(N.y+h.projectionMatrix.n22)/(N.w+h.projectionMatrix.n24));u.materials=H.materials;i.push(u);t++}}}}m&&i.sort(a);return i};this.unprojectVector=function(e,h){var m=new THREE.Matrix4;m.multiply(THREE.Matrix4.makeInvert(h.matrix),THREE.Matrix4.makeInvert(h.projectionMatrix));m.multiplyVector3(e);return e}};
THREE.DOMRenderer=function(){THREE.Renderer.call(this);var a=null,b=new THREE.Projector,f,d,j,k;this.domElement=document.createElement("div");this.setSize=function(q,l){f=q;d=l;j=f/2;k=d/2};this.render=function(q,l){var p,y,c,C,u,t,J,R;a=b.projectScene(q,l);p=0;for(y=a.length;p<y;p++){u=a[p];if(u instanceof THREE.RenderableParticle){J=u.x*j+j;R=u.y*k+k;c=0;for(C=u.material.length;c<C;c++){t=u.material[c];if(t instanceof THREE.ParticleDOMMaterial){t=t.domElement;t.style.left=J+"px";t.style.top=R+"px"}}}}}};
THREE.CanvasRenderer=function(){var a=null,b=new THREE.Projector,f=document.createElement("canvas"),d,j,k,q,l=f.getContext("2d"),p=1,y=0,c=null,C=null,u=1,t,J,R,N,s,T,B,L,O,Q=new THREE.Color,e=new THREE.Color,h=new THREE.Color,m=new THREE.Color,i=new THREE.Color,n,g,o,r,D,M,H,z,S,E,U=new THREE.Rectangle,F=new THREE.Rectangle,w=new THREE.Rectangle,x=false,K=new THREE.Color,G=new THREE.Color,W=new THREE.Color,ba=new THREE.Color,Ka=Math.PI*2,Y=new THREE.Vector3,oa,pa,Ba,ea,qa,ua,ma=16;oa=document.createElement("canvas");
oa.width=oa.height=2;pa=oa.getContext("2d");pa.fillStyle="rgba(0,0,0,1)";pa.fillRect(0,0,2,2);Ba=pa.getImageData(0,0,2,2);ea=Ba.data;qa=document.createElement("canvas");qa.width=qa.height=ma;ua=qa.getContext("2d");ua.translate(-ma/2,-ma/2);ua.scale(ma,ma);ma--;this.domElement=f;this.sortElements=this.sortObjects=this.autoClear=true;this.setSize=function(ha,va){d=ha;j=va;k=d/2;q=j/2;f.width=d;f.height=j;U.set(-k,-q,k,q)};this.clear=function(){if(!F.isEmpty()){F.inflate(1);F.minSelf(U);l.clearRect(F.getX(),
F.getY(),F.getWidth(),F.getHeight());F.empty()}};this.render=function(ha,va){function La(v){var V,P,A,I=v.lights;G.setRGB(0,0,0);W.setRGB(0,0,0);ba.setRGB(0,0,0);v=0;for(V=I.length;v<V;v++){P=I[v];A=P.color;if(P instanceof THREE.AmbientLight){G.r+=A.r;G.g+=A.g;G.b+=A.b}else if(P instanceof THREE.DirectionalLight){W.r+=A.r;W.g+=A.g;W.b+=A.b}else if(P instanceof THREE.PointLight){ba.r+=A.r;ba.g+=A.g;ba.b+=A.b}}}function wa(v,V,P,A){var I,X,$,ca,da=v.lights;v=0;for(I=da.length;v<I;v++){X=da[v];$=X.color;
ca=X.intensity;if(X instanceof THREE.DirectionalLight){X=P.dot(X.position)*ca;if(X>0){A.r+=$.r*X;A.g+=$.g*X;A.b+=$.b*X}}else if(X instanceof THREE.PointLight){Y.sub(X.position,V);Y.normalize();X=P.dot(Y)*ca;if(X>0){A.r+=$.r*X;A.g+=$.g*X;A.b+=$.b*X}}}}function Ma(v,V,P){if(P.opacity!=0){Ca(P.opacity);xa(P.blending);var A,I,X,$,ca,da;if(P instanceof THREE.ParticleBasicMaterial){if(P.map){$=P.map;ca=$.width>>1;da=$.height>>1;I=V.scale.x*k;X=V.scale.y*q;P=I*ca;A=X*da;w.set(v.x-P,v.y-A,v.x+P,v.y+A);if(U.instersects(w)){l.save();
l.translate(v.x,v.y);l.rotate(-V.rotation);l.scale(I,-X);l.translate(-ca,-da);l.drawImage($,0,0);l.restore()}}}else if(P instanceof THREE.ParticleCircleMaterial){if(x){K.r=G.r+W.r+ba.r;K.g=G.g+W.g+ba.g;K.b=G.b+W.b+ba.b;Q.r=P.color.r*K.r;Q.g=P.color.g*K.g;Q.b=P.color.b*K.b;Q.updateStyleString()}else Q.__styleString=P.color.__styleString;P=V.scale.x*k;A=V.scale.y*q;w.set(v.x-P,v.y-A,v.x+P,v.y+A);if(U.instersects(w)){I=Q.__styleString;if(C!=I)l.fillStyle=C=I;l.save();l.translate(v.x,v.y);l.rotate(-V.rotation);
l.scale(P,A);l.beginPath();l.arc(0,0,1,0,Ka,true);l.closePath();l.fill();l.restore()}}}}function Na(v,V,P,A){if(A.opacity!=0){Ca(A.opacity);xa(A.blending);l.beginPath();l.moveTo(v.positionScreen.x,v.positionScreen.y);l.lineTo(V.positionScreen.x,V.positionScreen.y);l.closePath();if(A instanceof THREE.LineBasicMaterial){Q.__styleString=A.color.__styleString;v=A.linewidth;if(u!=v)l.lineWidth=u=v;v=Q.__styleString;if(c!=v)l.strokeStyle=c=v;l.stroke();w.inflate(A.linewidth*2)}}}function Ga(v,V,P,A,I,X){if(I.opacity!=
0){Ca(I.opacity);xa(I.blending);N=v.positionScreen.x;s=v.positionScreen.y;T=V.positionScreen.x;B=V.positionScreen.y;L=P.positionScreen.x;O=P.positionScreen.y;l.beginPath();l.moveTo(N,s);l.lineTo(T,B);l.lineTo(L,O);l.lineTo(N,s);l.closePath();if(I instanceof THREE.MeshBasicMaterial)if(I.map)I.map.image.loaded&&I.map.mapping instanceof THREE.UVMapping&&ra(N,s,T,B,L,O,I.map.image,A.uvs[0].u,A.uvs[0].v,A.uvs[1].u,A.uvs[1].v,A.uvs[2].u,A.uvs[2].v);else if(I.env_map){if(I.env_map.image.loaded)if(I.env_map.mapping instanceof
THREE.SphericalReflectionMapping){v=va.matrix;Y.copy(A.vertexNormalsWorld[0]);D=(Y.x*v.n11+Y.y*v.n12+Y.z*v.n13)*0.5+0.5;M=-(Y.x*v.n21+Y.y*v.n22+Y.z*v.n23)*0.5+0.5;Y.copy(A.vertexNormalsWorld[1]);H=(Y.x*v.n11+Y.y*v.n12+Y.z*v.n13)*0.5+0.5;z=-(Y.x*v.n21+Y.y*v.n22+Y.z*v.n23)*0.5+0.5;Y.copy(A.vertexNormalsWorld[2]);S=(Y.x*v.n11+Y.y*v.n12+Y.z*v.n13)*0.5+0.5;E=-(Y.x*v.n21+Y.y*v.n22+Y.z*v.n23)*0.5+0.5;ra(N,s,T,B,L,O,I.env_map.image,D,M,H,z,S,E)}}else I.wireframe?ya(I.color.__styleString,I.wireframe_linewidth):
za(I.color.__styleString);else if(I instanceof THREE.MeshLambertMaterial){if(I.map&&!I.wireframe){I.map.mapping instanceof THREE.UVMapping&&ra(N,s,T,B,L,O,I.map.image,A.uvs[0].u,A.uvs[0].v,A.uvs[1].u,A.uvs[1].v,A.uvs[2].u,A.uvs[2].v);xa(THREE.SubtractiveBlending)}if(x)if(!I.wireframe&&I.shading==THREE.SmoothShading&&A.vertexNormalsWorld.length==3){e.r=h.r=m.r=G.r;e.g=h.g=m.g=G.g;e.b=h.b=m.b=G.b;wa(X,A.v1.positionWorld,A.vertexNormalsWorld[0],e);wa(X,A.v2.positionWorld,A.vertexNormalsWorld[1],h);wa(X,
A.v3.positionWorld,A.vertexNormalsWorld[2],m);i.r=(h.r+m.r)*0.5;i.g=(h.g+m.g)*0.5;i.b=(h.b+m.b)*0.5;r=Ha(e,h,m,i);ra(N,s,T,B,L,O,r,0,0,1,0,0,1)}else{K.r=G.r;K.g=G.g;K.b=G.b;wa(X,A.centroidWorld,A.normalWorld,K);Q.r=I.color.r*K.r;Q.g=I.color.g*K.g;Q.b=I.color.b*K.b;Q.updateStyleString();I.wireframe?ya(Q.__styleString,I.wireframe_linewidth):za(Q.__styleString)}else I.wireframe?ya(I.color.__styleString,I.wireframe_linewidth):za(I.color.__styleString)}else if(I instanceof THREE.MeshDepthMaterial){n=I.__2near;
g=I.__farPlusNear;o=I.__farMinusNear;e.r=e.g=e.b=1-n/(g-v.positionScreen.z*o);h.r=h.g=h.b=1-n/(g-V.positionScreen.z*o);m.r=m.g=m.b=1-n/(g-P.positionScreen.z*o);i.r=(h.r+m.r)*0.5;i.g=(h.g+m.g)*0.5;i.b=(h.b+m.b)*0.5;r=Ha(e,h,m,i);ra(N,s,T,B,L,O,r,0,0,1,0,0,1)}else if(I instanceof THREE.MeshNormalMaterial){Q.r=Da(A.normalWorld.x);Q.g=Da(A.normalWorld.y);Q.b=Da(A.normalWorld.z);Q.updateStyleString();I.wireframe?ya(Q.__styleString,I.wireframe_linewidth):za(Q.__styleString)}}}function ya(v,V){if(c!=v)l.strokeStyle=
c=v;if(u!=V)l.lineWidth=u=V;l.stroke();w.inflate(V*2)}function za(v){if(C!=v)l.fillStyle=C=v;l.fill()}function ra(v,V,P,A,I,X,$,ca,da,ia,fa,ja,sa){var la,ka;la=$.width-1;ka=$.height-1;ca*=la;da*=ka;ia*=la;fa*=ka;ja*=la;sa*=ka;P-=v;A-=V;I-=v;X-=V;ia-=ca;fa-=da;ja-=ca;sa-=da;ka=1/(ia*sa-ja*fa);la=(sa*P-fa*I)*ka;fa=(sa*A-fa*X)*ka;P=(ia*I-ja*P)*ka;A=(ia*X-ja*A)*ka;v=v-la*ca-P*da;V=V-fa*ca-A*da;l.save();l.transform(la,fa,P,A,v,V);l.clip();l.drawImage($,0,0);l.restore()}function Ca(v){if(p!=v)l.globalAlpha=
p=v}function xa(v){if(y!=v){switch(v){case THREE.NormalBlending:l.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:l.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:l.globalCompositeOperation="darker"}y=v}}function Ha(v,V,P,A){var I=~~(v.r*255),X=~~(v.g*255);v=~~(v.b*255);var $=~~(V.r*255),ca=~~(V.g*255);V=~~(V.b*255);var da=~~(P.r*255),ia=~~(P.g*255);P=~~(P.b*255);var fa=~~(A.r*255),ja=~~(A.g*255);A=~~(A.b*255);ea[0]=I<0?0:I>255?255:I;ea[1]=X<0?0:X>
255?255:X;ea[2]=v<0?0:v>255?255:v;ea[4]=$<0?0:$>255?255:$;ea[5]=ca<0?0:ca>255?255:ca;ea[6]=V<0?0:V>255?255:V;ea[8]=da<0?0:da>255?255:da;ea[9]=ia<0?0:ia>255?255:ia;ea[10]=P<0?0:P>255?255:P;ea[12]=fa<0?0:fa>255?255:fa;ea[13]=ja<0?0:ja>255?255:ja;ea[14]=A<0?0:A>255?255:A;pa.putImageData(Ba,0,0);ua.drawImage(oa,0,0);return qa}function Da(v){v=(v+1)*0.5;return v<0?0:v>1?1:v}function Ea(v,V){var P=V.x-v.x,A=V.y-v.y,I=1/Math.sqrt(P*P+A*A);P*=I;A*=I;V.x+=P;V.y+=A;v.x-=P;v.y-=A}var Aa,Ia,Z,ga,na,Fa,Ja,ta;
l.setTransform(1,0,0,-1,k,q);this.autoClear&&this.clear();a=b.projectScene(ha,va,this.sortElements);(x=ha.lights.length>0)&&La(ha);Aa=0;for(Ia=a.length;Aa<Ia;Aa++){Z=a[Aa];w.empty();if(Z instanceof THREE.RenderableParticle){t=Z;t.x*=k;t.y*=q;ga=0;for(na=Z.materials.length;ga<na;ga++)Ma(t,Z,Z.materials[ga],ha)}else if(Z instanceof THREE.RenderableLine){t=Z.v1;J=Z.v2;t.positionScreen.x*=k;t.positionScreen.y*=q;J.positionScreen.x*=k;J.positionScreen.y*=q;w.addPoint(t.positionScreen.x,t.positionScreen.y);
w.addPoint(J.positionScreen.x,J.positionScreen.y);if(U.instersects(w)){ga=0;for(na=Z.materials.length;ga<na;)Na(t,J,Z,Z.materials[ga++],ha)}}else if(Z instanceof THREE.RenderableFace3){t=Z.v1;J=Z.v2;R=Z.v3;t.positionScreen.x*=k;t.positionScreen.y*=q;J.positionScreen.x*=k;J.positionScreen.y*=q;R.positionScreen.x*=k;R.positionScreen.y*=q;if(Z.overdraw){Ea(t.positionScreen,J.positionScreen);Ea(J.positionScreen,R.positionScreen);Ea(R.positionScreen,t.positionScreen)}w.add3Points(t.positionScreen.x,t.positionScreen.y,
J.positionScreen.x,J.positionScreen.y,R.positionScreen.x,R.positionScreen.y);if(U.instersects(w)){ga=0;for(na=Z.meshMaterials.length;ga<na;){ta=Z.meshMaterials[ga++];if(ta instanceof THREE.MeshFaceMaterial){Fa=0;for(Ja=Z.faceMaterials.length;Fa<Ja;)(ta=Z.faceMaterials[Fa++])&&Ga(t,J,R,Z,ta,ha)}else Ga(t,J,R,Z,ta,ha)}}}F.addRectangle(w)}l.setTransform(1,0,0,1,0,0)}};
THREE.SVGRenderer=function(){function a(z,S,E){var U,F,w,x;U=0;for(F=z.lights.length;U<F;U++){w=z.lights[U];if(w instanceof THREE.DirectionalLight){x=S.normalWorld.dot(w.position)*w.intensity;if(x>0){E.r+=w.color.r*x;E.g+=w.color.g*x;E.b+=w.color.b*x}}else if(w instanceof THREE.PointLight){m.sub(w.position,S.centroidWorld);m.normalize();x=S.normalWorld.dot(m)*w.intensity;if(x>0){E.r+=w.color.r*x;E.g+=w.color.g*x;E.b+=w.color.b*x}}}}function b(z,S,E,U,F,w){o=d(r++);o.setAttribute("d","M "+z.positionScreen.x+
" "+z.positionScreen.y+" L "+S.positionScreen.x+" "+S.positionScreen.y+" L "+E.positionScreen.x+","+E.positionScreen.y+"z");if(F instanceof THREE.MeshBasicMaterial)B.__styleString=F.color.__styleString;else if(F instanceof THREE.MeshLambertMaterial)if(T){L.r=O.r;L.g=O.g;L.b=O.b;a(w,U,L);B.r=F.color.r*L.r;B.g=F.color.g*L.g;B.b=F.color.b*L.b;B.updateStyleString()}else B.__styleString=F.color.__styleString;else if(F instanceof THREE.MeshDepthMaterial){h=1-F.__2near/(F.__farPlusNear-U.z*F.__farMinusNear);
B.setRGB(h,h,h)}else F instanceof THREE.MeshNormalMaterial&&B.setRGB(j(U.normalWorld.x),j(U.normalWorld.y),j(U.normalWorld.z));F.wireframe?o.setAttribute("style","fill: none; stroke: "+B.__styleString+"; stroke-width: "+F.wireframe_linewidth+"; stroke-opacity: "+F.opacity+"; stroke-linecap: "+F.wireframe_linecap+"; stroke-linejoin: "+F.wireframe_linejoin):o.setAttribute("style","fill: "+B.__styleString+"; fill-opacity: "+F.opacity);l.appendChild(o)}function f(z,S,E,U,F,w,x){o=d(r++);o.setAttribute("d",
"M "+z.positionScreen.x+" "+z.positionScreen.y+" L "+S.positionScreen.x+" "+S.positionScreen.y+" L "+E.positionScreen.x+","+E.positionScreen.y+" L "+U.positionScreen.x+","+U.positionScreen.y+"z");if(w instanceof THREE.MeshBasicMaterial)B.__styleString=w.color.__styleString;else if(w instanceof THREE.MeshLambertMaterial)if(T){L.r=O.r;L.g=O.g;L.b=O.b;a(x,F,L);B.r=w.color.r*L.r;B.g=w.color.g*L.g;B.b=w.color.b*L.b;B.updateStyleString()}else B.__styleString=w.color.__styleString;else if(w instanceof THREE.MeshDepthMaterial){h=
1-w.__2near/(w.__farPlusNear-F.z*w.__farMinusNear);B.setRGB(h,h,h)}else w instanceof THREE.MeshNormalMaterial&&B.setRGB(j(F.normalWorld.x),j(F.normalWorld.y),j(F.normalWorld.z));w.wireframe?o.setAttribute("style","fill: none; stroke: "+B.__styleString+"; stroke-width: "+w.wireframe_linewidth+"; stroke-opacity: "+w.opacity+"; stroke-linecap: "+w.wireframe_linecap+"; stroke-linejoin: "+w.wireframe_linejoin):o.setAttribute("style","fill: "+B.__styleString+"; fill-opacity: "+w.opacity);l.appendChild(o)}
function d(z){if(i[z]==null){i[z]=document.createElementNS("http://www.w3.org/2000/svg","path");H==0&&i[z].setAttribute("shape-rendering","crispEdges");return i[z]}return i[z]}function j(z){return z<0?Math.min((1+z)*0.5,0.5):0.5+Math.min(z*0.5,0.5)}var k=null,q=new THREE.Projector,l=document.createElementNS("http://www.w3.org/2000/svg","svg"),p,y,c,C,u,t,J,R,N=new THREE.Rectangle,s=new THREE.Rectangle,T=false,B=new THREE.Color(16777215),L=new THREE.Color(16777215),O=new THREE.Color(0),Q=new THREE.Color(0),
e=new THREE.Color(0),h,m=new THREE.Vector3,i=[],n=[],g=[],o,r,D,M,H=1;this.domElement=l;this.sortElements=this.sortObjects=this.autoClear=true;this.setQuality=function(z){switch(z){case "high":H=1;break;case "low":H=0}};this.setSize=function(z,S){p=z;y=S;c=p/2;C=y/2;l.setAttribute("viewBox",-c+" "+-C+" "+p+" "+y);l.setAttribute("width",p);l.setAttribute("height",y);N.set(-c,-C,c,C)};this.clear=function(){for(;l.childNodes.length>0;)l.removeChild(l.childNodes[0])};this.render=function(z,S){var E,U,
F,w,x,K,G,W;this.autoClear&&this.clear();k=q.projectScene(z,S,this.sortElements);M=D=r=0;if(T=z.lights.length>0){G=z.lights;O.setRGB(0,0,0);Q.setRGB(0,0,0);e.setRGB(0,0,0);E=0;for(U=G.length;E<U;E++){F=G[E];w=F.color;if(F instanceof THREE.AmbientLight){O.r+=w.r;O.g+=w.g;O.b+=w.b}else if(F instanceof THREE.DirectionalLight){Q.r+=w.r;Q.g+=w.g;Q.b+=w.b}else if(F instanceof THREE.PointLight){e.r+=w.r;e.g+=w.g;e.b+=w.b}}}E=0;for(U=k.length;E<U;E++){G=k[E];s.empty();if(G instanceof THREE.RenderableParticle){u=
G;u.x*=c;u.y*=-C;F=0;for(w=G.materials.length;F<w;F++)if(W=G.materials[F]){x=u;K=G;W=W;var ba=D++;if(n[ba]==null){n[ba]=document.createElementNS("http://www.w3.org/2000/svg","circle");H==0&&n[ba].setAttribute("shape-rendering","crispEdges")}o=n[ba];o.setAttribute("cx",x.x);o.setAttribute("cy",x.y);o.setAttribute("r",K.scale.x*c);if(W instanceof THREE.ParticleCircleMaterial){if(T){L.r=O.r+Q.r+e.r;L.g=O.g+Q.g+e.g;L.b=O.b+Q.b+e.b;B.r=W.color.r*L.r;B.g=W.color.g*L.g;B.b=W.color.b*L.b;B.updateStyleString()}else B=
W.color;o.setAttribute("style","fill: "+B.__styleString)}l.appendChild(o)}}else if(G instanceof THREE.RenderableLine){u=G.v1;t=G.v2;u.positionScreen.x*=c;u.positionScreen.y*=-C;t.positionScreen.x*=c;t.positionScreen.y*=-C;s.addPoint(u.positionScreen.x,u.positionScreen.y);s.addPoint(t.positionScreen.x,t.positionScreen.y);if(N.instersects(s)){F=0;for(w=G.materials.length;F<w;)if(W=G.materials[F++]){x=u;K=t;W=W;ba=M++;if(g[ba]==null){g[ba]=document.createElementNS("http://www.w3.org/2000/svg","line");
H==0&&g[ba].setAttribute("shape-rendering","crispEdges")}o=g[ba];o.setAttribute("x1",x.positionScreen.x);o.setAttribute("y1",x.positionScreen.y);o.setAttribute("x2",K.positionScreen.x);o.setAttribute("y2",K.positionScreen.y);if(W instanceof THREE.LineBasicMaterial){B.__styleString=W.color.__styleString;o.setAttribute("style","fill: none; stroke: "+B.__styleString+"; stroke-width: "+W.linewidth+"; stroke-opacity: "+W.opacity+"; stroke-linecap: "+W.linecap+"; stroke-linejoin: "+W.linejoin);l.appendChild(o)}}}}else if(G instanceof
THREE.RenderableFace3){u=G.v1;t=G.v2;J=G.v3;u.positionScreen.x*=c;u.positionScreen.y*=-C;t.positionScreen.x*=c;t.positionScreen.y*=-C;J.positionScreen.x*=c;J.positionScreen.y*=-C;s.addPoint(u.positionScreen.x,u.positionScreen.y);s.addPoint(t.positionScreen.x,t.positionScreen.y);s.addPoint(J.positionScreen.x,J.positionScreen.y);if(N.instersects(s)){F=0;for(w=G.meshMaterials.length;F<w;){W=G.meshMaterials[F++];if(W instanceof THREE.MeshFaceMaterial){x=0;for(K=G.faceMaterials.length;x<K;)(W=G.faceMaterials[x++])&&
b(u,t,J,G,W,z)}else W&&b(u,t,J,G,W,z)}}}else if(G instanceof THREE.RenderableFace4){u=G.v1;t=G.v2;J=G.v3;R=G.v4;u.positionScreen.x*=c;u.positionScreen.y*=-C;t.positionScreen.x*=c;t.positionScreen.y*=-C;J.positionScreen.x*=c;J.positionScreen.y*=-C;R.positionScreen.x*=c;R.positionScreen.y*=-C;s.addPoint(u.positionScreen.x,u.positionScreen.y);s.addPoint(t.positionScreen.x,t.positionScreen.y);s.addPoint(J.positionScreen.x,J.positionScreen.y);s.addPoint(R.positionScreen.x,R.positionScreen.y);if(N.instersects(s)){F=
0;for(w=G.meshMaterials.length;F<w;){W=G.meshMaterials[F++];if(W instanceof THREE.MeshFaceMaterial){x=0;for(K=G.faceMaterials.length;x<K;)(W=G.faceMaterials[x++])&&f(u,t,J,R,G,W,z)}else W&&f(u,t,J,R,G,W,z)}}}}}};
THREE.WebGLRenderer=function(a,b){function f(e,h,m){var i=c.createProgram();m=["#ifdef GL_ES\nprecision highp float;\n#endif",m?"#define USE_FOG":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");var n=[c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0?"#define VERTEX_TEXTURES":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n"].join("\n");
c.attachShader(i,l("fragment",m+e));c.attachShader(i,l("vertex",n+h));c.linkProgram(i);c.getProgramParameter(i,c.LINK_STATUS)||alert("Could not initialise shaders\nVALIDATE_STATUS: "+c.getProgramParameter(i,c.VALIDATE_STATUS)+", gl error ["+c.getError()+"]");i.uniforms={};i.attributes={};return i}function d(e,h){if(e.image.length==6){if(!e.image.__webGLTextureCube&&!e.image.__cubeMapInitialized&&e.image.loadCount==6){e.image.__webGLTextureCube=c.createTexture();c.bindTexture(c.TEXTURE_CUBE_MAP,e.image.__webGLTextureCube);
c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_LINEAR);for(var m=0;m<6;++m)c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,e.image[m]);c.generateMipmap(c.TEXTURE_CUBE_MAP);c.bindTexture(c.TEXTURE_CUBE_MAP,null);e.image.__cubeMapInitialized=true}c.activeTexture(c.TEXTURE0+
h);c.bindTexture(c.TEXTURE_CUBE_MAP,e.image.__webGLTextureCube)}}function j(e,h){if(!e.__webGLTexture&&e.image.loaded){e.__webGLTexture=c.createTexture();c.bindTexture(c.TEXTURE_2D,e.__webGLTexture);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,e.image);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,p(e.wrap_s));c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,p(e.wrap_t));c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,p(e.mag_filter));c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,
p(e.min_filter));c.generateMipmap(c.TEXTURE_2D);c.bindTexture(c.TEXTURE_2D,null)}c.activeTexture(c.TEXTURE0+h);c.bindTexture(c.TEXTURE_2D,e.__webGLTexture)}function k(e,h){var m,i,n;m=0;for(i=h.length;m<i;m++){n=h[m];e.uniforms[n]=c.getUniformLocation(e,n)}}function q(e,h){var m,i,n;m=0;for(i=h.length;m<i;m++){n=h[m];e.attributes[n]=c.getAttribLocation(e,n)}}function l(e,h){var m;if(e=="fragment")m=c.createShader(c.FRAGMENT_SHADER);else if(e=="vertex")m=c.createShader(c.VERTEX_SHADER);c.shaderSource(m,
h);c.compileShader(m);if(!c.getShaderParameter(m,c.COMPILE_STATUS)){alert(c.getShaderInfoLog(m));return null}return m}function p(e){switch(e){case THREE.RepeatWrapping:return c.REPEAT;case THREE.ClampToEdgeWrapping:return c.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return c.MIRRORED_REPEAT;case THREE.NearestFilter:return c.NEAREST;case THREE.NearestMipMapNearestFilter:return c.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return c.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return c.LINEAR;
case THREE.LinearMipMapNearestFilter:return c.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return c.LINEAR_MIPMAP_LINEAR}return 0}var y=document.createElement("canvas"),c,C,u,t=new THREE.Matrix4,J,R=new Float32Array(16),N=new Float32Array(16),s=new Float32Array(16),T=new Float32Array(9),B=new Float32Array(16),L=function(e,h){if(e){var m,i,n,g=pointLights=maxDirLights=maxPointLights=0;m=0;for(i=e.lights.length;m<i;m++){n=e.lights[m];n instanceof THREE.DirectionalLight&&g++;n instanceof
THREE.PointLight&&pointLights++}if(pointLights+g<=h){maxDirLights=g;maxPointLights=pointLights}else{maxDirLights=Math.ceil(h*g/(pointLights+g));maxPointLights=h-maxDirLights}return{directional:maxDirLights,point:maxPointLights}}return{directional:1,point:h-1}}(a,4);fog=a?a.fog:null;aa=b!=undefined?b:true;this.domElement=y;this.autoClear=true;try{c=y.getContext("experimental-webgl",{antialias:aa})}catch(O){}if(!c){alert("WebGL not supported");throw"cannot create webgl context";}c.clearColor(0,0,0,
1);c.clearDepth(1);c.enable(c.DEPTH_TEST);c.depthFunc(c.LEQUAL);c.frontFace(c.CCW);c.cullFace(c.BACK);c.enable(c.CULL_FACE);c.enable(c.BLEND);c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA);c.clearColor(0,0,0,0);C=u=function(e,h,m){var i=[e?"#define MAX_DIR_LIGHTS "+e:"",h?"#define MAX_POINT_LIGHTS "+h:"","uniform bool enableLighting;\nuniform bool useRefract;\nuniform int pointLightNumber;\nuniform int directionalLightNumber;\nuniform vec3 ambientLightColor;",e?"uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];":
"",e?"uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];":"",h?"uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];":"",h?"uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];":"","varying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vLightWeighting;",h?"varying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];":"","varying vec3 vViewPosition;\nvarying vec3 vReflect;\nuniform float mRefractionRatio;\nvoid main(void) {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nif ( !enableLighting ) {\nvLightWeighting = vec3( 1.0, 1.0, 1.0 );\n} else {\nvLightWeighting = ambientLightColor;",
e?"for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {":"",e?"vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );":"",e?"float directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );":"",e?"vLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;":"",e?"}":"",h?"for( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {":"",h?"vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );":"",h?"vPointLightVector[ i ] = normalize( lPosition.xyz - mvPosition.xyz );":
"",h?"float pointLightWeighting = max( dot( transformedNormal, vPointLightVector[ i ] ), 0.0 );":"",h?"vLightWeighting += pointLightColor[ i ] * pointLightWeighting;":"",h?"}":"","}\nvNormal = transformedNormal;\nvUv = uv;\nif ( useRefract ) {\nvReflect = refract( normalize(mPosition.xyz - cameraPosition), normalize(nWorld.xyz), mRefractionRatio );\n} else {\nvReflect = reflect( normalize(mPosition.xyz - cameraPosition), normalize(nWorld.xyz) );\n}\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),
n=[e?"#define MAX_DIR_LIGHTS "+e:"",h?"#define MAX_POINT_LIGHTS "+h:"","uniform int material;\nuniform bool enableMap;\nuniform bool enableCubeMap;\nuniform bool mixEnvMap;\nuniform samplerCube tCube;\nuniform float mReflectivity;\nuniform sampler2D tMap;\nuniform vec4 mColor;\nuniform float mOpacity;\nuniform vec4 mAmbient;\nuniform vec4 mSpecular;\nuniform float mShininess;\n#ifdef USE_FOG\nuniform vec3 fogColor;\nuniform float fogDensity;\n#endif\nuniform int pointLightNumber;\nuniform int directionalLightNumber;",
e?"uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];":"","varying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vLightWeighting;",h?"varying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];":"","varying vec3 vViewPosition;\nvarying vec3 vReflect;\nvoid main() {\nvec4 mapColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nvec4 cubeColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nif ( enableMap ) {\nmapColor = texture2D( tMap, vUv );\n}\nif ( enableCubeMap ) {\ncubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n}\nif ( material == 2 ) { \nvec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );",
h?"vec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );":"",h?"vec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );":"",h?"for( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {":"",h?"vec3 pointVector = normalize( vPointLightVector[ i ] );":"",h?"vec3 pointHalfVector = normalize( vPointLightVector[ i ] + vViewPosition );":"",h?"float pointDotNormalHalf = dot( normal, pointHalfVector );":"",h?"float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );":"",h?"float pointSpecularWeight = 0.0;":"",h?"if ( pointDotNormalHalf >= 0.0 )":
"",h?"pointSpecularWeight = pow( pointDotNormalHalf, mShininess );":"",h?"pointDiffuse  += mColor * pointDiffuseWeight;":"",h?"pointSpecular += mSpecular * pointSpecularWeight;":"",h?"}":"",e?"vec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );":"",e?"vec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );":"",e?"for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {":"",e?"vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );":"",e?"vec3 dirVector = normalize( lDirection.xyz );":"",e?"vec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );":
"",e?"float dirDotNormalHalf = dot( normal, dirHalfVector );":"",e?"float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );":"",e?"float dirSpecularWeight = 0.0;":"",e?"if ( dirDotNormalHalf >= 0.0 )":"",e?"dirSpecularWeight = pow( dirDotNormalHalf, mShininess );":"",e?"dirDiffuse  += mColor * dirDiffuseWeight;":"",e?"dirSpecular += mSpecular * dirSpecularWeight;":"",e?"}":"","vec4 totalLight = mAmbient;",e?"totalLight += dirDiffuse + dirSpecular;":"",h?"totalLight += pointDiffuse + pointSpecular;":
"","if ( mixEnvMap ) {\ngl_FragColor = vec4( mix( mapColor.rgb * totalLight.xyz * vLightWeighting, cubeColor.rgb, mReflectivity ), mapColor.a );\n} else {\ngl_FragColor = vec4( mapColor.rgb * cubeColor.rgb * totalLight.xyz * vLightWeighting, mapColor.a );\n}\n} else if ( material == 1 ) {\nif ( mixEnvMap ) {\ngl_FragColor = vec4( mix( mColor.rgb * mapColor.rgb * vLightWeighting, cubeColor.rgb, mReflectivity ), mColor.a * mapColor.a );\n} else {\ngl_FragColor = vec4( mColor.rgb * mapColor.rgb * cubeColor.rgb * vLightWeighting, mColor.a * mapColor.a );\n}\n} else {\nif ( mixEnvMap ) {\ngl_FragColor = mix( mColor * mapColor, cubeColor, mReflectivity );\n} else {\ngl_FragColor = mColor * mapColor * cubeColor;\n}\n}\n#ifdef USE_FOG\nconst float LOG2 = 1.442695;\nfloat z = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = exp2( - fogDensity * fogDensity * z * z * LOG2 );\nfogFactor = clamp( fogFactor, 0.0, 1.0 );\ngl_FragColor = mix( vec4( fogColor, 1.0 ), gl_FragColor, fogFactor );\n#endif\n}"].join("\n");
i=f(n,i,m);c.useProgram(i);k(i,["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","enableLighting","ambientLightColor","material","mColor","mAmbient","mSpecular","mShininess","mOpacity","enableMap","tMap","enableCubeMap","tCube","mixEnvMap","mReflectivity","mRefractionRatio","useRefract"]);m&&k(i,["fogColor","fogDensity"]);e&&k(i,["directionalLightNumber","directionalLightColor","directionalLightDirection"]);h&&k(i,["pointLightNumber","pointLightColor",
"pointLightPosition"]);c.uniform1i(i.uniforms.enableMap,0);c.uniform1i(i.uniforms.tMap,0);c.uniform1i(i.uniforms.enableCubeMap,0);c.uniform1i(i.uniforms.tCube,1);c.uniform1i(i.uniforms.mixEnvMap,0);c.uniform1i(i.uniforms.useRefract,0);q(i,["position","normal","uv"]);return i}(L.directional,L.point,fog);this.setSize=function(e,h){y.width=e;y.height=h;c.viewport(0,0,y.width,y.height)};this.clear=function(){c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT)};this.setupLights=function(e,h){var m,i,n,g,o,
r=[],D=[],M=[];g=[];o=[];c.uniform1i(e.uniforms.enableLighting,h.length);m=0;for(i=h.length;m<i;m++){n=h[m];if(n instanceof THREE.AmbientLight)r.push(n);else if(n instanceof THREE.DirectionalLight)M.push(n);else n instanceof THREE.PointLight&&D.push(n)}m=n=g=o=0;for(i=r.length;m<i;m++){n+=r[m].color.r;g+=r[m].color.g;o+=r[m].color.b}c.uniform3f(e.uniforms.ambientLightColor,n,g,o);g=[];o=[];m=0;for(i=M.length;m<i;m++){n=M[m];g.push(n.color.r*n.intensity);g.push(n.color.g*n.intensity);g.push(n.color.b*
n.intensity);o.push(n.position.x);o.push(n.position.y);o.push(n.position.z)}if(M.length){c.uniform1i(e.uniforms.directionalLightNumber,M.length);c.uniform3fv(e.uniforms.directionalLightDirection,o);c.uniform3fv(e.uniforms.directionalLightColor,g)}g=[];o=[];m=0;for(i=D.length;m<i;m++){n=D[m];g.push(n.color.r*n.intensity);g.push(n.color.g*n.intensity);g.push(n.color.b*n.intensity);o.push(n.position.x);o.push(n.position.y);o.push(n.position.z)}if(D.length){c.uniform1i(e.uniforms.pointLightNumber,D.length);
c.uniform3fv(e.uniforms.pointLightPosition,o);c.uniform3fv(e.uniforms.pointLightColor,g)}};this.createBuffers=function(e,h){var m,i,n,g,o,r,D,M,H,z=[],S=[],E=[],U=[],F=[],w=[],x=0,K=e.geometry.geometryChunks[h],G;n=false;m=0;for(i=e.materials.length;m<i;m++){meshMaterial=e.materials[m];if(meshMaterial instanceof THREE.MeshFaceMaterial){o=0;for(G=K.materials.length;o<G;o++)if(K.materials[o]&&K.materials[o].shading!=undefined&&K.materials[o].shading==THREE.SmoothShading){n=true;break}}else if(meshMaterial&&
meshMaterial.shading!=undefined&&meshMaterial.shading==THREE.SmoothShading){n=true;break}if(n)break}G=n;m=0;for(i=K.faces.length;m<i;m++){n=K.faces[m];g=e.geometry.faces[n];o=g.vertexNormals;faceNormal=g.normal;n=e.geometry.uvs[n];if(g instanceof THREE.Face3){r=e.geometry.vertices[g.a].position;D=e.geometry.vertices[g.b].position;M=e.geometry.vertices[g.c].position;E.push(r.x,r.y,r.z);E.push(D.x,D.y,D.z);E.push(M.x,M.y,M.z);if(e.geometry.hasTangents){r=e.geometry.vertices[g.a].tangent;D=e.geometry.vertices[g.b].tangent;
M=e.geometry.vertices[g.c].tangent;F.push(r.x,r.y,r.z,r.w);F.push(D.x,D.y,D.z,D.w);F.push(M.x,M.y,M.z,M.w)}if(o.length==3&&G)for(g=0;g<3;g++)U.push(o[g].x,o[g].y,o[g].z);else for(g=0;g<3;g++)U.push(faceNormal.x,faceNormal.y,faceNormal.z);if(n)for(g=0;g<3;g++)w.push(n[g].u,n[g].v);z.push(x,x+1,x+2);S.push(x,x+1);S.push(x,x+2);S.push(x+1,x+2);x+=3}else if(g instanceof THREE.Face4){r=e.geometry.vertices[g.a].position;D=e.geometry.vertices[g.b].position;M=e.geometry.vertices[g.c].position;H=e.geometry.vertices[g.d].position;
E.push(r.x,r.y,r.z);E.push(D.x,D.y,D.z);E.push(M.x,M.y,M.z);E.push(H.x,H.y,H.z);if(e.geometry.hasTangents){r=e.geometry.vertices[g.a].tangent;D=e.geometry.vertices[g.b].tangent;M=e.geometry.vertices[g.c].tangent;g=e.geometry.vertices[g.d].tangent;F.push(r.x,r.y,r.z,r.w);F.push(D.x,D.y,D.z,D.w);F.push(M.x,M.y,M.z,M.w);F.push(g.x,g.y,g.z,g.w)}if(o.length==4&&G)for(g=0;g<4;g++)U.push(o[g].x,o[g].y,o[g].z);else for(g=0;g<4;g++)U.push(faceNormal.x,faceNormal.y,faceNormal.z);if(n)for(g=0;g<4;g++)w.push(n[g].u,
n[g].v);z.push(x,x+1,x+2);z.push(x,x+2,x+3);S.push(x,x+1);S.push(x,x+2);S.push(x,x+3);S.push(x+1,x+2);S.push(x+2,x+3);x+=4}}if(E.length){K.__webGLVertexBuffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,K.__webGLVertexBuffer);c.bufferData(c.ARRAY_BUFFER,new Float32Array(E),c.STATIC_DRAW);K.__webGLNormalBuffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,K.__webGLNormalBuffer);c.bufferData(c.ARRAY_BUFFER,new Float32Array(U),c.STATIC_DRAW);if(e.geometry.hasTangents){K.__webGLTangentBuffer=c.createBuffer();
c.bindBuffer(c.ARRAY_BUFFER,K.__webGLTangentBuffer);c.bufferData(c.ARRAY_BUFFER,new Float32Array(F),c.STATIC_DRAW)}if(w.length>0){K.__webGLUVBuffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,K.__webGLUVBuffer);c.bufferData(c.ARRAY_BUFFER,new Float32Array(w),c.STATIC_DRAW)}K.__webGLFaceBuffer=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,K.__webGLFaceBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(z),c.STATIC_DRAW);K.__webGLLineBuffer=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,
K.__webGLLineBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(S),c.STATIC_DRAW);K.__webGLFaceCount=z.length;K.__webGLLineCount=S.length}};this.renderBuffer=function(e,h,m,i,n){var g,o,r,D,M,H,z,S,E;if(i instanceof THREE.MeshShaderMaterial||i instanceof THREE.MeshDepthMaterial||i instanceof THREE.MeshNormalMaterial){if(!i.program){if(i instanceof THREE.MeshDepthMaterial){z=Q.depth;i.fragment_shader=z.fragment_shader;i.vertex_shader=z.vertex_shader;i.uniforms=z.uniforms;i.uniforms.mNear.value=
i.near;i.uniforms.mFar.value=i.far}else if(i instanceof THREE.MeshNormalMaterial){z=Q.normal;i.fragment_shader=z.fragment_shader;i.vertex_shader=z.vertex_shader;i.uniforms=z.uniforms}i.program=f(i.fragment_shader,i.vertex_shader,null);z=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition"];for(E in i.uniforms)z.push(E);k(i.program,z);q(i.program,["position","normal","uv","tangent"])}E=i.program}else E=u;if(E!=C){c.useProgram(E);C=E}E==u&&this.setupLights(E,
h);this.loadCamera(E,e);this.loadMatrices(E);if(i instanceof THREE.MeshShaderMaterial||i instanceof THREE.MeshDepthMaterial||i instanceof THREE.MeshNormalMaterial){r=i.wireframe;D=i.wireframe_linewidth;e=E;h=i.uniforms;var U;for(g in h){S=h[g].type;z=h[g].value;U=e.uniforms[g];if(S=="i")c.uniform1i(U,z);else if(S=="f")c.uniform1f(U,z);else if(S=="v3")c.uniform3f(U,z.x,z.y,z.z);else if(S=="c")c.uniform3f(U,z.r,z.g,z.b);else if(S=="t"){c.uniform1i(U,z);if(S=h[g].texture)S.image instanceof Array&&S.image.length==
6?d(S,z):j(S,z)}}}if(i instanceof THREE.MeshPhongMaterial||i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshBasicMaterial){g=i.color;o=i.opacity;r=i.wireframe;D=i.wireframe_linewidth;M=i.map;H=i.env_map;h=i.combine==THREE.MixOperation;e=i.reflectivity;S=i.env_map&&i.env_map.mapping instanceof THREE.CubeRefractionMapping;z=i.refraction_ratio;c.uniform4f(E.uniforms.mColor,g.r*o,g.g*o,g.b*o,o);c.uniform1i(E.uniforms.mixEnvMap,h);c.uniform1f(E.uniforms.mReflectivity,e);c.uniform1i(E.uniforms.useRefract,
S);c.uniform1f(E.uniforms.mRefractionRatio,z);if(m){c.uniform1f(E.uniforms.fogDensity,m.density);c.uniform3f(E.uniforms.fogColor,m.color.r,m.color.g,m.color.b)}}if(i instanceof THREE.MeshPhongMaterial){m=i.ambient;g=i.specular;i=i.shininess;c.uniform4f(E.uniforms.mAmbient,m.r,m.g,m.b,o);c.uniform4f(E.uniforms.mSpecular,g.r,g.g,g.b,o);c.uniform1f(E.uniforms.mShininess,i);c.uniform1i(E.uniforms.material,2)}else if(i instanceof THREE.MeshLambertMaterial)c.uniform1i(E.uniforms.material,1);else i instanceof
THREE.MeshBasicMaterial&&c.uniform1i(E.uniforms.material,0);if(M){j(M,0);c.uniform1i(E.uniforms.tMap,0);c.uniform1i(E.uniforms.enableMap,1)}else c.uniform1i(E.uniforms.enableMap,0);if(H){d(H,1);c.uniform1i(E.uniforms.tCube,1);c.uniform1i(E.uniforms.enableCubeMap,1)}else c.uniform1i(E.uniforms.enableCubeMap,0);o=E.attributes;c.bindBuffer(c.ARRAY_BUFFER,n.__webGLVertexBuffer);c.vertexAttribPointer(o.position,3,c.FLOAT,false,0,0);c.enableVertexAttribArray(o.position);if(o.normal>=0){c.bindBuffer(c.ARRAY_BUFFER,
n.__webGLNormalBuffer);c.vertexAttribPointer(o.normal,3,c.FLOAT,false,0,0);c.enableVertexAttribArray(o.normal)}if(o.tangent>=0){c.bindBuffer(c.ARRAY_BUFFER,n.__webGLTangentBuffer);c.vertexAttribPointer(o.tangent,4,c.FLOAT,false,0,0);c.enableVertexAttribArray(o.tangent)}if(o.uv>=0)if(n.__webGLUVBuffer){c.bindBuffer(c.ARRAY_BUFFER,n.__webGLUVBuffer);c.vertexAttribPointer(o.uv,2,c.FLOAT,false,0,0);c.enableVertexAttribArray(o.uv)}else c.disableVertexAttribArray(o.uv);if(r){c.lineWidth(D);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,
n.__webGLLineBuffer);c.drawElements(c.LINES,n.__webGLLineCount,c.UNSIGNED_SHORT,0)}else{c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n.__webGLFaceBuffer);c.drawElements(c.TRIANGLES,n.__webGLFaceCount,c.UNSIGNED_SHORT,0)}};this.renderPass=function(e,h,m,i,n,g,o){var r,D,M,H,z;M=0;for(H=i.materials.length;M<H;M++){r=i.materials[M];if(r instanceof THREE.MeshFaceMaterial){r=0;for(D=n.materials.length;r<D;r++)if((z=n.materials[r])&&z.blending==g&&z.opacity<1==o){this.setBlending(z.blending);this.renderBuffer(e,
h,m,z,n)}}else if((z=r)&&z.blending==g&&z.opacity<1==o){this.setBlending(z.blending);this.renderBuffer(e,h,m,z,n)}}};this.render=function(e,h){var m,i,n,g,o=e.lights,r=e.fog;this.initWebGLObjects(e);this.autoClear&&this.clear();h.autoUpdateMatrix&&h.updateMatrix();R.set(h.matrix.flatten());s.set(h.projectionMatrix.flatten());m=0;for(i=e.__webGLObjects.length;m<i;m++){n=e.__webGLObjects[m];g=n.object;n=n.buffer;if(g.visible){this.setupMatrices(g,h);this.renderPass(h,o,r,g,n,THREE.NormalBlending,false)}}m=
0;for(i=e.__webGLObjects.length;m<i;m++){n=e.__webGLObjects[m];g=n.object;n=n.buffer;if(g.visible){this.setupMatrices(g,h);this.renderPass(h,o,r,g,n,THREE.AdditiveBlending,false);this.renderPass(h,o,r,g,n,THREE.SubtractiveBlending,false);this.renderPass(h,o,r,g,n,THREE.AdditiveBlending,true);this.renderPass(h,o,r,g,n,THREE.SubtractiveBlending,true);this.renderPass(h,o,r,g,n,THREE.NormalBlending,true)}}};this.initWebGLObjects=function(e){var h,m,i,n,g,o;if(!e.__webGLObjects){e.__webGLObjects=[];e.__webGLObjectsMap=
{}}h=0;for(m=e.objects.length;h<m;h++){i=e.objects[h];if(e.__webGLObjectsMap[i.id]==undefined)e.__webGLObjectsMap[i.id]={};o=e.__webGLObjectsMap[i.id];if(i instanceof THREE.Mesh)for(g in i.geometry.geometryChunks){n=i.geometry.geometryChunks[g];n.__webGLVertexBuffer||this.createBuffers(i,g);if(o[g]==undefined){n={buffer:n,object:i};e.__webGLObjects.push(n);o[g]=1}}}};this.removeObject=function(e,h){var m,i;for(m=e.__webGLObjects.length-1;m>=0;m--){i=e.__webGLObjects[m].object;h==i&&e.__webGLObjects.splice(m,
1)}};this.setupMatrices=function(e,h){e.autoUpdateMatrix&&e.updateMatrix();t.multiply(h.matrix,e.matrix);N.set(t.flatten());J=THREE.Matrix4.makeInvert3x3(t).transpose();T.set(J.m);B.set(e.matrix.flatten())};this.loadMatrices=function(e){c.uniformMatrix4fv(e.uniforms.viewMatrix,false,R);c.uniformMatrix4fv(e.uniforms.modelViewMatrix,false,N);c.uniformMatrix4fv(e.uniforms.projectionMatrix,false,s);c.uniformMatrix3fv(e.uniforms.normalMatrix,false,T);c.uniformMatrix4fv(e.uniforms.objectMatrix,false,B)};
this.loadCamera=function(e,h){c.uniform3f(e.uniforms.cameraPosition,h.position.x,h.position.y,h.position.z)};this.setBlending=function(e){switch(e){case THREE.AdditiveBlending:c.blendEquation(c.FUNC_ADD);c.blendFunc(c.ONE,c.ONE);break;case THREE.SubtractiveBlending:c.blendFunc(c.DST_COLOR,c.ZERO);break;default:c.blendEquation(c.FUNC_ADD);c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA)}};this.setFaceCulling=function(e,h){if(e){!h||h=="ccw"?c.frontFace(c.CCW):c.frontFace(c.CW);if(e=="back")c.cullFace(c.BACK);
else e=="front"?c.cullFace(c.FRONT):c.cullFace(c.FRONT_AND_BACK);c.enable(c.CULL_FACE)}else c.disable(c.CULL_FACE)};this.supportsVertexTextures=function(){return c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0};var Q={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3}},fragment_shader:"uniform float mNear;\nuniform float mFar;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), 1.0 );\n}",
vertex_shader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{},fragment_shader:"varying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, 1.0 );\n}",vertex_shader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"}}};
THREE.RenderableObject=function(){this.z=this.object=null};THREE.RenderableFace3=function(){this.z=null;this.v1=new THREE.Vertex;this.v2=new THREE.Vertex;this.v3=new THREE.Vertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[];this.faceMaterials=this.meshMaterials=null;this.overdraw=false;this.uvs=[null,null,null]};
THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new THREE.Vector2;this.materials=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.Vertex;this.v2=new THREE.Vertex;this.materials=null};
